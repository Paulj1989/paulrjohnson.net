<?xml version="1.0" encoding="UTF-8"?>
<rss  xmlns:atom="http://www.w3.org/2005/Atom" 
      xmlns:media="http://search.yahoo.com/mrss/" 
      xmlns:content="http://purl.org/rss/1.0/modules/content/" 
      xmlns:dc="http://purl.org/dc/elements/1.1/" 
      version="2.0">
<channel>
<title>P(Johnson) &gt; 0.05</title>
<link>https://paulrjohnson.net/blog/</link>
<atom:link href="https://paulrjohnson.net/blog/index.xml" rel="self" type="application/rss+xml"/>
<description>This is my blog where I share the stupid things I&#39;ve done in the&lt;br&gt;
hope that you won&#39;t have to tread the same sorry path.&lt;br&gt;
[Subscribe via RSS](/blog/index.xml)
</description>
<generator>quarto-1.4.545</generator>
<lastBuildDate>Thu, 22 Feb 2024 00:00:00 GMT</lastBuildDate>
<item>
  <title>Developing Offensive Ratings Using Desirability Functions</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<div class="cell">
<details class="code-fold">
<summary>Setup Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(gt)</span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(showtext)</span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(ggplot2)</span>
<span id="cb1-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(worldfootballR)</span>
<span id="cb1-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(desirability2)</span>
<span id="cb1-9">})</span>
<span id="cb1-10"></span>
<span id="cb1-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># setup fonts</span></span>
<span id="cb1-12">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poppins"</span>)</span>
<span id="cb1-13">sysfonts<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">font_add_google</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lora"</span>)</span>
<span id="cb1-14">showtext<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">showtext_auto</span>()</span>
<span id="cb1-15"></span>
<span id="cb1-16"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set plot theme</span></span>
<span id="cb1-17"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># inspired by https://github.com/z3tt/TidyTuesday/blob/main/R/2020_31_PalmerPenguins.Rmd</span></span>
<span id="cb1-18"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_set</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_minimal</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">20</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">base_family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poppins"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb1-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme_update</span>(</span>
<span id="cb1-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.minor =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-23">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>)</span>
<span id="cb1-24">      ),</span>
<span id="cb1-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.title.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-26">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.05</span>)</span>
<span id="cb1-27">      ),</span>
<span id="cb1-28">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb1-29">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>),</span>
<span id="cb1-30">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.length =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">unit</span>(.<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"lines"</span>),</span>
<span id="cb1-31">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"top"</span>,</span>
<span id="cb1-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb1-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">legend.text =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)),</span>
<span id="cb1-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-35">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"black"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lora"</span>,</span>
<span id="cb1-36">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.5</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">t =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">b =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb1-37">    ),</span>
<span id="cb1-38">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.subtitle =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-39">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">family =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Lora"</span>,</span>
<span id="cb1-40">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.1</span>), </span>
<span id="cb1-41">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-42">    ),</span>
<span id="cb1-43">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.title.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>,</span>
<span id="cb1-44">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb1-45">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">color =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey50"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>,</span>
<span id="cb1-46">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>)</span>
<span id="cb1-47">    ),</span>
<span id="cb1-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.caption.position =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"plot"</span>,</span>
<span id="cb1-49">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">plot.margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rep</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span>))</span>
<span id="cb1-50">  )</span>
<span id="cb1-51"></span>
<span id="cb1-52"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># function for creating tables</span></span>
<span id="cb1-53">format_table <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-54">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(data, cols) {</span>
<span id="cb1-55">    data <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-56">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">gt</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-57">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fmt_number</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> cols, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">decimals =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-58">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tab_spanner</span>(</span>
<span id="cb1-59">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">label =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desirability Scores"</span>,</span>
<span id="cb1-60">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> cols</span>
<span id="cb1-61">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-62">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cols_align</span>(</span>
<span id="cb1-63">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">align =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"center"</span>,</span>
<span id="cb1-64">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">columns =</span> cols</span>
<span id="cb1-65">      ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-66">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tab_source_note</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">source_note =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Source: FB Ref Via {worldfootballR}"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb1-67">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tab_options</span>(</span>
<span id="cb1-68">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">table.width =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pct</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">100</span>),</span>
<span id="cb1-69">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">table.font.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Poppins"</span></span>
<span id="cb1-70">      )</span>
<span id="cb1-71">  }</span></code></pre></div>
</details>
</div>
<p>Building rating systems for complex, multidimensional contexts is difficult, and the results are often underwhelming. There are many examples of this in sports, where rating systems are common. While many sports have metrics that accurately describe team and player performance in specific contexts, ratings that summarise performance are more limited. Football has expected goals (xG). xG is a relatively accurate proxy for team performance because it describes every team’s primary objective - score more goals than the opponent. However, players help their team achieve this objective in many ways that xG does not capture.</p>
<p>An accurate player rating system would help address this. Performance has multiple components, so rating players is a balancing act. While goals may be the most important part of the game, a player who scored two goals has not necessarily played better than their teammate who contributed a goal and an assist, because player performance is a combination of factors. Player ratings are a multivariate optimisation problem.</p>
<p>In this blog post, I will use a simple but often overlooked method for multivariate optimisation - desirability functions - to develop a rating system for offensive players in football, using data from the big five leagues in the 2022/23 season. The ratings will attempt to identify the best players in Europe in the 2022/23 season because match-level ratings seem less fun (and more difficult).</p>
<p>As someone prone to seeing rabbit holes as a challenge, I have spent far too much time debating what factors should go into player ratings and how to maximise the performance of a rating system, but the focus of this post is on the demonstration of desirability functions. The result is a rating system with plenty of room for improvement, but hopefully, in the process, this post will serve as a brief introduction to desirability functions.</p>
<section id="desirability-functions" class="level1">
<h1>Desirability Functions</h1>
<p>Desirability functions are a method for simultaneously optimising multiple variables <span class="citation" data-cites="kuhn2023 harrington1965 derringer1980">(Kuhn 2023; Harrington 1965; Derringer and Suich 1980)</span>. If you have multiple variables, finding the optimal value of one may take you further away from the optimal value of the others. It is necessary to find an optimal combination of values instead, and desirability functions are a simple solution to this problem <span class="citation" data-cites="kuhn2023">(Kuhn 2023)</span>.</p>
<p>Desirability functions are common in fields like genomics, and they are sometimes used in machine learning to optimise across multiple evaluation metrics or model parameters. The <a href="https://desirability2.tidymodels.org/"><code>{desirability2}</code></a> package is a part of the <a href="https://www.tidymodels.org/">tidymodels</a> machine learning framework, but it is not limited to optimising evaluation metrics. While there are other ways of approaching this type of task, I like desirability functions for their relative simplicity. They are quick and easy, and they’re pretty simple to explain to non-technical audiences.</p>
<section id="how-desirability-works" class="level2">
<h2 class="anchored" data-anchor-id="how-desirability-works">How Desirability Works</h2>
<p>Desirability functions optimise across multiple variables by mapping each variable onto a standard scale from one (maximally desirable) to zero (unacceptable) using a transformation function<sup>1</sup>, before calculating the weighted combination of these individual scores using the arithmetic or geometric mean<sup>2</sup> and optimising this overall desirability score <span class="citation" data-cites="kuhn2016 kuhn2019 kuhn2023">(Kuhn 2016, 2023; Kuhn and Johnson 2019)</span>.</p>
<p>Mapping each variable to a standard scale makes a direct comparison between variables easier. The transformation function depends on what desirability looks like for each variable. If higher values are more desirable, maximisation would be appropriate, or minimisation when lower values are more desirable. Other transformations are possible, such as a particular target value or a box function that specifies a desirable interval, and there are also mechanisms for making desirability easier or harder to achieve, using scaling features. Having transformed each variable onto a scale where values approaching one are more desirable, the observation that achieves the highest average value of all individual desirability scores is the observation that is the closest to being maximally desirable.</p>
</section>
<section id="the-desirability2-package" class="level2">
<h2 class="anchored" data-anchor-id="the-desirability2-package">The <code>{desirability2}</code> Package</h2>
<p>There are two main groups of functions in the <a href="https://desirability2.tidymodels.org/reference/index.html"><code>{desirability2}</code></a> package - the <a href="https://desirability2.tidymodels.org/reference/inline_desirability.html">transformation functions</a> and the <a href="https://desirability2.tidymodels.org/reference/d_overall.html">overall desirability function</a>.</p>
<p>While the most commonly used transformation functions will be <code>d_max()</code> and <code>d_min()</code>, there are several other transformations (<code>d_target()</code>, <code>d_box()</code>, and <code>d_category()</code>). Where none of these functions are sufficient, <code>d_custom()</code> offers functionality for specifying a custom transformation. Finally, <code>d_overall()</code> calculates the overall desirability score.</p>
<p>All {desirability2} functions can be a part of a typical <a href="https://www.tidyverse.org/">tidyverse</a> pipeline.</p>
</section>
</section>
<section id="a-rating-system-for-offensive-football-players" class="level1">
<h1>A Rating System for Offensive Football Players</h1>
<div class="cell">
<details class="code-fold">
<summary>Data Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># get raw data</span></span>
<span id="cb2-2">standard_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fb_big5_advanced_season_stats</span>(</span>
<span id="cb2-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season_end_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>,</span>
<span id="cb2-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"standard"</span>,</span>
<span id="cb2-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team_or_player =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"player"</span></span>
<span id="cb2-7">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-8">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(</span>
<span id="cb2-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb2-10">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Playing"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-11">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Expected"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-12">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Progression"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-13">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PK"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pk"</span>,</span>
<span id="cb2-14">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"PKatt"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"pk_att"</span>,</span>
<span id="cb2-15">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xG"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xg"</span>,</span>
<span id="cb2-16">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xAG"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xag"</span>,</span>
<span id="cb2-17">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Per_90"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90"</span>,</span>
<span id="cb2-18">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Per"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90"</span></span>
<span id="cb2-19">    )</span>
<span id="cb2-20">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb2-22">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb2-23">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prg"</span>), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(.x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>mins90, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>), </span>
<span id="cb2-24">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"{.col}90"</span></span>
<span id="cb2-25">      ),</span>
<span id="cb2-26">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_split_i</span>(pos, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pattern =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">","</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">i =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>)</span>
<span id="cb2-27">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-28">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, position, squad, comp, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ends_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90"</span>))</span>
<span id="cb2-29"></span>
<span id="cb2-30">shooting_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-31">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fb_big5_advanced_season_stats</span>(</span>
<span id="cb2-32">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season_end_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>,</span>
<span id="cb2-33">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shooting"</span>,</span>
<span id="cb2-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team_or_player =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"player"</span></span>
<span id="cb2-35">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-36">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(</span>
<span id="cb2-37">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb2-38">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Standard"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-39">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_per_90"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"90"</span></span>
<span id="cb2-40">      )</span>
<span id="cb2-41">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-42">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, squad, sh90)</span>
<span id="cb2-43"></span>
<span id="cb2-44">passing_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-45">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fb_big5_advanced_season_stats</span>(</span>
<span id="cb2-46">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season_end_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>,</span>
<span id="cb2-47">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"passing"</span>,</span>
<span id="cb2-48">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team_or_player =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"player"</span></span>
<span id="cb2-49">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-50">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(</span>
<span id="cb2-51">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(</span>
<span id="cb2-52">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_Expected"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>,</span>
<span id="cb2-53">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xA"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xa"</span></span>
<span id="cb2-54">      )</span>
<span id="cb2-55">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-56">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">xa90 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(xa<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span>mins_per_90, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-57">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, squad, xa90)</span>
<span id="cb2-58"></span>
<span id="cb2-59">gca_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-60">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fb_big5_advanced_season_stats</span>(</span>
<span id="cb2-61">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season_end_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>, </span>
<span id="cb2-62">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"gca"</span>, </span>
<span id="cb2-63">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team_or_player =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"player"</span></span>
<span id="cb2-64">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb2-65">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">replace =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"_SCA"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">""</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-66">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, squad, sca90)</span>
<span id="cb2-67"></span>
<span id="cb2-68">possession_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-69">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">fb_big5_advanced_season_stats</span>(</span>
<span id="cb2-70">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">season_end_year =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2023</span>,</span>
<span id="cb2-71">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">stat_type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"possession"</span>,</span>
<span id="cb2-72">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team_or_player =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"player"</span></span>
<span id="cb2-73">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-74">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-75">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">pen_touches90 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(att_pen_touches<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">/</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">90</span>, <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-76">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, squad, pen_touches90)</span>
<span id="cb2-77"></span>
<span id="cb2-78"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># join full dataset</span></span>
<span id="cb2-79">big_five_stats <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-80">  standard_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-81">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(shooting_stats) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-82">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(passing_stats) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-83">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(gca_stats) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-84">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(possession_stats) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-85">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">tibble</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-86">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">drop_na</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-87">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">filter</span>(mins90 <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&gt;</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">&amp;</span> position <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">!=</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"GK"</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb2-88">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb2-89">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">team =</span> squad, </span>
<span id="cb2-90">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">league =</span> comp,</span>
<span id="cb2-91">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">npg90 =</span> g_minus_pk90</span>
<span id="cb2-92">    )</span></code></pre></div>
</details>
</div>
<p>Using the excellent <a href="https://jaseziv.github.io/worldfootballR"><code>{worldfootballR}</code></a> package, I have pulled together player-level <a href="https://fbref.com/">FB Ref</a> data for the 2022/23 season across the big five leagues, for a variety of different offensive measures. The data represents multiple elements of team offense, and in order to capture this, I have split the data into three components - goal threat, chance creation, and ball progression.</p>
<p>Goal threat is made up of four variables, non-penalty goals (npG), non-penalty expected goals (npxG), shots, and touches in the penalty area, while chance creation is comprised of just three - assists, expected assists (xA), and shot-creating actions (SCA). Finally, ball progression is also made up of three variables, progressive passes, carries, and receptions. Every variable in each desirability function is calculated per 90 minutes, to standardise variables by a player’s playing time.</p>
<p>The variables that make up each offensive component, and even the components themselves, are far from exhaustive. There are lots of different variables that could (and probably should) be included, and other aspects of a football team’s offense, like the defensive contributions made by offensive players higher up the pitch, would lead to a more precise rating system. However, the variables that make up the desirability functions here should do a reasonably effective job of capturing all three offensive components without overcomplicating things for the purpose of a blog post.</p>
<section id="goal-threat" class="level2">
<h2 class="anchored" data-anchor-id="goal-threat">Goal Threat</h2>
<p>Perhaps it is stating the obvious to even the most “I’m only here for the stats” folks reading this blog post, but scoring goals is a very important part of football. Goals are good. Teams love them. Everyone loves players that do them. So it makes sense to start the rating system with the goal threat component.</p>
<p>The four variables that make up the goal threat desirability function are npG, npxG, shots, and touches in the opponent’s penalty area. All of these variables have relatively clear predictive value when trying to predict goals, though you could also include other variables like average shot distance if you wanted to be more precise. Each variable also has a positive association with performance, so the desirability functions are all seeking to maximise their values.</p>
<p>The two most predictive variables are, perhaps unsurprisingly, npG and npxG, while shots and touches in the opponent’s penalty area are more supplementary. As a result, goals and expected goals have been rescaled to give them greater weight in the overall desirability score, while shots and touches have been rescaled to downweight their value (discussed in greater detail in Section&nbsp;2.1.1). The code for computing the goal threat desirability function is below (<code>d_max()</code> is the function doing all the work) and Table&nbsp;1 shows the top ten players in terms of goal threat.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">goal_threat <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb3-2">  big_five_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb3-4">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># maximise npg90 &amp; npxg90 with higher scale</span></span>
<span id="cb3-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb3-6">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(npg90, npxg90),</span>
<span id="cb3-7">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(.x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb3-8">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_{.col}"</span></span>
<span id="cb3-9">      ),</span>
<span id="cb3-10">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># maximise shots90 &amp; pen_touches90 with lower scale</span></span>
<span id="cb3-11">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb3-12">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(sh90, pen_touches90),</span>
<span id="cb3-13">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(.x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb3-14">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_{.col}"</span></span>
<span id="cb3-15">    ),</span>
<span id="cb3-16">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># overall desirability score for goal scoring</span></span>
<span id="cb3-17">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># tolerance set to 0.1 so that lowest values are not 0</span></span>
<span id="cb3-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d_goals =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_overall</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tolerance =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb3-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, position, team, league, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(d_goals)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(player<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>league), snakecase<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>to_title_case) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb3-23">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb3-24">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Non-Penalty Goals"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_npg90,</span>
<span id="cb3-25">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Non-Penalty xG"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_npxg90,</span>
<span id="cb3-26">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shots"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_sh90,</span>
<span id="cb3-27">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Penalty Area Touches"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_pen_touches90,</span>
<span id="cb3-28">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Overall"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_goals</span>
<span id="cb3-29">  )</span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Table Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">goal_threat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb4-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format_table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">9</span>)</span></code></pre></div>
</details>
<div id="tbl-goal-threat" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-goal-threat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Goal Threat Ratings
</figcaption>
<div aria-describedby="tbl-goal-threat-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="wbwajtijjg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wbwajtijjg table {
  font-family: Poppins;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wbwajtijjg thead, #wbwajtijjg tbody, #wbwajtijjg tfoot, #wbwajtijjg tr, #wbwajtijjg td, #wbwajtijjg th {
  border-style: none;
}

#wbwajtijjg p {
  margin: 0;
  padding: 0;
}

#wbwajtijjg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wbwajtijjg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wbwajtijjg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wbwajtijjg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wbwajtijjg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbwajtijjg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbwajtijjg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wbwajtijjg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wbwajtijjg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wbwajtijjg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wbwajtijjg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wbwajtijjg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wbwajtijjg .gt_spanner_row {
  border-bottom-style: hidden;
}

#wbwajtijjg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wbwajtijjg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wbwajtijjg .gt_from_md > :first-child {
  margin-top: 0;
}

#wbwajtijjg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wbwajtijjg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wbwajtijjg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wbwajtijjg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wbwajtijjg .gt_row_group_first td {
  border-top-width: 2px;
}

#wbwajtijjg .gt_row_group_first th {
  border-top-width: 2px;
}

#wbwajtijjg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbwajtijjg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wbwajtijjg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wbwajtijjg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbwajtijjg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbwajtijjg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wbwajtijjg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wbwajtijjg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wbwajtijjg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wbwajtijjg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbwajtijjg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbwajtijjg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wbwajtijjg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wbwajtijjg .gt_left {
  text-align: left;
}

#wbwajtijjg .gt_center {
  text-align: center;
}

#wbwajtijjg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wbwajtijjg .gt_font_normal {
  font-weight: normal;
}

#wbwajtijjg .gt_font_bold {
  font-weight: bold;
}

#wbwajtijjg .gt_font_italic {
  font-style: italic;
}

#wbwajtijjg .gt_super {
  font-size: 65%;
}

#wbwajtijjg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wbwajtijjg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wbwajtijjg .gt_indent_1 {
  text-indent: 5px;
}

#wbwajtijjg .gt_indent_2 {
  text-indent: 10px;
}

#wbwajtijjg .gt_indent_3 {
  text-indent: 15px;
}

#wbwajtijjg .gt_indent_4 {
  text-indent: 20px;
}

#wbwajtijjg .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Player" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Player</th>
<th rowspan="2" id="Position" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Position</th>
<th rowspan="2" id="Team" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Team</th>
<th rowspan="2" id="League" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">League</th>
<th colspan="5" id="Desirability Scores" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">Desirability Scores</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Non-Penalty Goals" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Non-Penalty Goals</th>
<th id="Non-Penalty xG" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Non-Penalty xG</th>
<th id="Shots" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Shots</th>
<th id="Penalty Area Touches" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Penalty Area Touches</th>
<th id="Overall" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Overall</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Erling Haaland</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">1.00</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">1.00</td>
<td class="gt_row gt_center" headers="Shots">0.90</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.85</td>
<td class="gt_row gt_center" headers="Overall">0.93</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Kylian Mbappé</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.78</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.90</td>
<td class="gt_row gt_center" headers="Shots">1.00</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">1.00</td>
<td class="gt_row gt_center" headers="Overall">0.91</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Victor Osimhen</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Napoli</td>
<td class="gt_row gt_left" headers="League">Serie A</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.80</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.77</td>
<td class="gt_row gt_center" headers="Shots">1.00</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.88</td>
<td class="gt_row gt_center" headers="Overall">0.86</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Robert Lewandowski</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Barcelona</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.60</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.97</td>
<td class="gt_row gt_center" headers="Shots">0.96</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.83</td>
<td class="gt_row gt_center" headers="Overall">0.83</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Callum Wilson</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Newcastle Utd</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.59</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.92</td>
<td class="gt_row gt_center" headers="Shots">0.85</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.64</td>
<td class="gt_row gt_center" headers="Overall">0.74</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Loïs Openda</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Lens</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.59</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.71</td>
<td class="gt_row gt_center" headers="Shots">0.89</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.74</td>
<td class="gt_row gt_center" headers="Overall">0.72</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Lautaro Martínez</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Inter</td>
<td class="gt_row gt_left" headers="League">Serie A</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.55</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.60</td>
<td class="gt_row gt_center" headers="Shots">0.97</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.75</td>
<td class="gt_row gt_center" headers="Overall">0.70</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Karim Benzema</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Real Madrid</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.32</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.77</td>
<td class="gt_row gt_center" headers="Shots">0.97</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.76</td>
<td class="gt_row gt_center" headers="Overall">0.65</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Alexandre Lacazette</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Lyon</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.48</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.54</td>
<td class="gt_row gt_center" headers="Shots">0.84</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.83</td>
<td class="gt_row gt_center" headers="Overall">0.65</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Darwin Núñez</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Liverpool</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Non-Penalty Goals">0.26</td>
<td class="gt_row gt_center" headers="Non-Penalty xG">0.73</td>
<td class="gt_row gt_center" headers="Shots">0.98</td>
<td class="gt_row gt_center" headers="Penalty Area Touches">0.71</td>
<td class="gt_row gt_center" headers="Overall">0.60</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td colspan="9" class="gt_sourcenote">Source: FB Ref Via {worldfootballR}</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>Erling Haaland, Kylian Mbappé, and Victor Osimhen leading the way in Table&nbsp;1 definitely inspires some confidence in this approach! Bar a few exceptions, like Alexandre Lacazette being one of the ten greatest goal threats in Europe at his big old age, the top ten feels pretty reasonable. The player that stands out the most, in part due to how high he is on the list, is Callum Wilson. However, looking back at his numbers last season, it’s more that he had a freak season than that the goal threat desirability score is doing something wonky. I don’t believe Callum Wilson poses the fifth greatest goal threat in the big five leagues, but it’s hard to argue with him being ranked fifth for his production last season.</p>
<p>I was also a little surprised not to see Harry Kane making the top ten, and it turns out he is in 15th. This appears to be because his xG was lower than the players ahead of him, despite him scoring plenty of goals last season. I think Kane’s lower rating raises questions about the decision to weight goals and expected goals equally. A more detailed rating system would need to make a decision about whether the goal is to describe a player’s past performance or identify the best players, which is inherently about predicting future performance. If it is the former, goals should probably be weighted higher, but if it is the latter, then expected goals should probably be favoured.</p>
<section id="sec-scaling" class="level3">
<h3 class="anchored" data-anchor-id="sec-scaling">Scaling Desirability Functions</h3>
<p>Each individual desirability function can be easily adjusted using the scaling feature, <img src="https://latex.codecogs.com/png.latex?s">, which can be increased in order to make maximal desirability harder to reach, and decreased to make it easier. The default value is 1 because <img src="https://latex.codecogs.com/png.latex?s"> is an exponent and a 1 effectively cancels this out. We’re having fun.</p>
<p>In the goal threat desirability function, goals and expected goals have <img src="https://latex.codecogs.com/png.latex?s%20=%202">, while for shots and touches in the opponent’s penalty area <img src="https://latex.codecogs.com/png.latex?s%20=%200.5">. This captures the fact that npG and npxG are very direct measures of goal threat (they are literally the actual goals and the probability of scoring actual goals!), while shots and touches are a lot less direct. I suspect we’d be better served giving shots greater weight in the function than touches, but in the interest of trying my hardest not to get bogged down in the domain context and focus on the method, let’s just give them the same weight.</p>
<p>Given that <img src="https://latex.codecogs.com/png.latex?s"> is the exponent, the scaling feature transforms the desirability function in a non-linear manner. The plot below illustrates how scaling affects desirability.</p>
<div class="cell">
<details class="code-fold">
<summary>Plot Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1">big_five_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb5-3">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># maximise shots90 without rescaling</span></span>
<span id="cb5-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">no_scale =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(sh90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb5-5">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># maximise shots90 with lower scale</span></span>
<span id="cb5-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">easier   =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(sh90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.2</span>),</span>
<span id="cb5-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># maximise shots90 with higher scale</span></span>
<span id="cb5-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">harder =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(sh90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span>
<span id="cb5-9">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-10">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb5-11">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(no_scale, easier, harder), </span>
<span id="cb5-12">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaling"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span></span>
<span id="cb5-13">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scaling =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(scaling, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"no_scale"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"easier"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"harder"</span>))) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb5-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> sh90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> scaling)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_point</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_line</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">alpha =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_colour_manual</span>(</span>
<span id="cb5-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#026E99"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D93649"</span>),</span>
<span id="cb5-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> snakecase<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>to_title_case</span>
<span id="cb5-21">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb5-22">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb5-23">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> </span>
<span id="cb5-24">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Scaling Effects on the Desirability Score of Shots/90"</span>,</span>
<span id="cb5-25">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> </span>
<span id="cb5-26">      stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_wrap</span>(</span>
<span id="cb5-27">        glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb5-28">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The unscaled desirability function is a linear transformation of "</span>,</span>
<span id="cb5-29">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"shots per 90, while the rescaled functions are non-linear, with "</span>,</span>
<span id="cb5-30">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"scaling values &gt; 1 making higher desirability more difficult to "</span>,</span>
<span id="cb5-31">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"satisfy and values &lt; 1 making it easier."</span></span>
<span id="cb5-32">          ),</span>
<span id="cb5-33">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span></span>
<span id="cb5-34">      ),</span>
<span id="cb5-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Shots/90"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desirability"</span>,</span>
<span id="cb5-36">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> </span>
<span id="cb5-37">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visualisation: Paul Johnson  |  Data: FB Ref Via {worldfootballR}"</span></span>
<span id="cb5-38">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/scaling-shots-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions/index_files/figure-html/scaling-shots-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>When scaling desirability functions I think it is important to recognise the effects that imposing a non-linear transformation has. Because I’ve used the <code>use_data = TRUE</code> argument in <code>d_max()</code>, the maximum and minimum value in each desirability function is set by the data, meaning that regardless of the scaling applied the maximum value will still be 1 and the minimum value will be 0. However, as the scale increases, this will make it much harder for values to reach higher desirability scores, meaning that lower values of the corresponding variable will be given lower scores, but the non-linearity imposed increases the rate of desirability increases at higher values of the corresponding variable.</p>
<p>It is important to realise that making maximal desirability harder in this non-linear fashion does not downweight the highest values of that variable. Instead, it actually increases the magnitude of those highest values, because so few other observations are similarly high! Therefore, if you want to downweight the value of a particular variable in the overall desirability score, it needs to be easier to reach maximal desirability, because all values of that variable will have a higher score and that will give the highest values less leverage.</p>
<p>I think it is a little difficult to process the exponential effects of <img src="https://latex.codecogs.com/png.latex?s"> in this context. We are primarily interested in the highest values of each desirability function, given that the focus is on building a rating system, and increasing <img src="https://latex.codecogs.com/png.latex?s"> achieves our goals at the top-end of the ratings, but it obviously feels a little wonky to exponentially increase the value of a particular desirability function in order to downweight it in the overall desirability score! I think it is sensible to visualise the effects that your intended scaling will have, so as to help you think through the choices you’re making.</p>
</section>
</section>
<section id="chance-creation" class="level2">
<h2 class="anchored" data-anchor-id="chance-creation">Chance Creation</h2>
<p>If doing goals is the most important part of an offense in football, then helping others do goals must be the next best thing. Which brings us to chance creation. The process for creating a rating system for chance creation is more or less the same as with goal scoring. I’ve selected three variables that will go into the chance creation ratings - assists, expected assists (xA), and shot-creating actions (SCA).</p>
<p>In this case, the SCA desirability function has been scaled to reduce SCA’s effect on the overall score but assists and expected assists are unscaled. While I think that shot-creating actions are not quite as valuable as assists, I don’t want to exponentially increase the value of assists and expected assists at the top end of the desirability score. Goalscoring is the most important part of football, so I think small increases in the per 90 rate of goalscoring should be rewarded greatly, but creating chances, while still very important, is still reliant on the player receiving the ball putting it away, and I think the decisions made here reflect that.</p>
<p>Just as with the goal threat component, the choices I’ve made here are more of an art than a science, and I think I could easily be convinced that the way I’ve structured the desirability functions for chance creation are incorrect. Unfortunately for you, I’m not actually having that debate, so I went ahead and made my own choice. It’s probably wrong. Table&nbsp;2 shows the results of my poor choices, in life and in this blog post.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1">chance_creation <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> </span>
<span id="cb6-2">  big_five_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb6-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb6-5">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(ast90, xa90),</span>
<span id="cb6-6">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(.x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb6-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_{.col}"</span></span>
<span id="cb6-8">      ),</span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d_sca90 =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(sca90, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">scale =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d_chances =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_overall</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tolerance =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb6-11">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, position, team, league, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(player<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>league), snakecase<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>to_title_case) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb6-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Assists"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_ast90,</span>
<span id="cb6-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"xA"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_xa90,</span>
<span id="cb6-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"SCA"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_sca90,</span>
<span id="cb6-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Overall"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_chances</span>
<span id="cb6-19">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb6-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Overall))</span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Table Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">chance_creation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb7-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format_table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span></code></pre></div>
</details>
<div id="tbl-chance-creation" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-chance-creation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Chance Creation Ratings
</figcaption>
<div aria-describedby="tbl-chance-creation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="oxsyxttozi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oxsyxttozi table {
  font-family: Poppins;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oxsyxttozi thead, #oxsyxttozi tbody, #oxsyxttozi tfoot, #oxsyxttozi tr, #oxsyxttozi td, #oxsyxttozi th {
  border-style: none;
}

#oxsyxttozi p {
  margin: 0;
  padding: 0;
}

#oxsyxttozi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oxsyxttozi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oxsyxttozi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oxsyxttozi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oxsyxttozi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oxsyxttozi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxsyxttozi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oxsyxttozi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oxsyxttozi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oxsyxttozi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oxsyxttozi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oxsyxttozi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oxsyxttozi .gt_spanner_row {
  border-bottom-style: hidden;
}

#oxsyxttozi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oxsyxttozi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oxsyxttozi .gt_from_md > :first-child {
  margin-top: 0;
}

#oxsyxttozi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oxsyxttozi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oxsyxttozi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oxsyxttozi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oxsyxttozi .gt_row_group_first td {
  border-top-width: 2px;
}

#oxsyxttozi .gt_row_group_first th {
  border-top-width: 2px;
}

#oxsyxttozi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxsyxttozi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oxsyxttozi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oxsyxttozi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxsyxttozi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxsyxttozi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oxsyxttozi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oxsyxttozi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oxsyxttozi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oxsyxttozi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oxsyxttozi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxsyxttozi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oxsyxttozi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oxsyxttozi .gt_left {
  text-align: left;
}

#oxsyxttozi .gt_center {
  text-align: center;
}

#oxsyxttozi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oxsyxttozi .gt_font_normal {
  font-weight: normal;
}

#oxsyxttozi .gt_font_bold {
  font-weight: bold;
}

#oxsyxttozi .gt_font_italic {
  font-style: italic;
}

#oxsyxttozi .gt_super {
  font-size: 65%;
}

#oxsyxttozi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oxsyxttozi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oxsyxttozi .gt_indent_1 {
  text-indent: 5px;
}

#oxsyxttozi .gt_indent_2 {
  text-indent: 10px;
}

#oxsyxttozi .gt_indent_3 {
  text-indent: 15px;
}

#oxsyxttozi .gt_indent_4 {
  text-indent: 20px;
}

#oxsyxttozi .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Player" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Player</th>
<th rowspan="2" id="Position" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Position</th>
<th rowspan="2" id="Team" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Team</th>
<th rowspan="2" id="League" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">League</th>
<th colspan="4" id="Desirability Scores" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">Desirability Scores</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Assists" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Assists</th>
<th id="xA" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">xA</th>
<th id="SCA" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">SCA</th>
<th id="Overall" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Overall</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Kevin De Bruyne</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Assists">0.94</td>
<td class="gt_row gt_center" headers="xA">1.00</td>
<td class="gt_row gt_center" headers="SCA">1.00</td>
<td class="gt_row gt_center" headers="Overall">0.98</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Neymar</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Assists">1.00</td>
<td class="gt_row gt_center" headers="xA">0.83</td>
<td class="gt_row gt_center" headers="SCA">0.97</td>
<td class="gt_row gt_center" headers="Overall">0.93</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Lionel Messi</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Assists">0.80</td>
<td class="gt_row gt_center" headers="xA">0.98</td>
<td class="gt_row gt_center" headers="SCA">0.98</td>
<td class="gt_row gt_center" headers="Overall">0.91</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Rémy Cabella</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Lille</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Assists">0.56</td>
<td class="gt_row gt_center" headers="xA">0.83</td>
<td class="gt_row gt_center" headers="SCA">0.99</td>
<td class="gt_row gt_center" headers="Overall">0.77</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Thomas Müller</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Bayern Munich</td>
<td class="gt_row gt_left" headers="League">Bundesliga</td>
<td class="gt_row gt_center" headers="Assists">0.67</td>
<td class="gt_row gt_center" headers="xA">0.73</td>
<td class="gt_row gt_center" headers="SCA">0.84</td>
<td class="gt_row gt_center" headers="Overall">0.74</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Antoine Griezmann</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Atlético Madrid</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Assists">0.78</td>
<td class="gt_row gt_center" headers="xA">0.60</td>
<td class="gt_row gt_center" headers="SCA">0.88</td>
<td class="gt_row gt_center" headers="Overall">0.74</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Ousmane Dembélé</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Barcelona</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Assists">0.70</td>
<td class="gt_row gt_center" headers="xA">0.62</td>
<td class="gt_row gt_center" headers="SCA">0.91</td>
<td class="gt_row gt_center" headers="Overall">0.73</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Rayan Cherki</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Lyon</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Assists">0.45</td>
<td class="gt_row gt_center" headers="xA">0.83</td>
<td class="gt_row gt_center" headers="SCA">0.97</td>
<td class="gt_row gt_center" headers="Overall">0.71</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Kingsley Coman</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Bayern Munich</td>
<td class="gt_row gt_left" headers="League">Bundesliga</td>
<td class="gt_row gt_center" headers="Assists">0.50</td>
<td class="gt_row gt_center" headers="xA">0.79</td>
<td class="gt_row gt_center" headers="SCA">0.91</td>
<td class="gt_row gt_center" headers="Overall">0.71</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Raphaël Guerreiro</td>
<td class="gt_row gt_left" headers="Position">DF</td>
<td class="gt_row gt_left" headers="Team">Dortmund</td>
<td class="gt_row gt_left" headers="League">Bundesliga</td>
<td class="gt_row gt_center" headers="Assists">0.73</td>
<td class="gt_row gt_center" headers="xA">0.60</td>
<td class="gt_row gt_center" headers="SCA">0.81</td>
<td class="gt_row gt_center" headers="Overall">0.71</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td colspan="8" class="gt_sourcenote">Source: FB Ref Via {worldfootballR}</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>Again, the names at the top of the Table&nbsp;2 ratings give me confidence, especially the three names at the very top - Neymar, Kevin De Bruyne, and Lionel Messi. I don’t think there are any huge surprises in these ratings, perhaps with the exception of Rémy Cabella, who has some solid to very good creation numbers but wouldn’t necessarily be a name you’d immediately think of when thinking about the ten best creative players in the world. This is once again a reminder that Ligue 1 is very silly but is wonderfully chaotic.</p>
</section>
<section id="ball-progression" class="level2">
<h2 class="anchored" data-anchor-id="ball-progression">Ball Progression</h2>
<p>The final component, and possibly the most interesting of the three, is ball progression. The three variables included in the ball progression desirability function are progressive carries, passes, and receptions. Just as is the case with the previous two components, I’m sure you could include other variables as measures of ball progression, but I’m still too lazy to do that and I think a lot of those other variables would risk double-counting where those actions are picked up by one of the progression metrics.</p>
<p>I am particularly unsure about how to weight the value of progressive actions, especially progressive passing and receptions, which are connected actions. I could see an argument for giving less weight to progressive receptions, and treating carries and passes equally, but I could also see a case that progressive passes and receptions should be treated equally because both the passer and receiver have to do their job to make the progressive action successful. Given my uncertainty about this particular category, I’ve decided it is best to weight all three variables equally.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1">ball_progression <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb8-2">  big_five_stats <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb8-4">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(</span>
<span id="cb8-5">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prg"</span>),</span>
<span id="cb8-6">      <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_max</span>(.x, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">use_data =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>),</span>
<span id="cb8-7">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.names =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_{.col}"</span></span>
<span id="cb8-8">    ),</span>
<span id="cb8-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">d_prg =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_overall</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tolerance =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.1</span>)</span>
<span id="cb8-10">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(player, position, team, league, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">starts_with</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"d_"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-12">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(d_prg)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb8-13">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename_at</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">vars</span>(player<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span>league), snakecase<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>to_title_case) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb8-14">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(</span>
<span id="cb8-15">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive Carrying"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_prg_c90,</span>
<span id="cb8-16">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive Passing"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_prg_p90,</span>
<span id="cb8-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Progressive Receptions"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_prg_r90,</span>
<span id="cb8-18">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Overall"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> d_prg</span>
<span id="cb8-19">  )</span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Table Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb9" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1">ball_progression <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb9-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format_table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span></code></pre></div>
</details>
<div id="tbl-ball-progression" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-ball-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Ball Progression Ratings
</figcaption>
<div aria-describedby="tbl-ball-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="nusjbpdalz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nusjbpdalz table {
  font-family: Poppins;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nusjbpdalz thead, #nusjbpdalz tbody, #nusjbpdalz tfoot, #nusjbpdalz tr, #nusjbpdalz td, #nusjbpdalz th {
  border-style: none;
}

#nusjbpdalz p {
  margin: 0;
  padding: 0;
}

#nusjbpdalz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nusjbpdalz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nusjbpdalz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nusjbpdalz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nusjbpdalz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nusjbpdalz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nusjbpdalz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nusjbpdalz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nusjbpdalz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nusjbpdalz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nusjbpdalz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nusjbpdalz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nusjbpdalz .gt_spanner_row {
  border-bottom-style: hidden;
}

#nusjbpdalz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nusjbpdalz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nusjbpdalz .gt_from_md > :first-child {
  margin-top: 0;
}

#nusjbpdalz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nusjbpdalz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nusjbpdalz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nusjbpdalz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nusjbpdalz .gt_row_group_first td {
  border-top-width: 2px;
}

#nusjbpdalz .gt_row_group_first th {
  border-top-width: 2px;
}

#nusjbpdalz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nusjbpdalz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nusjbpdalz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nusjbpdalz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nusjbpdalz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nusjbpdalz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nusjbpdalz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nusjbpdalz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nusjbpdalz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nusjbpdalz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nusjbpdalz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nusjbpdalz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nusjbpdalz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nusjbpdalz .gt_left {
  text-align: left;
}

#nusjbpdalz .gt_center {
  text-align: center;
}

#nusjbpdalz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nusjbpdalz .gt_font_normal {
  font-weight: normal;
}

#nusjbpdalz .gt_font_bold {
  font-weight: bold;
}

#nusjbpdalz .gt_font_italic {
  font-style: italic;
}

#nusjbpdalz .gt_super {
  font-size: 65%;
}

#nusjbpdalz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nusjbpdalz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nusjbpdalz .gt_indent_1 {
  text-indent: 5px;
}

#nusjbpdalz .gt_indent_2 {
  text-indent: 10px;
}

#nusjbpdalz .gt_indent_3 {
  text-indent: 15px;
}

#nusjbpdalz .gt_indent_4 {
  text-indent: 20px;
}

#nusjbpdalz .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Player" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Player</th>
<th rowspan="2" id="Position" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Position</th>
<th rowspan="2" id="Team" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Team</th>
<th rowspan="2" id="League" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">League</th>
<th colspan="4" id="Desirability Scores" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">Desirability Scores</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Progressive Carrying" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Carrying</th>
<th id="Progressive Passing" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Passing</th>
<th id="Progressive Receptions" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Receptions</th>
<th id="Overall" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Overall</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Rayan Cherki</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Lyon</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.81</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.50</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.66</td>
<td class="gt_row gt_center" headers="Overall">0.64</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Kingsley Coman</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Bayern Munich</td>
<td class="gt_row gt_left" headers="League">Bundesliga</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.79</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.31</td>
<td class="gt_row gt_center" headers="Progressive Receptions">1.00</td>
<td class="gt_row gt_center" headers="Overall">0.62</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Ousmane Dembélé</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Barcelona</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Progressive Carrying">1.00</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.32</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.71</td>
<td class="gt_row gt_center" headers="Overall">0.61</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Jack Grealish</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.79</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.30</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.72</td>
<td class="gt_row gt_center" headers="Overall">0.56</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Kevin De Bruyne</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.47</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.67</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.48</td>
<td class="gt_row gt_center" headers="Overall">0.53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Kylian Mbappé</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.67</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.28</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.79</td>
<td class="gt_row gt_center" headers="Overall">0.53</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Rémy Cabella</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Lille</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.51</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.60</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.46</td>
<td class="gt_row gt_center" headers="Overall">0.52</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Neymar</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.51</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.69</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.39</td>
<td class="gt_row gt_center" headers="Overall">0.52</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Raphinha</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Barcelona</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.53</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.31</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.78</td>
<td class="gt_row gt_center" headers="Overall">0.51</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Vinicius Júnior</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Real Madrid</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.89</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.17</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.84</td>
<td class="gt_row gt_center" headers="Overall">0.51</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td colspan="8" class="gt_sourcenote">Source: FB Ref Via {worldfootballR}</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>Forwards dominated the first two components but Table&nbsp;3 is more diverse. This is to be expected, given that ball progression is often about moving the ball up the pitch to the forwards! Table&nbsp;4 aggregates the ball progression desirability scores by position.</p>
<div class="cell">
<details class="code-fold">
<summary>Table Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1">ball_progression <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">summarise</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">where</span>(is.numeric), mean), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.by =</span> Position) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Overall)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb10-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format_table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>)</span></code></pre></div>
</details>
<div id="tbl-position-progression" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-position-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Ball Progression Desirability by Position
</figcaption>
<div aria-describedby="tbl-position-progression-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="rtevtopeku" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rtevtopeku table {
  font-family: Poppins;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rtevtopeku thead, #rtevtopeku tbody, #rtevtopeku tfoot, #rtevtopeku tr, #rtevtopeku td, #rtevtopeku th {
  border-style: none;
}

#rtevtopeku p {
  margin: 0;
  padding: 0;
}

#rtevtopeku .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rtevtopeku .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rtevtopeku .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rtevtopeku .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rtevtopeku .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rtevtopeku .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rtevtopeku .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rtevtopeku .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rtevtopeku .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rtevtopeku .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rtevtopeku .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rtevtopeku .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rtevtopeku .gt_spanner_row {
  border-bottom-style: hidden;
}

#rtevtopeku .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rtevtopeku .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rtevtopeku .gt_from_md > :first-child {
  margin-top: 0;
}

#rtevtopeku .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rtevtopeku .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rtevtopeku .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rtevtopeku .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rtevtopeku .gt_row_group_first td {
  border-top-width: 2px;
}

#rtevtopeku .gt_row_group_first th {
  border-top-width: 2px;
}

#rtevtopeku .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rtevtopeku .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rtevtopeku .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rtevtopeku .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rtevtopeku .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rtevtopeku .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rtevtopeku .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rtevtopeku .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rtevtopeku .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rtevtopeku .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rtevtopeku .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rtevtopeku .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rtevtopeku .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rtevtopeku .gt_left {
  text-align: left;
}

#rtevtopeku .gt_center {
  text-align: center;
}

#rtevtopeku .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rtevtopeku .gt_font_normal {
  font-weight: normal;
}

#rtevtopeku .gt_font_bold {
  font-weight: bold;
}

#rtevtopeku .gt_font_italic {
  font-style: italic;
}

#rtevtopeku .gt_super {
  font-size: 65%;
}

#rtevtopeku .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rtevtopeku .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rtevtopeku .gt_indent_1 {
  text-indent: 5px;
}

#rtevtopeku .gt_indent_2 {
  text-indent: 10px;
}

#rtevtopeku .gt_indent_3 {
  text-indent: 15px;
}

#rtevtopeku .gt_indent_4 {
  text-indent: 20px;
}

#rtevtopeku .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Position" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Position</th>
<th colspan="4" id="Desirability Scores" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">Desirability Scores</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Progressive Carrying" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Carrying</th>
<th id="Progressive Passing" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Passing</th>
<th id="Progressive Receptions" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Progressive Receptions</th>
<th id="Overall" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Overall</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.31</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.16</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.39</td>
<td class="gt_row gt_center" headers="Overall">0.26</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.22</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.35</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.17</td>
<td class="gt_row gt_center" headers="Overall">0.23</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Position">DF</td>
<td class="gt_row gt_center" headers="Progressive Carrying">0.16</td>
<td class="gt_row gt_center" headers="Progressive Passing">0.24</td>
<td class="gt_row gt_center" headers="Progressive Receptions">0.12</td>
<td class="gt_row gt_center" headers="Overall">0.18</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="5" class="gt_sourcenote">Source: FB Ref Via {worldfootballR}</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>The results are not shocking, but the marginal differences in progression by position are interesting. As expected, forwards are dominant in the receptions category, but the responsibilities for progressive carries are more evenly split, and forwards are third behind midfielders and defenders in progressive passing.</p>
</section>
<section id="overall-offensive-ratings" class="level2">
<h2 class="anchored" data-anchor-id="overall-offensive-ratings">Overall Offensive Ratings</h2>
<p>Having created desirability scores for each offensive component, we could combine all three into an overall offensive rating using <code>d_overall()</code>. I think this would be a reasonable choice when the assumption is that each category is equally important in the overall score, but as discussed already, I don’t think that’s the case here. I think goal threat matters most, and chance creation and ball progression are, while important enough to be the two other categories in the overall ratings, a little less important than goals.</p>
<p>Whether or not goals are more important than chance creation and ball progression is probably open to plenty of debate, but assuming that they are (because this is my blog and I said so), we have to weight the three categories to reflect this. Rather than overcomplicating things and trying to do this as part of the process within the desirability functions, I have downweighted chance creation and ball progression by multiplying them by 0.5.</p>
<p>Finally, I have opted for the arithmetic mean instead of the geometric mean, because I think the purpose of the geometric mean is of less value here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">offensive_rating <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb11-2">  goal_threat <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goal Threat"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Overall) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb11-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(chance_creation <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chance Creation"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Overall)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">full_join</span>(ball_progression <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rename</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ball Progression"</span> <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">=</span> Overall)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb11-7">    <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># downweight chance creation and ball progression desirability scores</span></span>
<span id="cb11-8">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chance Creation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ball Progression"</span>), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> .x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">*</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>),</span>
<span id="cb11-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Overall =</span></span>
<span id="cb11-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">d_overall</span>(</span>
<span id="cb11-11">        <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">across</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">.cols =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goal Threat"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chance Creation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ball Progression"</span>)),</span>
<span id="cb11-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">geometric =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">FALSE</span></span>
<span id="cb11-13">        )</span>
<span id="cb11-14">  ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">select</span>(</span>
<span id="cb11-16">    Player, Position, Team, League, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goal Threat"</span>, </span>
<span id="cb11-17">    <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chance Creation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ball Progression"</span>, Overall</span>
<span id="cb11-18">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb11-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">arrange</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">desc</span>(Overall))</span></code></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Table Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb12" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1">offensive_rating <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span></span>
<span id="cb12-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb12-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">format_table</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>)</span></code></pre></div>
</details>
<div id="tbl-offensive-rating" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-offensive-rating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Overall Offensive Ratings
</figcaption>
<div aria-describedby="tbl-offensive-rating-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="smxpeknmsw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#smxpeknmsw table {
  font-family: Poppins;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#smxpeknmsw thead, #smxpeknmsw tbody, #smxpeknmsw tfoot, #smxpeknmsw tr, #smxpeknmsw td, #smxpeknmsw th {
  border-style: none;
}

#smxpeknmsw p {
  margin: 0;
  padding: 0;
}

#smxpeknmsw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 100%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#smxpeknmsw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#smxpeknmsw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#smxpeknmsw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#smxpeknmsw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#smxpeknmsw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smxpeknmsw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#smxpeknmsw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#smxpeknmsw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#smxpeknmsw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#smxpeknmsw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#smxpeknmsw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#smxpeknmsw .gt_spanner_row {
  border-bottom-style: hidden;
}

#smxpeknmsw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#smxpeknmsw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#smxpeknmsw .gt_from_md > :first-child {
  margin-top: 0;
}

#smxpeknmsw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#smxpeknmsw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#smxpeknmsw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#smxpeknmsw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#smxpeknmsw .gt_row_group_first td {
  border-top-width: 2px;
}

#smxpeknmsw .gt_row_group_first th {
  border-top-width: 2px;
}

#smxpeknmsw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#smxpeknmsw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#smxpeknmsw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#smxpeknmsw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smxpeknmsw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#smxpeknmsw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#smxpeknmsw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#smxpeknmsw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#smxpeknmsw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#smxpeknmsw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#smxpeknmsw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#smxpeknmsw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#smxpeknmsw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#smxpeknmsw .gt_left {
  text-align: left;
}

#smxpeknmsw .gt_center {
  text-align: center;
}

#smxpeknmsw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#smxpeknmsw .gt_font_normal {
  font-weight: normal;
}

#smxpeknmsw .gt_font_bold {
  font-weight: bold;
}

#smxpeknmsw .gt_font_italic {
  font-style: italic;
}

#smxpeknmsw .gt_super {
  font-size: 65%;
}

#smxpeknmsw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#smxpeknmsw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#smxpeknmsw .gt_indent_1 {
  text-indent: 5px;
}

#smxpeknmsw .gt_indent_2 {
  text-indent: 10px;
}

#smxpeknmsw .gt_indent_3 {
  text-indent: 15px;
}

#smxpeknmsw .gt_indent_4 {
  text-indent: 20px;
}

#smxpeknmsw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings gt_spanner_row">
<th rowspan="2" id="Player" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Player</th>
<th rowspan="2" id="Position" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Position</th>
<th rowspan="2" id="Team" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Team</th>
<th rowspan="2" id="League" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">League</th>
<th colspan="4" id="Desirability Scores" class="gt_center gt_columns_top_border gt_column_spanner_outer" data-quarto-table-cell-role="th" scope="colgroup"><span class="gt_column_spanner">Desirability Scores</span></th>
</tr>
<tr class="odd gt_col_headings">
<th id="Goal Threat" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Goal Threat</th>
<th id="Chance Creation" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Chance Creation</th>
<th id="Ball Progression" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Ball Progression</th>
<th id="Overall" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Overall</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Kylian Mbappé</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Goal Threat">0.91</td>
<td class="gt_row gt_center" headers="Chance Creation">0.25</td>
<td class="gt_row gt_center" headers="Ball Progression">0.26</td>
<td class="gt_row gt_center" headers="Overall">0.47</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Lionel Messi</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Goal Threat">0.54</td>
<td class="gt_row gt_center" headers="Chance Creation">0.46</td>
<td class="gt_row gt_center" headers="Ball Progression">0.25</td>
<td class="gt_row gt_center" headers="Overall">0.41</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Erling Haaland</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Goal Threat">0.93</td>
<td class="gt_row gt_center" headers="Chance Creation">0.18</td>
<td class="gt_row gt_center" headers="Ball Progression">0.08</td>
<td class="gt_row gt_center" headers="Overall">0.40</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Robert Lewandowski</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Barcelona</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Goal Threat">0.83</td>
<td class="gt_row gt_center" headers="Chance Creation">0.21</td>
<td class="gt_row gt_center" headers="Ball Progression">0.13</td>
<td class="gt_row gt_center" headers="Overall">0.39</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Neymar</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Paris S-G</td>
<td class="gt_row gt_left" headers="League">Ligue 1</td>
<td class="gt_row gt_center" headers="Goal Threat">0.45</td>
<td class="gt_row gt_center" headers="Chance Creation">0.46</td>
<td class="gt_row gt_center" headers="Ball Progression">0.26</td>
<td class="gt_row gt_center" headers="Overall">0.39</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Victor Osimhen</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Napoli</td>
<td class="gt_row gt_left" headers="League">Serie A</td>
<td class="gt_row gt_center" headers="Goal Threat">0.86</td>
<td class="gt_row gt_center" headers="Chance Creation">0.13</td>
<td class="gt_row gt_center" headers="Ball Progression">0.10</td>
<td class="gt_row gt_center" headers="Overall">0.36</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Karim Benzema</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Real Madrid</td>
<td class="gt_row gt_left" headers="League">La Liga</td>
<td class="gt_row gt_center" headers="Goal Threat">0.65</td>
<td class="gt_row gt_center" headers="Chance Creation">0.21</td>
<td class="gt_row gt_center" headers="Ball Progression">0.20</td>
<td class="gt_row gt_center" headers="Overall">0.36</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Kingsley Coman</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Bayern Munich</td>
<td class="gt_row gt_left" headers="League">Bundesliga</td>
<td class="gt_row gt_center" headers="Goal Threat">0.38</td>
<td class="gt_row gt_center" headers="Chance Creation">0.36</td>
<td class="gt_row gt_center" headers="Ball Progression">0.31</td>
<td class="gt_row gt_center" headers="Overall">0.35</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Player">Mohamed Salah</td>
<td class="gt_row gt_left" headers="Position">FW</td>
<td class="gt_row gt_left" headers="Team">Liverpool</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Goal Threat">0.56</td>
<td class="gt_row gt_center" headers="Chance Creation">0.27</td>
<td class="gt_row gt_center" headers="Ball Progression">0.21</td>
<td class="gt_row gt_center" headers="Overall">0.34</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="Player">Kevin De Bruyne</td>
<td class="gt_row gt_left" headers="Position">MF</td>
<td class="gt_row gt_left" headers="Team">Manchester City</td>
<td class="gt_row gt_left" headers="League">Premier League</td>
<td class="gt_row gt_center" headers="Goal Threat">0.25</td>
<td class="gt_row gt_center" headers="Chance Creation">0.49</td>
<td class="gt_row gt_center" headers="Ball Progression">0.27</td>
<td class="gt_row gt_center" headers="Overall">0.34</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="even">
<td colspan="8" class="gt_sourcenote">Source: FB Ref Via {worldfootballR}</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>The old rule was that any metric not broken by Lionel Messi being so far ahead of everyone else is wrong, but Messi isn’t quite the freak of nature he once was. Nonetheless, Messi’s name being near the top of the ratings is a good sign, as is Mbappé and Haaland flanking him at the top. At a glance, there are few surprises in Table&nbsp;5.</p>
<p>Kingsley Coman making it into the top ten feels generous, but perhaps the biggest issue is the three Ligue 1 players in the top five. While those three players are exceptional, they seem to be rated a little too high. I think this points to the inevitable league effects compromising the ratings. The big five leagues have been treated equally and we know that isn’t really the case (Ligue 1 is probably the weakest of the five). A more precise approach would involve weighting by league strength, but that’s complicated and I don’t want to do it.</p>
<p>Nonetheless, I think the ratings look pretty reasonable, and when we split the top ten overall desirability scores into their component parts, visualised below, we can see how the three offensive components are balanced.</p>
<div class="cell">
<details class="code-fold">
<summary>Plot Code (Click to Expand)</summary>
<div class="sourceCode cell-code" id="cb13" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1">offensive_rating <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-2">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-3">  tidyr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">pivot_longer</span>(</span>
<span id="cb13-4">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">cols =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">7</span>,  </span>
<span id="cb13-5">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">names_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"component"</span>, </span>
<span id="cb13-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values_to =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"value"</span></span>
<span id="cb13-7">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-8">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb13-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">component =</span> </span>
<span id="cb13-10">      <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">factor</span>(</span>
<span id="cb13-11">        component, </span>
<span id="cb13-12">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">levels =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Goal Threat"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Chance Creation"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Ball Progression"</span>)</span>
<span id="cb13-13">        )</span>
<span id="cb13-14">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|&gt;</span> </span>
<span id="cb13-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">ggplot</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">aes</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">reorder</span>(Player, Overall), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> value, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">fill =</span> component)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> </span>
<span id="cb13-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_col</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">position =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">position_dodge2</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">reverse =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.4</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-17">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">geom_hline</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">yintercept =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey20"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">linewidth =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.8</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-18">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">coord_flip</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-19">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_x_discrete</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">labels =</span> scales<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">label_wrap</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">12</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-20">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">scale_fill_manual</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">values =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#026E99"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#D93649"</span>, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"#FCCE26"</span>)) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-21">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">labs</span>(</span>
<span id="cb13-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">title =</span> </span>
<span id="cb13-23">        <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Component Desirability Scores for the Offensive Ratings' Best Players"</span>,</span>
<span id="cb13-24">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">subtitle =</span> </span>
<span id="cb13-25">      stringr<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">str_wrap</span>(</span>
<span id="cb13-26">        glue<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">glue</span>(</span>
<span id="cb13-27">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The component desirability scores for the top ten players in the "</span>,</span>
<span id="cb13-28">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"offensive ratings in the big five leagues for the 2022/23 season. "</span>,</span>
<span id="cb13-29">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"The overall ratings are a weighted average of the desirability scores "</span>,</span>
<span id="cb13-30">          <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"for goal threat (50%), chance creation (25%), and ball progression (25%)."</span></span>
<span id="cb13-31">          ),</span>
<span id="cb13-32">        <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">width =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">95</span></span>
<span id="cb13-33">      ),</span>
<span id="cb13-34">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">x =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">NULL</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">y =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Desirability"</span>,</span>
<span id="cb13-35">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">caption =</span> </span>
<span id="cb13-36">      <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Visualisation: Paul Johnson  |  Data: FB Ref Via {worldfootballR}"</span></span>
<span id="cb13-37">    ) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span></span>
<span id="cb13-38">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">theme</span>(</span>
<span id="cb13-39">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">panel.grid.major.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb13-40">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.ticks.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_blank</span>(),</span>
<span id="cb13-41">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">axis.text.y =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">element_text</span>(</span>
<span id="cb13-42">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">colour =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"grey30"</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">size =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">rel</span>(<span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">1.15</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">hjust =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.5</span>, </span>
<span id="cb13-43">      <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">margin =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">margin</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">r =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">15</span>, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">l =</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">8</span>), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">lineheight =</span> .<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">4</span></span>
<span id="cb13-44">      )</span>
<span id="cb13-45">    )</span></code></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/offensive-components-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions/index_files/figure-html/offensive-components-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="limitations" class="level1">
<h1>Limitations</h1>
<p>I think the appeal of desirability functions is their simplicity, but this is also a constraint. As the complexity of the multivariate optimisation problem increases, the solutions will need to scale similarly. While desirability functions are a quick and easy optimisation method that can perform well in many contexts, I don’t think they’re suitable when dealing with the most complex, multidimensional problems. Developing a precise, reliable rating system for offensive players would probably involve doing something more complicated than desirability functions!</p>
<p>Scaling can improve the performance of desirability functions when dealing with complex optimisation problems, but deciding when and how to use them is difficult. It is more of an art than a science. Consequentially, scaling features risk encouraging searching for results that feel good. If you have theory-driven expectations of the weighted combination of a set of variables, you stand a better chance of avoiding results that confirm your biases but it is difficult to validate desirability functions outside of eyeballing the results and deciding whether they seem right.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I am generally pretty sceptical of player rating systems in football. Capturing a multidimensional context like this is difficult using a single measure of player performance. And yet here I am, developing a player rating system that attempts to do exactly that! In my defense, I have at least limited these ratings to offense, which makes it slightly better<sup>3</sup>, and it’s a lot easier to rate players over an entire season than a single match. But I’d take these results with a big pinch of salt. I would include several caveats if I released these ratings into the wild, for the non-nerds (there is no chance anyone but nerds is reading this). These ratings are going to be pretty noisy! That said, I don’t think the results are complete garbage, which meets the high standard I set for my work.</p>
<p>Hopefully, these ratings illustrate how desirability functions work and demonstrate that they could be appropriate in many situations. You don’t see desirability functions used very often, but they are quick and easy, and they can be pretty effective.</p>
</section>



<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@dancristianpaduret">Dan Cristian Pădureț</a> on <a href="https://unsplash.com/photos/a-blackboard-with-a-bunch-of-diagrams-on-it-h3kuhYUCE9A">Unsplash</a>.</p>



</div></section><section class="quarto-appendix-contents" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0">
<div id="ref-derringer1980" class="csl-entry">
Derringer, George, and Ronald Suich. 1980. <span>“Simultaneous Optimization of Several Response Variables.”</span> <em>Journal of Quality Technology</em> 12 (4): 214–19.
</div>
<div id="ref-harrington1965" class="csl-entry">
Harrington, E. C. 1965. <span>“The Desirability Function.”</span> <em>Industrial Quality Control</em> 21: 494–98.
</div>
<div id="ref-kuhn2016" class="csl-entry">
Kuhn, Max. 2016. <span>“The Desirability Package.”</span> <a href="https://cran.r-project.org/web/packages/desirability/vignettes/desirability.pdf">https://cran.r-project.org/web/packages/desirability/vignettes/desirability.pdf</a>.
</div>
<div id="ref-kuhn2023" class="csl-entry">
———. 2023. <span>“Desirability Functions for Multiparameter Optimization - /<span class="nocase">desirability2/</span>.”</span> <a href="https://desirability2.tidymodels.org/">https://desirability2.tidymodels.org/</a>.
</div>
<div id="ref-kuhn2019" class="csl-entry">
Kuhn, Max, and Kjell Johnson. 2019. <em>Feature Engineering and Selection: A Practical Approach for Predictive Models</em>. Taylor &amp; Francis. <a href="https://bookdown.org/max/FES/">https://bookdown.org/max/FES/</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>With <img src="https://latex.codecogs.com/png.latex?%5Cboldsymbol%7BR%7D"> variables being simultaneously optimised, denoted <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)%0A(r%20=%201%20...%20R)">, each must be individually optimised using a desirability function that approaches 1 when <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)"> is optimal and approaches 0 when <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)"> is unacceptable. The optimisation function for minimising <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)"> <span class="citation" data-cites="kuhn2016">(Kuhn 2016)</span> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%20%20d_%7Br%7D%5E%7Bmin%7D=%5Cbegin%7Bcases%7D%0A%20%200%20&amp;%20%5Ctext%7Bif%20$f_r(%5Cboldsymbol%7BX%7D)%20%3E%20B$%7D%5C%5C%0A%20%20(%5Cfrac%7Bf_%7Br%7D(%5Cboldsymbol%7BX%7D)-B%7D%7BA-B%7D)%5E%7Bs%7D%20&amp;%20%5Ctext%7Bif%20$A%20%5Cleq%20f_%7Br%7D(%5Cboldsymbol%7BX%7D)%20%5Cleq%20B$%7D%5C%5C%0A%20%201%20&amp;%20%5Ctext%7Bif%20$f_r(%5Cboldsymbol%7BX%7D)%20%3C%20A$%7D%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?A"> and <img src="https://latex.codecogs.com/png.latex?B"> specify the minimum and maximum value that <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)"> can reach, and <img src="https://latex.codecogs.com/png.latex?s"> is a scaling feature that makes it easier (<img src="https://latex.codecogs.com/png.latex?s%20%3E%201">) or harder (<img src="https://latex.codecogs.com/png.latex?s%20%3C%201">) to achieve maximal desirability.</p>
<p>The optimisation function for maximising <img src="https://latex.codecogs.com/png.latex?f_%7Br%7D(%5Cboldsymbol%7BX%7D)"> <span class="citation" data-cites="kuhn2016">(Kuhn 2016)</span> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%0A%5Cbegin%7Bequation%7D%0A%20%20d_%7Br%7D%5E%7Bmax%7D=%5Cbegin%7Bcases%7D%0A%20%200%20&amp;%20%5Ctext%7Bif%20$f_r(%5Cboldsymbol%7BX%7D)%20%3C%20A$%7D%5C%5C%0A%20%20(%5Cfrac%7Bf_%7Br%7D(%5Cboldsymbol%7BX%7D)-A%7D%7BB-A%7D)%5E%7Bs%7D%20&amp;%20%5Ctext%7Bif%20$A%20%5Cleq%20f_%7Br%7D(%5Cboldsymbol%7BX%7D)%20%5Cleq%20B$%7D%5C%5C%0A%20%201%20&amp;%20%5Ctext%7Bif%20$f_r(%5Cboldsymbol%7BX%7D)%20%3E%20B$%7D%0A%20%20%5Cend%7Bcases%7D%0A%5Cend%7Bequation%7D%0A"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?A">, <img src="https://latex.codecogs.com/png.latex?B">, and <img src="https://latex.codecogs.com/png.latex?s"> are again the minimum and maximum values and the scaling feature.↩︎</p></li>
<li id="fn2"><p>The arithmetic mean is the typical mean average value that people are used to seeing, which sums all values and divides the sum by the sample size, <img src="https://latex.codecogs.com/png.latex?n">, while the geometric mean multiplies all values, before taking the <img src="https://latex.codecogs.com/png.latex?n">th root (the <img src="https://latex.codecogs.com/png.latex?n"> being the number of values multiplied) of that product. Both arithmetic and geometric mean are measures of central tendency, but geometric mean is more robust when dealing with non-independent values, less responsive to outliers, and more capable of handling skewed data.↩︎</p></li>
<li id="fn3"><p>Defensive event data does not reflect performance and is more of a measure of team and player style.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2024" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2024. <span>“Developing Offensive Ratings Using
Desirability Functions.”</span> February 22, 2024. <a href="https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions">https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions</a>.
</div></div></section></div> ]]></description>
  <category>Desirability Functions</category>
  <category>Optimisation</category>
  <category>Football Analytics</category>
  <category>Data Science</category>
  <category>R</category>
  <guid>https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions/</guid>
  <pubDate>Thu, 22 Feb 2024 00:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2024-02-22-football-ratings-using-desirability-functions/math.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>A Cheatsheet for Building Multilevel Models in R</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>Multilevel models (MLMs) are hard. Some part of the difficulty is due to the fact that multilevel data structures add an extra layer of complexity conceptually and mathematically, and therefore the appropriate model structure for this kind of data is also more complex. However, there’s plenty about them that just seems needlessly hard.</p>
<p>Oh would you like to make a multilevel model or a hierarchical model? But have you considered a generalized linear mixed effects model? What about a variance component model? WHAT DO YOU MEAN THEY’RE THE SAME THING?!<sup>1</sup> That can’t possibly be true. Why would anyone in statistics or the sciences make anything needlessly convoluted and use different names for the same concepts? Thankfully things are much simpler when it comes to discussing fixed and random effects. Just a couple concepts with precise meaning and usage in every field… Wait, what? Oh you’ve got be fucking kidding me.</p>
<p>So I thought I’d try and make things a little easier for anyone taking their first steps into this fresh hell, and for anyone (like me) that has a mushy, liquefied brain and needs a refresher any time they haven’t looked at something every single day for the last two years.</p>
<p>I’m not going to write a full introduction, or a detailed how-to for constructing multilevel models, because a) that sounds long as hell and b) there are much smarter people than I that have already done these things (resources are linked at the end of the post). This will just serve as a quick explainer of what MLMs are, when you need them, and the syntax for constructing the most basic (and most common) types of MLMs in R. The goal is to keep this relatively short and make it accessible for folks without intensive statistics backgrounds. Therefore, I will attempt to keep the notation to the minimum, explaining model structures and using examples to illustrate. I have included <em>some</em> notation, but I’ve kept it hidden to make this cheatsheet<sup>2</sup> a little bit less intimidating. If you fancy your chances, you can expand the notation sections.</p>
<p>I won’t go into the details about fitting, interpreting, and validating multilevel models here, but I will possibly turn this into a series, and if so I will get in to it in the next blog post. LFG!!!</p>
<section id="what-are-multilevel-models" class="level1">
<h1>What are Multilevel Models?</h1>
<p>A common feature of many real-world questions that practitioners might study is that there are multiple “levels” around which the data is structured. A dataset may contain observations at a unit-level, with a higher-level variable that specifies a group that those observations belong to (for example, patients being treated by a certain doctor or in a certain hospital, or political parties operating in different countries). Figure&nbsp;1 below is a visual representation of how multilevel data might be structured.</p>
<div class="cell" data-eval="true" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-multilevel-data" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multilevel-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-multilevel-data">graph TB
  A([Group 1]) --&gt; B[Unit 1]
  A --&gt; C[Unit 2]
  A --&gt; D[Unit 3]
  E([Group 2]) --&gt; F[Unit 4]
  E --&gt; G[Unit 5]
  E --&gt; H[Unit 6]
  I([Group 3]) --&gt; J[Unit 7]
  I --&gt; K[Unit 8]
  I --&gt; L[Unit 9]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multilevel-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Data With Hierarchical Grouping Structure
</figcaption>
</figure>
</div>
</div>
</div>
<p>Assuming that the grouping variable is relevant to the outcome being studied, this means that some observations will be correlated with each other, or clustered around the groups they belong to, which invites bias into any model that doesn’t account for this clustering. Multilevel models are regression models that handle data which is structured in groups.<sup>3</sup></p>
<details>
<summary>
Notation
</summary>
<p>There are a few different ways that you might see multilevel models represented notationally, but when talking about the most general form of MLMs, the easiest way is using matrix notation:</p>
<p><img src="https://latex.codecogs.com/png.latex?Y%20=%20%5Calpha%20+%20X%5Cbeta%20+%20Z%5Cgamma%20+%20%5Cepsilon"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?Y"> is a vector of observed values in the outcome variable, <img src="https://latex.codecogs.com/png.latex?X"> is a matrix of predictors and <img src="https://latex.codecogs.com/png.latex?Z"> is a matrix that refers to group-level deviation of the predictors (either in terms of the intercept or slope). <img src="https://latex.codecogs.com/png.latex?%5Calpha"> refers to the global intercept, <img src="https://latex.codecogs.com/png.latex?%5Cbeta"> represents the vector of fixed effects parameters, <img src="https://latex.codecogs.com/png.latex?%5Cgamma"> represents the vector of random effects, and <img src="https://latex.codecogs.com/png.latex?%5Cepsilon"> refers to the model’s error term.</p>
<p>However, I think it is generally easier to think about multilevel models in terms of the different levels that are being estimated in the model, and instead, throughout this blog post, I will give the level 1 and level 2 formulas for each model (we won’t go deeper than two levels for now, because I’m not a total monster).</p>
</details>
<section id="its-mlms-all-the-way-down" class="level2">
<h2 class="anchored" data-anchor-id="its-mlms-all-the-way-down">It’s MLMs All The Way Down</h2>
<p>There is lots of confusing and sometimes contradictory terminology that is used when talking about multilevel models.</p>
<section id="fixed-random-effects" class="level3">
<h3 class="anchored" data-anchor-id="fixed-random-effects">Fixed &amp; Random Effects</h3>
<p>When discussing the ways that an effect can occur at different levels in a multilevel model, people will often refer to fixed and random effects. Fixed effects are those that are fixed across groups, or that are the same for every cluster, while the random effects are those that deviate between groups. The fixed and random effects could refer to either the intercept or the slope, as these can both vary between groups, and can in some cases both vary at the same time.</p>
<p>However, as <a href="https://statmodeling.stat.columbia.edu/2005/01/25/why_i_dont_use/">Andrew Gelman has argued</a>, these terms are sometimes used to refer to slightly different things, and this can lead to some confusion. So whenever you see someone refer to fixed or random effects, be aware that there may be some variance in how these terms are being used.</p>
<p>An alternative terminology, that possibly carries less confusion, is population- and group-level effects. When the variable is constant across groups/clusters and the effect varies at a unit-level (fixed-effect), this is referred to as a population-level effect. However, when the variable’s effect varies across groups/clusters (random-effect) then it is a group-level effect.</p>
<p>For the remainder of this blog post I will use this population- and group-level terminology.</p>
</section>
<section id="linear-mixed-models-vs-multilevel-models" class="level3">
<h3 class="anchored" data-anchor-id="linear-mixed-models-vs-multilevel-models">Linear Mixed Models vs Multilevel Models</h3>
<p>There are some slight differences between what a linear mixed model might refer to,<sup>4</sup> and what a hierarchical or multilevel model<sup>5</sup> might refer to, but on the whole I think it is safe to treat them (generally speaking) as the same thing, with an understanding that multilevel models are any models where there are grouping structures that lead to the data violating the independence assumption, and hierarchical grouping structures are just one type of such structure.</p>
<p>An example of a context where you might see a grouping structure that isn’t hierarchical/nested is data where individuals are measured repeatedly, like, for example, a dataset containing repeated polling of individual’s views on a political candidate or issue (panel data). In this case, there is no hierarchical structure, but the grouping structure is the individual.</p>
</section>
</section>
</section>
<section id="multilevel-model-syntax-in-r" class="level1">
<h1>Multilevel Model Syntax in R</h1>
<p>The good thing about the R syntax I detail in this section is that it is the same for <em>lme4</em>, the main package for frequentist multilevel models, and the same for <em>brms</em> and <em>rstanarm</em>, two of the most popular packages for computing Bayesian multilevel models.</p>
<p>The basic structure of multilevel models in R is very similar to typical <code>lm()</code> formulae, using <code>y ~ x1 + x2 ... + xn</code>, but in addition to this, the MLM syntax accounts for a grouping structure in the data using the pipe: |.</p>
<p>Below are some examples of simple multilevel model structures, where <code>x</code> refers to a unit-level variable and <code>g</code> refers to the group variable. Figure&nbsp;2 demonstrates visually the multilevel models that will be covered.</p>
<div id="fig-mlm" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mlm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<a href="mlm_example.png" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1"><img src="https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet/mlm_example.png" class="img-fluid figure-img"></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mlm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Multilevel Data Structures (Source: <a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman &amp; Hill (2006)</a>)
</figcaption>
</figure>
</div>
<section id="varyings-intercepts" class="level2">
<h2 class="anchored" data-anchor-id="varyings-intercepts">Varyings Intercepts</h2>
<p>The simplest kind of model you can specify with a grouping structure is one which models a grouping structure with deviance from the global intercept, but no unit-level predictors. This means that the intercept is allowed to vary between groups (for example, patient outcomes in different hospitals), around the mean intercept of all groups (the global intercept). This is often referred to as a null model, or a varying (random) intercepts model.</p>
<p>This can be specified as such:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>g)</span></code></pre></div>
</div>
<p>The <code>1</code> outside of the brackets here specifies the fixed mean global intercept, and the <code>(1|g1)</code> specifies that the grouping structure produces intercepts that vary for each group.</p>
<details>
<summary>
Notation
</summary>
<p><img src="https://latex.codecogs.com/png.latex?y_%7Bij%7D%20=%20%5Calpha_%7Bj%7D%20+%20%20%5Cepsilon_%7Bij%7D"></p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D"> refers to the intercept (<img src="https://latex.codecogs.com/png.latex?%5Calpha">) for every group (<img src="https://latex.codecogs.com/png.latex?j">), meaning that every group <img src="https://latex.codecogs.com/png.latex?j"> has its own intercept. The formula for <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D"> can be written as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D%20=%20%5Cgamma_%7B00%7D%20+%20%5Cmu_%7B0j%7D"></p>
<p>This formula is the group level intercept variance, explaining the <img src="https://latex.codecogs.com/png.latex?j">th group’s deviation from the mean global intercept, with <img src="https://latex.codecogs.com/png.latex?%5Cgamma_%7B00%7D"> representing the mean global intercept, and <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B0j%7D"> representing the deviance from the mean intercept.</p>
</details>
<section id="adding-population-effects" class="level3">
<h3 class="anchored" data-anchor-id="adding-population-effects">Adding Population Effects</h3>
<p>While the previous model only included a group-level effect that caused deviance from the global intercept, there was no population-level effect in the model. If we add a population-level effect <img src="https://latex.codecogs.com/png.latex?x"> to the model, we get the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1">y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>g)</span></code></pre></div>
</div>
<p>This is a pretty typical multilevel model that you’ll see plenty of examples of in the real-world and find plenty of use for when implementing MLMs yourself.</p>
<details>
<summary>
Notation
</summary>
<p><img src="https://latex.codecogs.com/png.latex?y_%7Bij%7D%20=%20%5Calpha_%7Bj%7D%20+%20%5Cbeta_%7B1j%7Dx_%7Bij%7D%20+%20%5Cepsilon_%7Bij%7D"></p>
<p>This is the level one formula for the value of <img src="https://latex.codecogs.com/png.latex?y"> indexed by <img src="https://latex.codecogs.com/png.latex?i"> units and <img src="https://latex.codecogs.com/png.latex?j"> groups.</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D"> refers to the intercept (<img src="https://latex.codecogs.com/png.latex?%5Calpha_%7B%7D">) for every group (<img src="https://latex.codecogs.com/png.latex?j">), meaning that every group <img src="https://latex.codecogs.com/png.latex?j"> has its own intercept. The formula for <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D"> can be written as follows:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D%20=%20%5Cgamma_%7B00%7D%20+%20%5Cmu_%7B0j%7D"></p>
<p>And the formula for <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D"> is:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D%20=%20%5Cgamma_%7B10%7D"></p>
<p>These two formulas are the second level of the model, with <img src="https://latex.codecogs.com/png.latex?%5Calpha_j"> explaining the <img src="https://latex.codecogs.com/png.latex?j">th group’s deviation from the global intercept, when there are varying intercepts, with <img src="https://latex.codecogs.com/png.latex?%5Cgamma_%7B00%7D"> representing the global_intercept, and <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B0j%7D"> representing the deviance from the mean intercept, and <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D"> explaining the unit-level variance of <img src="https://latex.codecogs.com/png.latex?x">, with <img src="https://latex.codecogs.com/png.latex?%5Cgamma_%7B10%7D"> representing the population-effect for the slope of <img src="https://latex.codecogs.com/png.latex?x">.</p>
</details>
</section>
</section>
<section id="varying-slopes" class="level2">
<h2 class="anchored" data-anchor-id="varying-slopes">Varying Slopes</h2>
<p>Sometimes there will be an expectation that the grouping structure has no effect on the intercept, but that the slope will vary between groups (though this kind of model is generally less common). The following model structure will do the job, in those instances:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">0</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>g)</span></code></pre></div>
</div>
<p>The default structure in multilevel modelling is to include a varying intercept, which is represented by the 1 that sits inside the brackets in the code, (1|g). If you don’t want to include a varying intercept, then a 0 is required to override this default.</p>
<p>While possibly less common than a varying intercepts model, I think it is also useful to understand how a varying slopes model is structured, in order to get a better understanding of how MLMs work both conceptually and technically.</p>
<details>
<summary>
Notation
</summary>
<p>If the intercepts are fixed and the slopes vary, then the formula would be slightly different to the one presented earlier:</p>
<p><img src="https://latex.codecogs.com/png.latex?y_%7Bij%7D%20=%20%5Calpha_j%20+%20%5Cbeta_%7B1j%7Dx_i%20+%20%5Cepsilon_%7Bij%7D"></p>
<p>The differences lie in the second level formulas:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_j"> would be written as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_j%20=%20%5Cgamma_%7B00%7D"></p>
<p>While the formulas for <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D"> would be written as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D%20=%20%5Cgamma_%7B10%7D%20+%20%5Cmu_%7B1j%7D"></p>
<p>The difference here is that the <img src="https://latex.codecogs.com/png.latex?%5Calpha_j"> no longer has a <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B0j%7D"> term, because there is no group-level deviation around the global intercept, while <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D"> has a <img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B1j%7D"> term, representing the <img src="https://latex.codecogs.com/png.latex?j">th group’s deviation from the global mean of the slope.</p>
</details>
</section>
<section id="varying-intercepts-slopes" class="level2">
<h2 class="anchored" data-anchor-id="varying-intercepts-slopes">Varying Intercepts &amp; Slopes</h2>
<p>And once you’ve figured out how to build a model that varies either the intercepts or the slopes, you can then let it all hang out and just let the groups do whatever the hell they want, in the form of both varying intercepts AND slopes.</p>
<p>The syntax for this kind of structured madness is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># correlated intercepts and slopes</span></span>
<span id="cb4-2">y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">1</span> <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">|</span>g)</span>
<span id="cb4-3"></span>
<span id="cb4-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># uncorrelated intercepts and slopes</span></span>
<span id="cb4-5">y <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">+</span> (x<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">||</span>g)</span></code></pre></div>
</div>
<p>I think the previous section, detailing the structure and syntax of a varying slopes model, really helps figure things out when presented in conjunction with this model structure. The incremental changes that lead to different types of models should help to identify which components do what.</p>
<details>
<summary>
Notation
</summary>
<p>As you might expect, the formula for a multilevel model with both varying intercepts and slopes will look like a combination of the previous two examples:</p>
<p><img src="https://latex.codecogs.com/png.latex?y_%7Bij%7D%20=%20%5Calpha_%7Bj%7D%20+%20%5Cbeta_%7B1j%7Dx_i%20+%20%5Cepsilon_%7Bij%7D"></p>
<p>where <img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D"> (the intercept) can be expanded as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Calpha_%7Bj%7D%20=%20%5Cgamma_%7B00%7D%20+%20%5Cmu_%7B0j%7D"></p>
<p>and where <img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D"> (the slope) can be expanded as:</p>
<p><img src="https://latex.codecogs.com/png.latex?%5Cbeta_%7B1j%7D%20=%20%5Cgamma_%7B10%7D%20+%20%5Cmu_%7B1j%7D"></p>
<p>Hopefully by now the multilevel model structure is starting to make some sense. The distinction between the previous models and this model formula, that makes it a varying intercepts and slopes model, is the fact that there is a term for the variance from the global mean in both the second-level formula for the intercept (<img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B0j%7D">) and the slope ((<img src="https://latex.codecogs.com/png.latex?%5Cmu_%7B1j%7D">)).</p>
</details>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>So I’ve laid out the basic structure of multilevel modelling, hopefully making it easier to figure out the syntax in R, and build some simple MLMs. Things can quickly get more and more complicated when you start adding multiple grouping structures, or as you add multiple predictors and interactions, but the basics laid out in this article should be enough to get you started building multilevel models. In future blog posts (making some strong assumptions about my commitment to this bit) I will take a look at how to fit and interpret these simple multilevel models, using simulated data.</p>
<p>There’s lots of ways you can specify a multilevel model that involve vast complex grouping structures nested between each other or crossed with population-level effects. However, more often than not, I think you will get away with just using a simple structure, particularly the varying intercepts model. This will get you most of the way there, especially while you’re learning your way with multilevel modelling. Once you’re more comfortable with the idea conceptually and technically? You can start to make a real mess!</p>
<p>Given how complex things can get with MLMs, this cheatsheet is obviously only scratching the surface. Therefore, in the interest of not leaving anyone with a thirst-for-the-learn hanging, here’s a few resources to help along the way:</p>
<ul>
<li><a href="https://www.learn-mlms.com/">Shaw &amp; Flake - Introduction to Multilevel Modelling</a></li>
<li><a href="http://www.stat.columbia.edu/~gelman/arm/">Gelman &amp; Hill - Data Analysis Using Regression and Multilevel/Hierarchical Models</a></li>
<li><a href="http://www.stat.columbia.edu/~gelman/armm/">Gelman et al.&nbsp;- Applied Regression and Multilevel Models</a><sup>6</sup></li>
<li><a href="https://paul-buerkner.github.io/brms/articles/index.html">{brms} Vignettes</a></li>
</ul>
</section>



<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@gecko81de">Patrick Baum</a> on <a href="https://unsplash.com/photos/bottom-view-of-glass-building-EOzW3UVBKSI">Unsplash</a>.</p>



</div></section><section id="footnotes" class="footnotes footnotes-end-of-document"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There are some minor distinctions, but the terms are often used interchangeably.↩︎</p></li>
<li id="fn2"><p>Does a blog post get to call itself a cheatsheet?↩︎</p></li>
<li id="fn3"><p>There are alternative ways to handle clustered data, such as cluster-robust standard errors, but I won’t cover that here. If you’re interested in learning about these methods, I’d recommend the discussion in <a href="https://www.learn-mlms.com/03-module-3.html#cluster-robust-standard-errors">Chapter 3 of Introduction to Multilevel Modelling</a>, or this <a href="https://mldscenter.maryland.gov/egov/Publications/ResearchSeries/Clustered%20Data,%20Are%20Multilevel%20Models%20Really%20Necessary.pdf">overview</a> that is linked in the discussion.↩︎</p></li>
<li id="fn4"><p>A linear mixed model can refer to any model that contains a group/clustering structure, and it does not have to be a group that is organised hierarchically, or nested.↩︎</p></li>
<li id="fn5"><p>Hierarchical/multilevel models suggest that there might be a vertical hierarchy that explains the grouping structure in the data, for example, student test results are nested within a class or school grouping structure.↩︎</p></li>
<li id="fn6"><p>ARMM hasn’t been published (released?) yet, but it is billed as the updated and expanded second edition of Gelman &amp; Hill’s book. It’s worth keeping an eye out for when this is released, because I’m sure it will be an excellent resource.↩︎</p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“A Cheatsheet for Building Multilevel Models
in R.”</span> November 1, 2022. <a href="https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet">https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet</a>.
</div></div></section></div> ]]></description>
  <category>Statistics</category>
  <category>Data Science</category>
  <category>Multilevel Models</category>
  <category>R</category>
  <guid>https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet/</guid>
  <pubDate>Tue, 01 Nov 2022 00:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-11-01-multilevel-model-r-cheatsheet/hierarchy.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Rendering Mermaid Diagrams on a Hugo Website Using Quarto</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-09-17-rendering-mermaid-diagrams-using-quarto-and-hugo/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p><strong>Note: Having ported my site over to Quarto in entirety, this blog post no longer applies to the site as is. There are some inconsistencies with some of the issues it talks about and how the site looks now (for example, there is no longer an option to toggle a dark theme), but the advice in this post should hopefully still work for anyone that is using Quarto with Hugo!</strong></p>
<p>I find a lot of the methods for drawing diagrams and flow charts using code to be a bit of a nightmare. I’m not sure what it is, perhaps I’m just a bit stupid, but they always seem a little more convoluted than I can handle. It’s possible that the design is actually of some value when it comes to drawing diagrams that are much larger and more complicated than I am generally dealing with, but in my case, it always seems to be a lot of work for what little I’m trying to do.</p>
<p>The easiest, most intuitive way that I’ve come across is using a JavaScript library called Mermaid. It’s just very easy, and the diagrams look great. Even better is the fact that it works with a lot of Markdown formats, and it’s even one of the diagram formats that Quarto can handle.</p>
<p>One issue that I came across, however, is that Mermaid diagrams don’t render when you’re using Quarto to create Hugo Markdown files for a Hugo website. You do have some simple options to resolve this, such as setting the <code>mermaid-format</code> to PNG or SVG in the article front matter, but with just a little extra work, you can get Mermaid working perfectly on your Hugo website.</p>
<section id="setting-up-hugo-to-support-mermaid" class="level1">
<h1>Setting up Hugo to Support Mermaid</h1>
<p>Steps for setting up Hugo to support Mermaid are detailed in the <a href="https://gohugo.io/content-management/diagrams/">Hugo documentation</a>, however that didn’t seem to work for me (producing errors when Netlify tries to publish the site). Instead, I had to take a slightly different approach, which was inspired by Kevin Wu’s <a href="https://kvwu.io/posts/hugo-shortcode/">blog post</a> about using Mermaid with Hugo. This <strong>should</strong> work for others, but if it doesn’t, please lets just assume that it is either Kevin’s fault, or your fault, but definitely not my fault.</p>
<p>First, create a HTML file <code>/layours/partials/mermaid.html</code>, and add the following code, which specifies where to find Mermaid and how it should be loaded (in this case I’ve specified the dark theme, but there’s a few different options):</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb1-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;"> src</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span>
<span id="cb1-2"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span>mermaid<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">.</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initialize</span>({<span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">startOnLoad</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">true</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">theme</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">:</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"neutral"</span> })<span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">;</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&lt;/</span><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">script</span><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">&gt;</span></span></code></pre></div>
<p>Following this, a snippet needs to be added to one of the partial layouts that will be used in your content pages. I added it to the <code>extend_head.html</code> file (which, as the name helpfully suggests, is just an extension of <code>head.html</code>). This snippet just tells Hugo that, when Mermaid is called in the frontmatter, it needs to use the <code>mermaid.html</code> partial you just created.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb2-1">{{ if .Page.Params.mermaid }}</span>
<span id="cb2-2">{{ partial "mermaid.html" . }}</span>
<span id="cb2-3">{{ end }}</span></code></pre></div>
<p>This can either be added to the existing theme partial, located in <code>themes/&lt;theme-name&gt;/layouts/partials</code>, or it can be in the global <code>layouts/partials</code> directory, which will override your theme.</p>
<p>Now, you just have to add <code>mermaid: true</code> to the YAML frontmatter for any page that contains a Mermaid code block, and you’re good to go!</p>
</section>
<section id="rendering-mermaid-using-quarto" class="level1">
<h1>Rendering Mermaid Using Quarto</h1>
<p>Once you’ve set Hugo up to handle Mermaid code blocks, you would think it should then render like other code chunks in Quarto, and you would be right. Mermaid is very good.</p>
<p>I find that I sometimes have to render the Quarto document a couple times for Mermaid diagrams to show up, or for changes to render properly, but that’s about the only issue that I’ve come up against.</p>
<section id="flowcharts" class="level2">
<h2 class="anchored" data-anchor-id="flowcharts">Flowcharts</h2>
<p>The diagram I will get the most use out of is flowcharts, and Mermaid makes them really easy.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb3-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{mermaid}</span></span>
<span id="cb3-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| label: fig-mermaid-flowchart</span></span>
<span id="cb3-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| fig-cap: Wow look how it flows.</span></span>
<span id="cb3-4"></span>
<span id="cb3-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">graph LR</span></span>
<span id="cb3-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    A([Oooh]) --&gt; B([Would You])</span></span>
<span id="cb3-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    B --&gt; C([Look at This])</span></span>
<span id="cb3-8"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    C --&gt; D[Very]</span></span>
<span id="cb3-9"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    C --&gt; E[Fancy]</span></span>
<span id="cb3-10"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    C --&gt; F[Flowchart]</span></span>
<span id="cb3-11"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-mermaid-flowchart" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-flowchart">graph LR
    A([Oooh]) --&gt; B([Would You])
    B --&gt; C([Look at This])
    C --&gt; D[Very]
    C --&gt; E[Fancy]
    C --&gt; F[Flowchart]
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Wow look how it flows.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="gantt-charts" class="level2">
<h2 class="anchored" data-anchor-id="gantt-charts">Gantt Charts</h2>
<p>If Figure&nbsp;1 isn’t enough to convince you, how about some Gantt charts?</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb4-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{mermaid}</span></span>
<span id="cb4-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| label: fig-mermaid-gantt</span></span>
<span id="cb4-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| fig-cap: Oh you real fancy huh?</span></span>
<span id="cb4-4"></span>
<span id="cb4-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%{init: {'theme': 'default', 'themeVariables': { 'textColor': '#798189'}}}%%</span></span>
<span id="cb4-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">gantt</span></span>
<span id="cb4-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    title Big Ol' Gantts</span></span>
<span id="cb4-8"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    dateFormat  YYYY-MM-DD</span></span>
<span id="cb4-9"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    section Section</span></span>
<span id="cb4-10"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Some Normal Tasks : done, a1, 2022-09-01, 15d</span></span>
<span id="cb4-11"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    But Wait, There's More! :after a1, 20d</span></span>
<span id="cb4-12"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    section And ANOTHER</span></span>
<span id="cb4-13"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    Deary Me, It's Never Ending : crit, 2022-10-01, 20d</span></span>
<span id="cb4-14"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">    I Hate This Project : 14d</span></span>
<span id="cb4-15"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-mermaid-gantt" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-gantt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-gantt">%%{init: {'theme': 'default', 'themeVariables': { 'textColor': '#798189'}}}%%
gantt
    title Big Ol' Gantts
    dateFormat  YYYY-MM-DD
    section Section
    Some Normal Tasks : done, a1, 2022-09-01, 15d
    But Wait, There's More! :after a1, 20d
    section And ANOTHER
    Deary Me, It's Never Ending : crit, 2022-10-01, 20d
    I Hate This Project : 14d
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-gantt-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Oh you real fancy huh?
</figcaption>
</figure>
</div>
</div>
</div>
<p>The dark and light theme my Hugo site uses doesn’t handle the Gantt chart as well as the other Mermaid diagrams. If I use the neutral Mermaid theme, it doesn’t show as clearly when using the dark Hugo theme, and vice versa with the dark Mermaid theme and light Hugo theme. This isn’t ideal, but you can <a href="https://mermaid-js.github.io/mermaid/#/theming?id=theme-variables-reference-table">customise the appearance</a> of your Mermaid diagrams too.</p>
<p>I’ve stuck with the neutral Mermaid theme for the rest of the site because it seems to be the best fit for flowcharts with the two different Hugo themes, and flowcharts are the diagrams I’m going to be using Mermaid for most often on this site. However, for this Gantt chart I’ve customised the appearance a little, using <code>%%init%%</code>, using the default theme and a grey text colour that works slightly better (though it’s still not brilliant).</p>
</section>
<section id="git-graphs" class="level2">
<h2 class="anchored" data-anchor-id="git-graphs">Git Graphs</h2>
<p>So you’ve got Figure&nbsp;1 to wow people with your idea and Figure&nbsp;2 to manage the project, but now you need some git graphs to show how you broke everything.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb5-1"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```{mermaid}</span></span>
<span id="cb5-2"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| label: fig-mermaid-git</span></span>
<span id="cb5-3"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%%| fig-cap: Git a load of this!</span></span>
<span id="cb5-4"></span>
<span id="cb5-5"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">gitGraph</span></span>
<span id="cb5-6"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-7"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-8"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  branch develop</span></span>
<span id="cb5-9"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  checkout develop</span></span>
<span id="cb5-10"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-11"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-12"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  checkout main</span></span>
<span id="cb5-13"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  merge develop</span></span>
<span id="cb5-14"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-15"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">  commit</span></span>
<span id="cb5-16"><span class="in" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">```</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-mermaid-git" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mermaid-git-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid-git">gitGraph
  commit
  commit
  branch develop
  checkout develop
  commit
  commit
  checkout main
  merge develop
  commit
  commit
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mermaid-git-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Git a load of this!
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>And that’s about all you need to do. Think of all the amazing diagrams you’re going to create and show the world? I, on the other hand, am going to continue to make minimal diagrams that are completely uninspiring. Have fun!</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@daniewizard">Daniella Garcia</a> on <a href="https://unsplash.com/photos/woman-in-black-and-white-bikini-lying-on-white-ceramic-bathtub-jJn9fVPtaNI">Unsplash</a>.</p>


</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Rendering Mermaid Diagrams on a Hugo Website
Using Quarto.”</span> September 17, 2022. <a href="https://paulrjohnson.net/blog/2022-09-17-rendering-mermaid-diagrams-using-quarto-and-hugo">https://paulrjohnson.net/blog/2022-09-17-rendering-mermaid-diagrams-using-quarto-and-hugo</a>.
</div></div></section></div> ]]></description>
  <category>Quarto</category>
  <category>Markdown</category>
  <category>Hugo</category>
  <guid>https://paulrjohnson.net/blog/2022-09-17-rendering-mermaid-diagrams-using-quarto-and-hugo/</guid>
  <pubDate>Fri, 16 Sep 2022 23:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-09-17-rendering-mermaid-diagrams-using-quarto-and-hugo/mermaid.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Setting up a Hugo Website with Quarto</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-09-11-setting-up-hugo-website-with-quarto/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>Like every other nerd that likes R and has used RMarkdown more than one time in their entire life, I am now in the process of transitioning to using Quarto, and I want to let the world know! I wanted to make good use of Quarto, including utilising the really nice job it does with rendering R, Python, Julia, and JavaScript (not that I’m writing a lot of Julia or JavaScript) and outputting it in a HTML document. However, I didn’t want to give up this lovely website I had already put together using Hugo. What a conundrum… Well, it turns out it’s relatively easy to use Quarto with a Hugo site. These folks really have thought of everything!</p>
<p>This isn’t a tutorial for building a Hugo website or building a website from scratch with Quarto. These are more involved processes (though neither are incredibly difficult). If that’s what you’re looking for, here are some links that might point you in the right direction.</p>
<p>Hugo Tutorials:</p>
<ul>
<li><a href="https://gohugo.io/getting-started/quick-start/">Hugo - Quick Start</a></li>
<li><a href="https://www.freecodecamp.org/news/your-first-hugo-blog-a-practical-guide/">freeCodeCamp - How to Create Your First Hugo Blog</a></li>
</ul>
<p>Quarto Tutorials:</p>
<ul>
<li><a href="https://quarto.org/docs/websites/">Quarto - Creating a Website</a></li>
<li><a href="https://beamilz.com/posts/2022-06-05-creating-a-blog-with-quarto/en/">Bea Milz - Creating a Blog with Quarto in 10 Steps</a></li>
<li><a href="https://albert-rapp.de/posts/13_quarto_blog_writing_guide/13_quarto_blog_writing_guide.html">Albert Rapp - The Ultimate Guide to Starting a Quarto Blog</a></li>
</ul>
<p>No, my ambitions with this blog post are considerably less ambitious. I just want to show you how to set your existing Hugo website up so that you can use Quarto to write your blog posts (and any other pages).</p>
<section id="setting-up-hugo-for-quarto-files" class="level1">
<h1>Setting Up Hugo for Quarto Files</h1>
<p>The first step is to make some changes to your ‘config.toml’ file so that it doesn’t try and publish your Quarto documents, whether they are in qmd or ipynb format. You need to add the following code to the file:</p>
<div class="sourceCode" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb1-1"><span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">ignoreFiles</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">[</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.qmd$"</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">,</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"</span><span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">\\</span><span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">.ipynb$"</span> <span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">]</span></span></code></pre></div>
<p>I added it to the opening section of the config file, with the baseUrl, title, theme etc.</p>
<p>You also need to add some configuration to the markup section of the config file, in order to make sure Hugo handles raw HTML appropriately, because R and Python will sometimes give HTML as an output rather than Markdown.</p>
<div class="sourceCode" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode toml code-with-copy"><code class="sourceCode toml"><span id="cb2-1"><span class="kw" style="color: #003B4F;
background-color: null;
font-style: inherit;">[markup.goldmark.renderer]</span></span>
<span id="cb2-2">  <span class="dt" style="color: #AD0000;
background-color: null;
font-style: inherit;">unsafe</span><span class="op" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">=</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">true</span></span></code></pre></div>
<p>This is essentially everything you need to get your Hugo website set up to deal with Quarto without losing its mind.</p>
</section>
<section id="creating-blog-posts" class="level1">
<h1>Creating Blog Posts</h1>
<p>This is the part that I expected to at least be a little bit harder than it turned out to be. Once you have set your config file up, you can now create new posts (and any other pages) in pretty much the same way you did in the before times. In my case, all the blog posts are stored under ‘content/posts’, and it’s the same deal now in this exciting new Quarto world.</p>
<p>Blog posts are written in a qmd file, with the YAML front matter looking much the same as the typical Markdown posts for Hugo sites, with tags, categories, keywords etc., and <code>format: hugo</code> added so that Quarto knows how to render the file. This can be also be added to a ’_quarto.yml’ file, as I have done, if you are treating the site as a Quarto project.</p>
<p>Once you’ve done all this, you can render your Quarto files and it will produce Markdown files that Hugo will publish as blog posts.</p>
</section>
<section id="dont-forget-to-render" class="level1">
<h1>Don’t Forget to Render</h1>
<p>The biggest problem I’ve faced with this process, in the short time since making the change, is that I am a stupid person and that I sometimes do stupid things.</p>
<p>When you’ve written your posts in a qmd file you have to remember to render them as and when you make changes that you want to deploy. I have already managed to forget to do that on a couple occasions, pushing changes that I haven’t rendered, resulting in qmd files that don’t line up with the md file, and therefore don’t show on the site. Think of all the funny things you might write that people won’t get to see, and it’s all your fault.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://media.giphy.com/media/3Mm6HZud4m2oU/giphy.gif#center" class="lightbox" data-glightbox="description: .lightbox-desc-1" data-gallery="quarto-lightbox-gallery-1" title="Spend some time in the shame cube"><img src="https://media.giphy.com/media/3Mm6HZud4m2oU/giphy.gif#center" class="img-fluid figure-img" alt="Spend some time in the shame cube"></a></p>
<figcaption>Spend some time in the shame cube</figcaption>
</figure>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The rendering issue isn’t ideal, because as much as I’d like to believe that I will eventually remember that I need to render before I publish posts, I happen to know that I am a buffoon, so I am certain that I will forget enough that it’s going to be a bit of a nuisance.</p>
<p>This should be something that I can resolve by setting up a GitHub Actions workflow to render files when pushed to the repository. It’s not something I’ve done just yet, mostly because it is 8pm on a Sunday and I can’t be bothered to take that extra step right now. But maybe I’ll write another post about that when I get round to it. Because everything is content and everybody is posting.</p>
<p>However, everything else is exceptionally smooth, and very easy to set up. It takes a matter of minutes to make the change and now your Hugo site can be used with Quarto, making it so much easier to write about and incorporate R, Python, and other programming languages in your blog posts. Great success!</p>



</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Setting up a Hugo Website with
Quarto.”</span> September 11, 2022. <a href="https://paulrjohnson.net/blog/2022-09-11-setting-up-hugo-website-with-quarto">https://paulrjohnson.net/blog/2022-09-11-setting-up-hugo-website-with-quarto</a>.
</div></div></section></div> ]]></description>
  <category>Quarto</category>
  <category>Markdown</category>
  <category>Hugo</category>
  <category>R</category>
  <guid>https://paulrjohnson.net/blog/2022-09-11-setting-up-hugo-website-with-quarto/</guid>
  <pubDate>Sat, 10 Sep 2022 23:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-09-11-setting-up-hugo-website-with-quarto/hugo.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Resources for Learning Bayesian Statistics</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-05-10-learning-bayesian-statistics/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>As a social scientist turned data scientist, my graduate school training taught me a lot of frequentist statistics that has served me well in my career since. However, there’s one thing that frequentist statistics can’t solve, and that’s my lack of a personality. For that, we’ve got Bayesian statistics, the perfect substitute.</p>
<p>I’ve spent the last year or so gradually trying to become more Bayesian in my approach to statistical reasoning and analysis, and while there’s quite a few really good resources for supporting that journey, it can be a little difficult to know where to start. I wanted someone to give me a short reading list that would save me trying to work out which books to use and in what order. In an attempt to fill that gap, I’ve put together a list of resources that I’ve come across and found to be pretty solid. I’ve not worked through each and every one of these cover to cover, but I’ve interacted with them enough to think they’re useful and that someone might be able to learn a lot from them.</p>
<p>Where possible I’ve tried to find stuff that is free and open-source, but that hasn’t been possible in every single case. But in each case I have at least found a freely available resource that is made available by the authors, whether it be the book itself, a video series, or a series of articles.</p>
<section id="becoming-more-bayesian" class="level1">
<h1>Becoming More Bayesian</h1>
<p>These first resources are good starting points for anyone looking to start learning more about Bayesian statistics. They’ve all got plenty of detail, but they focus on making the intuition of Bayesianism a little more approachable.</p>
<section id="statistical-rethinking" class="level2">
<h2 class="anchored" data-anchor-id="statistical-rethinking">Statistical Rethinking</h2>
<p>I think the starting point for everybody, and an all-round great resource for anyone interested in statistics, is Richard McElreath’s <a href="https://xcelab.net/rm/statistical-rethinking/"><em>Statistical Rethinking</em></a>. If you read only one of these books, make it <em>Statistical Rethinking</em>. It’s a great read for anybody interested in statistics and quantitative research.</p>
<p>The focus of <em>Statistical Rethinking</em> is utilizing Bayesian statistics for scientific reasoning/thinking and causal inference. It’s a really great read, in part because it is really accessible while also being pretty thorough too. I particularly like his consistent focus on how these tools apply to scientific models.</p>
<p>Not only is it available as a book, but Richard also makes a <a href="https://www.youtube.com/playlist?list=PLDcUM9US4XdMROZ57-OIRtIK0aOynbgZN">lecture series</a> available on YouTube which can serve as an accompaniment to the book, or can even stand on its own as a good learning resource.</p>
</section>
<section id="students-guide-to-bayesian-statistics" class="level2">
<h2 class="anchored" data-anchor-id="students-guide-to-bayesian-statistics">Student’s Guide to Bayesian Statistics</h2>
<p>Ben Lambert’s <a href="https://ben-lambert.com/a-students-guide-to-bayesian-statistics/"><em>A Student’s Guide to Bayesian Statistics</em></a> is a really good dive into the statistics that underpin Bayesian analysis, and the implementation of the statistical methods. It’s not light on notation, but it does introduce new concepts by first explaining the intuition before laying it out mathematically. I think this book pairs very well with <em>Statistical Rethinking</em>, as they take slightly different approaches, and between the two you cover tons of ground.</p>
<p>You can buy the book on <a href="https://www.amazon.co.uk/Students-Guide-Bayesian-Statistics/dp/1473916364/">Amazon</a> but it isn’t freely available anywhere (that I’ve found). Ben does offer a free <a href="https://youtu.be/P_og8H-VkIY">YouTube course</a> and <a href="https://ben-lambert.com/bayesian-lecture-slides/">lecture notes</a> that mirror the book’s content though. The YouTube course doesn’t offer the kind of detail that the book does, but it is still pretty good.</p>
</section>
<section id="introduction-to-empirical-bayes" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-empirical-bayes">Introduction to Empirical Bayes</h2>
<p>If you’re looking for something to help you apply Bayesian statistics to a real-world situation, or you’re the kind of learner that needs a relatable hook to help you make sense of things (this is me), then David Robinson’s <a href="http://varianceexplained.org/r/empirical-bayes-book/"><em>Introduction to Empirical Bayes</em></a> is the perfect starting point. David applies Empirical Bayes methods (Bayesian approaches where the prior is estimated from the data) in a baseball context, specifically simulating batting averages. Baseball isn’t really the focus of David’s work here, but it serves as a really good medium for couching some quite complicated concepts in terms that people can understand, and thanks to this (and David’s excellent communication of the concepts), it is a really good opening gambit for anyone interested in Bayesian statistics.</p>
<p>The <em>Introduction to Empirical Bayes</em> book started out as a series of <a href="http://varianceexplained.org/statistics/beta_distribution_and_baseball/">blog posts</a> on David’s website, <a href="varianceexplained.org">Variance Explained</a>, and those blog posts are all still freely available, but his e-book also includes an extra chapter, some additional materials across several other chapters, and some minor edits and changes to help simplify things. The book is also available at a “pay-what-you-want” price, which means you can choose to pay nothing, if you can’t afford to pay more, but for those that can, the suggested price is $9.95 (~£8).</p>
<p>I don’t think that David’s e-book/blog posts are the most thorough of the resources listed here, but they’re also not trying to be. Instead, they’re a really good plain(ish)-English explanation of Bayesian concepts, applied to examples that should help a lot of people intuit them a little easier. The use of Empirical Bayes serves as a good first step in the direction of Bayesian approaches, and it is also a good way to learn some really useful methods in real-world data analysis. If you find that some of the other resources are a little hard to wrap your head round, I’d read all of his posts (or buy his book if you can afford to) first, because it might help lay the groundwork for your learning journey.</p>
</section>
<section id="think-bayes" class="level2">
<h2 class="anchored" data-anchor-id="think-bayes">Think Bayes</h2>
<p>The vast majority of the resources listed here use R for implementation. I think that’s because the packages for computing Bayesian models in R are much easier to navigate than their alternatives in Python. However, if you’re coming at this as someone with limited or no knowledge of R and no interest in changing that, then <a href="https://www.allendowney.com/wp/">Allen Downey</a>’s <a href="http://allendowney.github.io/ThinkBayes2/index.html"><em>Think Bayes</em></a> is worth a look. <em>Think Bayes</em> takes a code-first approach to teaching Bayesian concepts, rather than using notation and illustrating ideas using concepts like calculus. For anyone that uses Python and would learn better through concepts being explained through code, this book is a great start.</p>
</section>
</section>
<section id="building-a-stronger-understanding" class="level1">
<h1>Building a Stronger Understanding</h1>
<p>The following resources would serve as great next steps for someone looking to build on their understanding of Bayesianism, whether it be an extremely thorough exploration of the mathematics underpinning the methods, or detailed documentation of the code for the computation of Bayesian methods.</p>
<section id="bayesian-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="bayesian-data-analysis">Bayesian Data Analysis</h2>
<p>Everything <a href="https://statmodeling.stat.columbia.edu/">Andrew Gelman</a> does is good, and <a href="http://www.stat.columbia.edu/~gelman/book/"><em>Bayesian Data Analysis</em></a> (co-authored with John B. Carlin, Hal S. Stern, David B. Dunson, Aki Vehtari, and Donald B. Rubin) is yet more proof of that. It’s a really extensive book covering the fundamentals of Bayesian inference, analysis, and methods.</p>
<p>I think <em>Bayesian Data Analysis</em> might be a little heavier going if you’re just starting out, but the book is also supplemented by an <a href="https://avehtari.github.io/BDA_course_Aalto/">online course</a> made available by <a href="https://users.aalto.fi/~ave/">Aki Vehtari</a>, with lecture slides and videos to help bridge any gaps in understanding.</p>
<p>The book and the course are excellent resources for those looking to build on foundational knowledge (perhaps developed using the earlier resources). It’s probably the most thorough of all the resources here, so if you’re comfortable with mathematical notation and only want to read one book, this might be your best bet.</p>
</section>
<section id="stan-documentation" class="level2">
<h2 class="anchored" data-anchor-id="stan-documentation">Stan Documentation</h2>
<p>Stan is a probabilistic programming language for implementing Bayesian statistical models. It’s the language that underpins the computation of Bayesian methods, and there are interfaces that make it accessible in a number of different languages, including R, Python, and Julia (for those of you looking to intimidate your peers).</p>
<p>The <a href="https://mc-stan.org/users/documentation/">Stan documentation</a>, and the documentation for the R interface to Stan, <a href="https://mc-stan.org/rstan/">RStan</a>, and the Python equivalent, <a href="https://pystan.readthedocs.io/en/latest/">PyStan</a> are good resources for learning how to implement a variety of Bayesian models.</p>
</section>
</section>
<section id="beyond-bayes" class="level1">
<h1>Beyond Bayes</h1>
<p>Finally, there are books that are worth a mention because they are really good resources that, while not focused entirely on Bayesian statistics, do a great job of placing Bayesian approaches in the context of wider statistical methods.</p>
<section id="regression-and-other-stories" class="level2">
<h2 class="anchored" data-anchor-id="regression-and-other-stories">Regression and Other Stories</h2>
<p>More Gelman. I have no regrets! <a href="https://avehtari.github.io/ROS-Examples/"><em>Regression and Other Stories</em></a> is co-authored with Jennifer Hill and Aki Vehtari, and it will serve you brilliantly if you’re looking to learn about Bayesian approaches while also covering the frequentist methods too. It is a book that focuses on the application of regression to real-world problems and the challenges users will face in the process.</p>
<p>While the focus of the book is regression, it incorporates Bayesian inference and methods across the book, and this might be useful to anyone wanting a broader education in statistical analysis that includes Bayesian approaches.</p>
</section>
<section id="probabilistic-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="probabilistic-machine-learning">Probabilistic Machine Learning</h2>
<p>If you’re looking to apply your newly developed Bayesian principles to machine learning, then <a href="https://probml.github.io/pml-book/book1.html"><em>Probabilistic Machine Learning: An Introduction</em></a> by <a href="https://www.cs.ubc.ca/~murphyk/">Kevin Patrick Murphy</a> is a great start.</p>
<p>It’s not specifically a Bayesian machine learning book, but probabilistic machine learning incorporates a lot of Bayesian principles, and there’s plenty of explicitly Bayesian tools in the book too. If you’ve cracked several of the resources in this list and are looking to take your next step, I think this would be a great direction.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>I think that having a good understanding of Bayes rule is really important for anyone working in or around statistics, because it helps inform the way you reason about statistics, and it helps you interrogate your approach to analysis in a more thorough manner. Getting a good intuition for Bayesian thinking is relatively simple, but if you’re looking to go a little further, it does require a bit of work. I think there are tons of really good resources out there to take those next steps, but I don’t think they’re as easy to track down as they could be. Hopefully this list will bridge that gap for a few people.</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Resources for Learning Bayesian
Statistics.”</span> May 10, 2022. <a href="https://paulrjohnson.net/blog/2022-05-10-learning-bayesian-statistics">https://paulrjohnson.net/blog/2022-05-10-learning-bayesian-statistics</a>.
</div></div></section></div> ]]></description>
  <category>Bayesian Statistics</category>
  <category>Statistics</category>
  <category>Data Science</category>
  <category>Probability</category>
  <guid>https://paulrjohnson.net/blog/2022-05-10-learning-bayesian-statistics/</guid>
  <pubDate>Mon, 09 May 2022 23:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-05-10-learning-bayesian-statistics/bayes.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Combining Tidymodels &amp; Caret for Machine Learning in R</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-05-07-combining-tidymodels-and-caret/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>The two main approaches to building machine learning models in R are <a href="https://github.com/topepo/caret/"><strong>caret</strong></a> and <a href="https://www.tidymodels.org/"><strong>tidymodels</strong></a>. Having tried both, I found that I struggled to pick my favorite. There’s elements of both that made more intuitive sense to me than the other. I think it’s a product of having become very familiar with the <strong>tidyverse</strong>, particularly <strong>dplyr</strong>, for data wrangling, but still using a lot of Base R functions for statistical modeling.</p>
<p>The process for prepping the data for a machine learning model seems to make a ton of sense to me when done in <strong>tidymodels</strong> (using <a href="https://recipes.tidymodels.org/"><strong>recipes</strong></a> and <a href="https://rsample.tidymodels.org/"><strong>rsample</strong></a>), but the equivalent process using <strong>caret</strong> felt a little clunky. However, specifying and training models using <strong>caret</strong> made a lot of sense to my broken brain.</p>
<p>Anyway, I recently discovered something that is probably entirely unremarkable to everyone else, and that probably shouldn’t have taken me by surprise… You can just combine the two! You can split and preprocess your data using the <strong>tidymodels</strong> framework before defecting to <strong>caret</strong> for the next steps. What a time to be alive.</p>
<section id="training-a-random-forest-model-to-predict-diabetes" class="level1">
<h1>Training a Random Forest Model to Predict Diabetes</h1>
<p>Because I’m not a savage, I won’t leave you without a simple worked example. We’ll use <a href="https://hutsons-hacks.info/">Gary Hutson</a>’s really useful <a href="https://cran.r-project.org/web/packages/MLDataR/vignettes/MLDataR.html"><strong>MLDataR</strong></a> package to grab a toy diabetes dataset, cleaning the variable names using <a href="http://sfirke.github.io/janitor/"><strong>janitor</strong></a>, and converting the target variable, <em>diabetic_class</em>, to a factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># import packages</span></span>
<span id="cb1-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">suppressPackageStartupMessages</span>({</span>
<span id="cb1-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(dplyr)</span>
<span id="cb1-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(caret)</span>
<span id="cb1-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(recipes)</span>
<span id="cb1-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">library</span>(randomForest)</span>
<span id="cb1-7">})</span>
<span id="cb1-8"></span>
<span id="cb1-9"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># load data</span></span>
<span id="cb1-10">diabetes_raw <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> MLDataR<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span>diabetes_data</span>
<span id="cb1-11"></span>
<span id="cb1-12"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># clean data</span></span>
<span id="cb1-13">df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb1-14">  diabetes_raw <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-15">  janitor<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">clean_names</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb1-16">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(<span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">diabetic_class =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(diabetic_class))</span></code></pre></div>
</div>
<p>Having done this, we can use <strong>rsample</strong> to split the data into a train and test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set random seed</span></span>
<span id="cb2-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">456</span>)</span>
<span id="cb2-3"></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># split train/test data</span></span>
<span id="cb2-5">train_test_split <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb2-6">  rsample<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">initial_split</span>(df,</span>
<span id="cb2-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">strata =</span> diabetic_class,</span>
<span id="cb2-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">prop =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.7</span></span>
<span id="cb2-9">  )</span>
<span id="cb2-10"></span>
<span id="cb2-11"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># create train/test sets</span></span>
<span id="cb2-12">train_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rsample<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">training</span>(train_test_split)</span>
<span id="cb2-13">test_df <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> rsample<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">testing</span>(train_test_split)</span></code></pre></div>
</div>
<p>The next step is a little more involved, and is where I think <strong>tidymodels</strong> really excels. Using the <strong>recipes</strong> package, we can specify all the preprocessing steps needed for the dataset, such that the data will then be ready for training a machine learning model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># preprocessing</span></span>
<span id="cb3-2">model_recipe <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb3-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">recipe</span>(diabetic_class <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">~</span> ., <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-4">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># combine low frequency factor levels</span></span>
<span id="cb3-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_other</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_nominal</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">threshold =</span> <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.05</span>) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-6">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># remove predictors with zero variance</span></span>
<span id="cb3-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_nzv</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_predictors</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-8">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># normalize numeric variables (sigma = 1, mu = 0)</span></span>
<span id="cb3-9">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_normalize</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_numeric</span>()) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb3-10">  <span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># convert nominal variables to numeric binary variables</span></span>
<span id="cb3-11">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">step_dummy</span>(<span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_nominal</span>(), <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">-</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">all_outcomes</span>(), <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">one_hot =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>)</span></code></pre></div>
</div>
<p>You can check that all the preprocessing steps are working as expected by using <em>prep()</em> and <em>juice()</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check preprocessing results</span></span>
<span id="cb4-2">model_recipe <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">prep</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-4">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">juice</span>() <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb4-5">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">head</span>()</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 32
     age diabetic_class gender_Female gender_Male excess_urination_No excess_urination_Yes polydipsia_No polydipsia_Yes
   &lt;dbl&gt; &lt;fct&gt;                  &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;                &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
1 -0.677 Negative                   0           1                   1                    0             0              1
2 -1.19  Negative                   0           1                   1                    0             1              0
3 -1.53  Negative                   0           1                   1                    0             1              0
4  1.62  Negative                   0           1                   0                    1             1              0
5  1.02  Negative                   0           1                   1                    0             1              0
6  0.854 Negative                   0           1                   1                    0             1              0
# ℹ 24 more variables: weight_loss_sudden_No &lt;dbl&gt;, weight_loss_sudden_Yes &lt;dbl&gt;, fatigue_No &lt;dbl&gt;, fatigue_Yes &lt;dbl&gt;,
#   polyphagia_No &lt;dbl&gt;, polyphagia_Yes &lt;dbl&gt;, genital_thrush_No &lt;dbl&gt;, genital_thrush_Yes &lt;dbl&gt;,
#   blurred_vision_No &lt;dbl&gt;, blurred_vision_Yes &lt;dbl&gt;, itching_No &lt;dbl&gt;, itching_Yes &lt;dbl&gt;, irritability_No &lt;dbl&gt;,
#   irritability_Yes &lt;dbl&gt;, delay_healing_No &lt;dbl&gt;, delay_healing_Yes &lt;dbl&gt;, partial_psoriasis_No &lt;dbl&gt;,
#   partial_psoriasis_Yes &lt;dbl&gt;, muscle_stiffness_No &lt;dbl&gt;, muscle_stiffness_Yes &lt;dbl&gt;, alopecia_No &lt;dbl&gt;,
#   alopecia_Yes &lt;dbl&gt;, obesity_No &lt;dbl&gt;, obesity_Yes &lt;dbl&gt;</code></pre>
</div>
</div>
<p>If everything looks alright, you can take the <em>model_recipe</em> object that you’ve created and use it as the model formula that you would otherwise have to specify in the <strong>caret</strong> <em>train()</em> function.</p>
<p>For the rest of the process, you can switch over to <strong>caret</strong>, first using the <em>trainControl()</em> function to specify the training parameters and then the <em>train()</em> function for the model training.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># set random seed</span></span>
<span id="cb6-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">set.seed</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">456</span>)</span>
<span id="cb6-3"></span>
<span id="cb6-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># control parameters for model training</span></span>
<span id="cb6-5">ctrl <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb6-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">trainControl</span>(</span>
<span id="cb6-7">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"cv"</span>,</span>
<span id="cb6-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">number =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">5</span>,</span>
<span id="cb6-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">classProbs =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span>,</span>
<span id="cb6-10">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">summaryFunction =</span> twoClassSummary</span>
<span id="cb6-11">  )</span>
<span id="cb6-12"></span>
<span id="cb6-13"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># train random forest model</span></span>
<span id="cb6-14">rf_mod <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb6-15">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">train</span>(</span>
<span id="cb6-16">    model_recipe,</span>
<span id="cb6-17">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">data =</span> train_df,</span>
<span id="cb6-18">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">method =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"rf"</span>,</span>
<span id="cb6-19">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">tunelength =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">10</span>,</span>
<span id="cb6-20">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">metric =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"ROC"</span>,</span>
<span id="cb6-21">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">trControl =</span> ctrl,</span>
<span id="cb6-22">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">importance =</span> <span class="cn" style="color: #8f5902;
background-color: null;
font-style: inherit;">TRUE</span></span>
<span id="cb6-23">  )</span></code></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tmp$resample: partial match of 'resample' to 'resamples'</code></pre>
</div>
</div>
<p>Having trained the random forest model, you can check the performance, and see what parameters were chosen in the tuning process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># check results</span></span>
<span id="cb8-2"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(rf_mod)</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest 

364 samples
 16 predictor
  2 classes: 'Negative', 'Positive' 

Recipe steps: other, nzv, normalize, dummy 
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 292, 291, 291, 291, 291 
Resampling results across tuning parameters:

  mtry  ROC        Sens       Spec     
   2    0.9947186  0.9500000  0.9372727
  16    0.9873918  0.9428571  0.9281818
  31    0.9850108  0.9428571  0.9235354

ROC was used to select the optimal model using the largest value.
The final value used for the model was mtry = 2.</code></pre>
</div>
</div>
<p>Not bad! The best performing model has an ROC of 0.995 and both the sensitivity and specificity are ~0.95. Pretty solid for a quick and easy model.</p>
<p>To really test the model’s performance, we want to see how it copes with the test data that it hasn’t seen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;"># make predictions on test data</span></span>
<span id="cb10-2">rf_predict <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(rf_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> test_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"prob"</span>)</span>
<span id="cb10-3">rf_class <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">predict</span>(rf_mod, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">newdata =</span> test_df, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">type =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"raw"</span>)</span>
<span id="cb10-4"></span>
<span id="cb10-5">preds <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span></span>
<span id="cb10-6">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">cbind</span>(rf_predict, rf_class) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%&gt;%</span></span>
<span id="cb10-7">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">mutate</span>(</span>
<span id="cb10-8">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Positive =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(Positive, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>),</span>
<span id="cb10-9">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">Negative =</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">round</span>(Negative, <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">digits =</span> <span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">2</span>)</span>
<span id="cb10-10">  )</span></code></pre></div>
</div>
<p>Finally, we can produce a confidence matrix for a more intuitive look at how the model is performing on the test set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1">cm_class <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> test_df[, <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">names</span>(test_df) <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"diabetic_class"</span>)]</span>
<span id="cb11-2"></span>
<span id="cb11-3"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">confusionMatrix</span>(</span>
<span id="cb11-4">    rf_class,</span>
<span id="cb11-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">as.factor</span>(cm_class<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">$</span>diabetic_class),</span>
<span id="cb11-6">    <span class="at" style="color: #657422;
background-color: null;
font-style: inherit;">positive =</span> <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Positive"</span></span>
<span id="cb11-7">  )</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction Negative Positive
  Negative       57        1
  Positive        3       95
                                         
               Accuracy : 0.9744         
                 95% CI : (0.9357, 0.993)
    No Information Rate : 0.6154         
    P-Value [Acc &gt; NIR] : &lt;2e-16         
                                         
                  Kappa : 0.9455         
                                         
 Mcnemar's Test P-Value : 0.6171         
                                         
            Sensitivity : 0.9896         
            Specificity : 0.9500         
         Pos Pred Value : 0.9694         
         Neg Pred Value : 0.9828         
             Prevalence : 0.6154         
         Detection Rate : 0.6090         
   Detection Prevalence : 0.6282         
      Balanced Accuracy : 0.9698         
                                         
       'Positive' Class : Positive       
                                         </code></pre>
</div>
</div>
<p>The results are pretty good for a very quick model. How exciting. Lets pretend that it’s because I’m a brilliant data scientist rather than it being due to the very clean, balanced toy dataset we used.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>So there you have it, if you’re in the same position as me and you’re struggling to pick between <strong>tidymodels</strong> and <strong>caret</strong>, because both frameworks offer something you like, you can just combine the two and make Frankenstein’s framework.</p>
<p>Ultimately, despite this blog post, I’m probably going to stick with <strong>tidymodels</strong> (why am I like this?). I think that I’m going to force myself to get used to the <strong>tidymodels</strong> framework end-to-end because a) it is receiving tons of development so it’s probably going to continue to get better and bigger, and will be leading the way for the foreseeable future, and b) because in reality I think the explicit way that you structure each step is probably sensible, even if it confuses me a bit.</p>
<p>But it’s nice to know that I’ve got options.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@rocknrollmonkey">Rock’n Roll Monkey</a> on <a href="https://unsplash.com/photos/blue-plastic-robot-toy-R4WCbazrD1g">Unsplash</a>.</p>


</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Combining Tidymodels &amp; Caret for Machine
Learning in R.”</span> May 7, 2022. <a href="https://paulrjohnson.net/blog/2022-05-07-combining-tidymodels-and-caret">https://paulrjohnson.net/blog/2022-05-07-combining-tidymodels-and-caret</a>.
</div></div></section></div> ]]></description>
  <category>Machine Learning</category>
  <category>Data Science</category>
  <category>R</category>
  <category>Caret</category>
  <category>Tidymodels</category>
  <guid>https://paulrjohnson.net/blog/2022-05-07-combining-tidymodels-and-caret/</guid>
  <pubDate>Fri, 06 May 2022 23:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-05-07-combining-tidymodels-and-caret/robot.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Make More Packages!</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-02-19-make-more-packages/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>Having learned R in an academic context, I wasn’t exposed to programming in a linear path that taught me the basics of programming theory and application. I learned how to carry out statistical analysis using R, and my interaction with packages was that they would help me get the job done without having to do everything manually. As a result, package development has always intimidated me a little bit. It seemed like the responsibility of much smarter people that know what they’re doing, and that can build packages that can help me figure out what I’m doing too.</p>
<p>To be fair, that was probably an accurate description of my situation for… a good few years of my time using R. But practice makes you less bad at things, and over time I’ve gone from being someone that uses R like it’s a boiling pot of oil that they’re about to chuck a fistful of frozen chips at for the first time, to someone that has full confidence that they can’t do any damage because they’ve already burned the house down anyway.</p>
<p>That is (mostly) a lie. I’m now (mostly) good at what I do. But that didn’t stop package development being a process that intimidated me.</p>
<p>However, I recently made the jump into some basic package development as a result of working on an internal package that I am helping to develop. While it wasn’t being built entirely from scratch, this package was a good opportunity for me to play around with some cool functions and learn about package infrastructure. Having done so, I realised that the process is actually pretty painless.</p>
<p>To follow-up on what I’d learned, I decided to build my own (stupid but funny) package from scratch, and made <a href="https://github.com/Paulj1989/nice"><strong>nice</strong></a>.</p>
<p>Now, I thought I would write this short blog post detailing the process for creating a very basic package, in the hope that it might help someone else overcome an imagined barrier to entry. I will run through the process of setting up a package, adding some simple functions, and then building out the basic infrastructure with documentation and testing, using <strong>nice</strong> as an example.</p>
<section id="initial-setup" class="level1">
<h1>Initial Setup</h1>
<p>In order to build a basic package from scratch, you should only need to rely on four different packages that will aid you in setting everything up, building the correct infrastructure, and documenting and testing your functions.</p>
<p>The packages you need:</p>
<ul>
<li><a href="https://devtools.r-lib.org/"><strong>devtools</strong></a></li>
<li><a href="https://usethis.r-lib.org/"><strong>usethis</strong></a></li>
<li><a href="https://roxygen2.r-lib.org/"><strong>roxygen2</strong></a></li>
<li><a href="https://testthat.r-lib.org/"><strong>testthat</strong></a></li>
</ul>
<p><strong>devtools</strong> is responsible for the majority of the functions you’ll need to build and maintain a package and <strong>usethis</strong> handles the initial setup of the project, while <strong>roxygen2</strong> helps you document your package, and <strong>testthat</strong> simplifies unit testing.</p>
</section>
<section id="functions" class="level1">
<h1>Functions</h1>
<p>Packages are effectively just a way of housing and distributing functions. If you’re making a package, you’ll need some functions! They don’t need to be wildly complex. They just need to work, and ideally they would be reasonably useful too. However, in the absence of useful functions, we’ve got an example of a funny function instead:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1">check <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">function</span>(x){</span>
<span id="cb1-2">  <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">if</span> (x <span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">%in%</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">c</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">69</span>, <span class="fl" style="color: #AD0000;
background-color: null;
font-style: inherit;">0.69</span>)){</span>
<span id="cb1-3">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nice!"</span>)</span>
<span id="cb1-4">  } <span class="cf" style="color: #003B4F;
background-color: null;
font-style: inherit;">else</span> {</span>
<span id="cb1-5">    <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">print</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Not very nice."</span>)</span>
<span id="cb1-6">  }</span>
<span id="cb1-7">}</span></code></pre></div>
</div>
<p>This is very simple. All it is doing is checking if an object <em>x</em> matches either the number 69 or 0.69. If it does, then it returns “Nice!”, and if it doesn’t, it returns “Not very nice.”. If you’re just looking to build a basic package as a means of learning how to do so, this is all you need! You can build on this iteratively, as you become more confident with package development, or come up with other useful functions your package should include.</p>
<p>I think it is generally best practice to dedicate a different file to each individual function, though it’s not absolutely necessary. If you choose to, you can store all your functions in one file, and this might be a sensible approach if you’re creating a package that contains all your miscellaneous functions. However, for anything a little more meaty than that, I think the best approach is to split out everything into files for each function. That makes it easier for someone (likely including yourself) to navigate the source code.</p>
</section>
<section id="documentation" class="level1">
<h1>Documentation</h1>
<p>The next step is to document your package, so anyone using it will have some guidance on what they’re doing and why. Documentation doesn’t need to be complicated, though if the function it is documenting is pretty complex, it should probably go into plenty of detail to help anyone trying to use it. In the <strong>nice</strong> example, the functions are super simple, so there’s no sense in overdoing the docs either.</p>
<p>You need to add comments at the beginning of your function script which explain what the function does, details any of the required parameters for the function to run, and give some examples of usage. In order for <strong>roxygen2</strong> to recognise the comments that need to be turned into documentation, you have to add #’ in front of them.</p>
<p>Below is a basic example of what is needed, corresponding to the <strong>nice</strong> check function above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' Checking whether your R output is really nice</span></span>
<span id="cb2-2"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#'</span></span>
<span id="cb2-3"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @keywords nice</span></span>
<span id="cb2-4"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @export</span></span>
<span id="cb2-5"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' @examples</span></span>
<span id="cb2-6"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' check(69)</span></span>
<span id="cb2-7"><span class="co" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">#' </span></span></code></pre></div>
</div>
<p>Having done this, devtools will process the documentation so that it all works as expected:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">document</span>()</span></code></pre></div>
</div>
<p>You can get a look at your documentation by calling <em>?function</em> like you normally would. In this case, calling <em>?check</em> returns the documentation for the <strong>nice</strong> check function.</p>
</section>
<section id="testing" class="level1">
<h1>Testing</h1>
<p>In order to reduce the likelihood that your package becomes a mess of errors, it is important to test it. The best way of doing this is automating your tests, to make everything reproducible, and reduce your own opportunities to do anything stupid!</p>
<p>To set up your tests, the following creates a new script for all tests of the particular function(s) you’re working on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1">usethis<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">use_test</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"name"</span>)</span></code></pre></div>
</div>
<p>An example of a basic test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test_that</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"check returns correct type of response"</span>, {</span>
<span id="cb5-2">  nice <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">69</span>)</span>
<span id="cb5-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expect_type</span>(nice, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"character"</span>)</span>
<span id="cb5-4">})</span></code></pre></div>
</div>
<p>This test is, as it describes, checking that <em>check</em> is returning the right type of output when it runs. The test creates an object called <em>nice</em> that contains the output from the <em>check</em> function, when the input it receives is 69. The test expects the object to be of type character, and if that is so, then it will pass the test. If you want to build further tests for this particular function, you could check that the function correctly recognises whether the input is nice or not, and returns the correct response.</p>
<p>This would look as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test_that</span>(<span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"check returns correct positive response"</span>, {</span>
<span id="cb6-2">  nice <span class="ot" style="color: #003B4F;
background-color: null;
font-style: inherit;">&lt;-</span> <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">check</span>(<span class="dv" style="color: #AD0000;
background-color: null;
font-style: inherit;">69</span>)</span>
<span id="cb6-3">  <span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">expect_equal</span>(nice, <span class="st" style="color: #20794D;
background-color: null;
font-style: inherit;">"Nice!"</span>)</span>
<span id="cb6-4">})</span></code></pre></div>
</div>
<p>Once you have set up some tests that you want to use to check your functions, you can run those tests by calling on devtools:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7" style="background: #f1f3f5;"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1">devtools<span class="sc" style="color: #5E5E5E;
background-color: null;
font-style: inherit;">::</span><span class="fu" style="color: #4758AB;
background-color: null;
font-style: inherit;">test</span>()</span></code></pre></div>
</div>
<p>This will run through each test and check that it returns the expected output. If it doesn’t it will show that it has failed, and show you where exactly that failure has occurred, in order to help you fix it. If it has worked, then you’re all good!</p>
</section>
<section id="further-reading" class="level1">
<h1>Further Reading</h1>
<p>This was a very, very quick run-through on how to create a basic package, just to get started, but if you want to make something that is a little more useful than some dumb function to check if your outputs are nice, then there’s plenty of resources for how to take your packages from basics to CRAN and beyond.</p>
<p>The starting point, as is often the case, is Hadley Wickham. Hadley Wickham and Jenny Bryan’s <a href="https://r-pkgs.org/index.html"><em>R Packages</em></a> is an excellent resource for learning to make some killer packages. And if you’re looking to learn how to build the kind of functions that belong in those killer packages, then Hadley Wickham’s <a href="https://adv-r.hadley.nz/"><em>Advanced R</em></a> will get you most of the way there.</p>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@jiaweizhao">Jiawei Zhao</a> on <a href="https://unsplash.com/photos/tuxedo-cat-in-brown-cardboard-box-W-ypTC6R7_k">Unsplash</a>.</p>


</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Make More Packages!”</span> February 19,
2022. <a href="https://paulrjohnson.net/blog/2022-02-19-make-more-packages">https://paulrjohnson.net/blog/2022-02-19-make-more-packages</a>.
</div></div></section></div> ]]></description>
  <category>R</category>
  <category>Packages</category>
  <category>Software Development</category>
  <category>Data Science</category>
  <guid>https://paulrjohnson.net/blog/2022-02-19-make-more-packages/</guid>
  <pubDate>Sat, 19 Feb 2022 00:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-02-19-make-more-packages/package.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Making Myself Accountable</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2022-01-17-making-myself-accountable/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>One of my goals when setting up this site was to use the blog section reasonably frequently to share some of my work and share anything particularly interesting that I’ve learned in my development as a data scientist. There hasn’t been much sharing going on. I’d like to think that isn’t because I haven’t done or learned anything interesting (…), I just haven’t found the time to share it.</p>
<p>I’m the ideas man. No one told me I’d also have to be the one to finish the ideas too. That seems deeply unfair.</p>
<p>But having realized that everything I’ve thought about sharing either hasn’t made it out of my head, or has been shared with friends in the form of a dumb joke, I’m looking to set myself some goals that will make the blog a little more active. So I’m using this space as an opportunity to hold myself accountable to my own fantastical intentions.</p>
<p>Over the course of the next 12 months, I’m going to try and average a blog post a month, around data science generally, and anything cool that I’m either learning or doing.</p>
<p>Given that everything is posting and everyone is a poster, it’s time I put some hours in at the content factory. New Year, New Me.</p>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@jacklucassmith">Jack Lucas Smith</a> on <a href="https://unsplash.com/photos/white-and-black-police-car-on-road-during-daytime-UqvSeGmFYBs">Unsplash</a>.</p>


</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2022" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2022. <span>“Making Myself Accountable.”</span> January
17, 2022. <a href="https://paulrjohnson.net/blog/2022-01-17-making-myself-accountable">https://paulrjohnson.net/blog/2022-01-17-making-myself-accountable</a>.
</div></div></section></div> ]]></description>
  <category>Me Me Me</category>
  <category>Updates</category>
  <guid>https://paulrjohnson.net/blog/2022-01-17-making-myself-accountable/</guid>
  <pubDate>Mon, 17 Jan 2022 00:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2022-01-17-making-myself-accountable/police.webp" medium="image" type="image/webp"/>
</item>
<item>
  <title>Recent Football Analytics Articles</title>
  <dc:creator>Paul Johnson</dc:creator>
  <link>https://paulrjohnson.net/blog/2020-04-14-football-analytics/</link>
  <description><![CDATA[ 

<!-- source: https://github.com/gadenbuie/garrickadenbuie-com/blob/main/_partials/title-block-link-buttons/title-block.html -->
<!-- 
<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title"> 
-->
<!-- <header id="title-block-header" class="quarto-title-block default page-columns"> -->
<!-- <div class="quarto-title page-columns page-full featured-image p-4" style="background-image: url(featured.png), url(featured.jpg), url(../featured.jpg);"> -->



<p>As a side-project/hobby, I write about football. Some of my recent work (as of 04/20) can be found below:</p>
<section id="past-his-peak-assessing-goalkeeper-performance-by-age-and-manuel-neuer-vs-alexander-nübel" class="level1">
<h1><a href="https://www.bavarianfootballworks.com/2020/1/29/21112631/bayern-munich-manuel-neuer-peak-statistical-performance-analysis-goalkeeper-age-alexander-nubel">Past his peak? Assessing goalkeeper performance by age and Manuel Neuer vs Alexander Nübel</a></h1>
<p>For Bavarian Football Works, I analyzed goalkeeper peak age, and the performance of Bayern Munich’s great but ageing Manuel Neuer. I found that Neuer continues to be a very good goalkeeper, but that his performances are gradually declining, suggesting that the effects of age are starting to wear on him, and showing that even the greatest athletes ever can’t beat Father Time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19654170/neuer_nubel.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" data-glightbox="description: .lightbox-desc-1" title="Neuer"><img src="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19654170/neuer_nubel.png" class="img-fluid figure-img" alt="Neuer"></a></p>
<figcaption>Neuer</figcaption>
</figure>
</div>
</section>
<section id="the-hinrunde-review-analyzing-dortmunds-season-so-far" class="level1">
<h1><a href="https://www.fearthewall.com/2020/1/4/21049708/the-hinrunde-review-analyzing-dortmunds-season-so-far">The Hinrunde Review: Analyzing Dortmund’s Season So Far</a></h1>
<p>Before the 2019/20 season was interrupted by Covid-19, I carried out an analysis of the first half of the BVB season. I looked at team and individual performances, and identified some key areas of concern going forward.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19607138/playerxgxa.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" data-glightbox="description: .lightbox-desc-2" title="npxG+xA/90"><img src="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19607138/playerxgxa.png" class="img-fluid figure-img" alt="npxG+xA/90"></a></p>
<figcaption>npxG+xA/90</figcaption>
</figure>
</div>
</section>
<section id="the-earth-is-flat-and-felix-zwayer-is-an-agent-of-bavaria-are-referees-biased" class="level1">
<h1><a href="https://www.fearthewall.com/2019/9/2/20844855/the-earth-is-flat-and-felix-zwyer-is-an-agent-of-bavaria-are-referees-biased">The Earth is Flat and Felix Zwayer is an Agent of Bavaria: Are Referees Biased?</a></h1>
<p>Using data taken from the German football website, Wahre Tabelle, I studied referee errors and looked for evidence of bias for or against certain teams. Every fan base likes to believe they’re hard done by, but unfortunately I found little to suggest this is really the case.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19161141/corrected_goals.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" data-glightbox="description: .lightbox-desc-3" title="Corrections"><img src="https://cdn.vox-cdn.com/uploads/chorus_asset/file/19161141/corrected_goals.png" class="img-fluid figure-img" alt="Corrections"></a></p>
<figcaption>Corrections</figcaption>
</figure>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="acknowledgments" class="level1 appendix"><h2 class="anchored quarto-appendix-heading">Acknowledgments</h2><div class="quarto-appendix-contents">

<p>Preview image by <a href="https://unsplash.com/@a56">Álvaro Mendoza</a> on <a href="https://unsplash.com/photos/man-jump-about-to-hold-ball-near-net-6dRiUBjRvsM">Unsplash</a>.</p>



</div></section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a></div></div></section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-johnson2020" class="csl-entry quarto-appendix-citeas">
Johnson, Paul. 2020. <span>“Recent Football Analytics Articles.”</span>
April 14, 2020. <a href="https://paulrjohnson.net/blog/2020-04-14-football-analytics">https://paulrjohnson.net/blog/2020-04-14-football-analytics</a>.
</div></div></section></div> ]]></description>
  <category>Football Analytics</category>
  <category>R</category>
  <category>Python</category>
  <guid>https://paulrjohnson.net/blog/2020-04-14-football-analytics/</guid>
  <pubDate>Mon, 13 Apr 2020 23:00:00 GMT</pubDate>
  <media:content url="https://paulrjohnson.net/blog/2020-04-14-football-analytics/football.webp" medium="image" type="image/webp"/>
</item>
</channel>
</rss>
