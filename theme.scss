/*-- scss:defaults --*/

// Optimized font declarations with fallback fonts
// FIRA CODE - monospace for code
@font-face {
  font-family: 'Fira Code';
  src: url('assets/fonts/FiraCode-VariableFont_wght.woff2') format('woff2');
  font-weight: 300 700;
  font-style: normal;
  font-display: swap;
  size-adjust: 100%; // Helps maintain consistent sizing
}

// LORA - for headings (serif)
@font-face {
  font-family: 'Lora';
  src: url('assets/fonts/Lora-VariableFont_wght.woff2') format('woff2');
  font-weight: 400 700;
  font-style: normal;
  font-display: swap;
  size-adjust: 100%;
}

// POPPINS - for body text and UI elements (sans-serif)
@font-face {
  font-family: 'Poppins';
  src: url('assets/fonts/Poppins-Regular.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  size-adjust: 100%;
}

@font-face {
  font-family: 'Poppins';
  src: url('assets/fonts/Poppins-Medium.woff2') format('woff2');
  font-weight: 500;
  font-style: normal;
  font-display: swap;
  size-adjust: 100%;
}

@font-face {
  font-family: 'Poppins';
  src: url('assets/fonts/Poppins-Bold.woff2') format('woff2');
  font-weight: 700;
  font-style: normal;
  font-display: swap;
  size-adjust: 100%;
}

@font-face {
  font-family: 'Poppins';
  src: url('assets/fonts/Poppins-Italic.woff2') format('woff2');
  font-weight: 400;
  font-style: italic;
  font-display: swap;
  size-adjust: 100%;
}

// Color system - organized hierarchically
$primary: #43494D;
$secondary: #2C3033;
$dark-gray: #212529;
$medium-gray: #596166;
$light-gray: #5A6266;
$gray-light: #F7F9FA;
$border-color: #dee2e6;

// Base colors
$body-bg: white;
$body-color: $primary;

// Typography with better fallback fonts that match custom fonts
$font-family-sans-serif: "Poppins", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
$font-family-serif: "Lora", Georgia, "Times New Roman", serif;
$font-family-monospace: "Fira Code", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
$headings-font-family: $font-family-serif;
$headings-font-weight: 400;

// Link styling
$link-color: $primary;
$link-decoration: underline;
$link-hover-color: $light-gray;
$link-hover-decoration: none;

// Components
$btn-bg: $primary;
$pagination-active-bg: $primary;
$pagination-active-border-color: $primary;

/*-- scss:rules --*/

// CLS Prevention: Preload critical fonts and prevent invisible text
body {
  font-display: swap;
}

// CLS Prevention: Image sizing and aspect ratio preservation
img {
  max-width: 100%;
  height: auto;

  // Prevent layout shift for images without explicit dimensions
  &:not([width]):not([height]) {
    aspect-ratio: attr(width) / attr(height);
  }
}

// Specific fixes for your problematic images
.about-image {
  // Reserve space for the headshot image (appears to be roughly square based on 28em width)
  aspect-ratio: 1 / 1;
  object-fit: cover;
  max-width: 28em;
  height: auto;
}

.navbar-logo {
  // Reserve space for favicon (typically square)
  aspect-ratio: 1 / 1;
  width: 36px;
  height: 36px;
  object-fit: contain;
}

// Figure images (blog post images)
.figure-img,
.img-fluid {
  // Use aspect-ratio to prevent layout shift
  // Adjust this ratio based on your typical image dimensions
  aspect-ratio: 672 / 400; // Approximate ratio for your blog images
  object-fit: cover;
  width: 100%;
  height: auto;

  // For images with explicit width attribute (like your 672px ones)
  &[width="672"] {
    aspect-ratio: 672 / 400; // Adjust height value based on your typical images
  }
}

// CLS Prevention: Container height stabilization
#quarto-content {
  // Remove dynamic min-height calculation that causes shifts
  min-height: auto !important;
}

.quarto-container {
  // Ensure containers don't cause layout shifts
  contain: layout style;
}

// Typography
.title {
  font-size: 2.5rem;
  font-weight: 500;
  line-height: 1.1;
  // Prevent text reflow during font loading
  font-display: swap;
}

.subtitle {
  font-size: 1.2rem;
  font-display: swap;

  a {
    text-decoration: underline !important;

    &:hover {
      text-decoration: none !important;
    }
  }
}

// Link styles
.description a {
  text-decoration: underline !important;

  &:hover {
    text-decoration: none !important;
  }
}

// Code blocks
div.sourceCode {
  background-color: $gray-light;
  border: 1px solid $gray-light;
  // Prevent layout shifts in code blocks
  contain: layout;
}

// Navigation with CLS prevention
.navbar {
  background: transparent;
  // Prevent navbar height changes
  min-height: 56px; // Standard Bootstrap navbar height
  contain: layout;

  // Title styling
  .navbar-title {
    color: $dark-gray;
    font-size: 0.85rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05rem;
    font-display: swap;

    &:hover {
      filter: brightness(50%);
      text-decoration: underline !important;
    }
  }

  // Navigation links
  .navbar-nav .nav-link {
    color: $dark-gray;
    letter-spacing: 0.05rem;
    border-bottom: 0 hidden;
    margin: 0 10px;
    padding: 2px 2px 4px 2px !important;
    font-display: swap;

    &:hover {
      filter: brightness(50%);
      text-decoration: underline !important;
      padding: 2px 2px 0 2px !important;
    }
  }

  // Navbar tools
  .quarto-navbar-tools {
    margin-left: auto;
    order: 900;
    font-size: 1.2rem;
    margin-right: -0.5rem;

    // Icon colors
    i,
    .bi {
      color: #545555 !important;
      filter: none !important;
    }
  }

  // Toggler styling
  button.navbar-toggler {
    color: #545555 !important;
    filter: none !important;
  }

  // Hamburger icon
  .navbar-toggler-icon {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 30 30'%3e%3cpath stroke='rgba(84, 85, 85, 1)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
    filter: none !important;
  }
}

// Home page social links
.about-links .about-link i {
  &:hover {
    filter: brightness(40%);
    text-decoration: none !important;
  }
}

// Button styles
.btn {
  &-secondary {
    color: $primary !important;
    background: transparent;
    border-radius: 5px;
  }

  &-primary {
    color: white !important;
    background-color: $primary !important;
    border-color: $primary !important;

    &:hover {
      background-color: $dark-gray !important;
      border-color: $dark-gray !important;
    }
  }
}

// Pagination
.page-link {
  color: $primary;

  &:hover {
    color: white !important;
    background-color: $primary !important;
    border-color: $primary !important;
  }
}

// Category styling - shared properties for reuse
%category-base {
  font-size: 0.7rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.02rem;
  color: $dark-gray;
  border: 0.1px solid $border-color;
  padding: 5px;
  border-radius: 0.25rem;
  font-display: swap;
}

// Categories
.quarto-categories {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5em 0.4em;
  padding-bottom: 0.5em;
  margin-top: 0.75em;
  contain: layout; // Prevent layout shifts

  .quarto-category {
    @extend %category-base;
  }
}

// Listings
.listing-category {
  @extend %category-base;
}

div.quarto-post .thumbnail img {
  margin-top: -1em;
  // Ensure thumbnail images don't cause shifts
  aspect-ratio: 16 / 9; // Adjust based on your thumbnail aspect ratio
  object-fit: cover;
}

// Cards
.card {
  background: transparent;
  border: none;
  border-radius: 4px;
  box-shadow: 1px 1px 10px rgba(0, 0, 0, 0.1);
  contain: layout; // Prevent layout shifts within cards
}

.card-img {
  border-radius: 4px 4px 0 0;
  aspect-ratio: 16 / 9; // Standard card image ratio
  object-fit: cover;
}

// Footer links
.nav-footer .nav-link {
  &:hover {
    text-decoration: underline;
  }
}

// Captions - consolidated styling
.panel-caption,
.figure-caption,
.subfigure-caption,
.table-caption,
figcaption,
caption {
  color: $medium-gray;
  text-align: center;
  margin: 0.5em 0;
  font-display: swap;
}

// Fixed positioning
.fixed-top,
.aa-DetachedOverlay {
  position: absolute;
}

// CLS Prevention: Skeleton loading states
.about-contents {
  // Reserve minimum space to prevent shifts
  min-height: 200px;
}

// Loading state for images (optional - you can implement this with JavaScript)
.image-loading {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% {
    background-position: 200% 0;
  }

  100% {
    background-position: -200% 0;
  }
}

// Responsive styles
@media screen and (max-width: 991.98px) {

  // Social media links
  .about-entity .about-links {
    flex-direction: row !important;
    justify-content: center !important;
  }

  // Navbar elements
  .navbar {
    // Maintain consistent height on mobile
    min-height: 56px;

    &-title {
      justify-content: center !important;
      font-size: 0.85rem;
    }

    .quarto-navbar-tools {
      font-size: 1.2rem;
      text-align: left;
    }
  }

  // Footer layout
  .nav-footer {
    flex-direction: row;

    &-center {
      order: 1 !important;
      flex-basis: 100%;
      margin: 0 0 -1.2em 0;
    }

    &-right,
    &-left {
      flex-basis: 100%;
      text-align: center;
    }

    &-right {
      order: 2 !important;
    }

    &-left {
      order: 3 !important;
    }
  }

  // Mobile-specific image adjustments
  .about-image {
    max-width: 20em; // Smaller on mobile
  }

  .figure-img {
    // Adjust aspect ratio for mobile if needed
    aspect-ratio: 4 / 3;
  }
}
