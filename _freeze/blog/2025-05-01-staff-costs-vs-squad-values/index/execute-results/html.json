{
  "hash": "f3ae962259a818a6362fe37d97a06a8b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Are Transfermarkt Squad Values a Reliable Proxy?\nsubtitle: |\n  Using the Bundesliga's financial reports to test Transfermarkt's squad values\n  as a proxy for squad costs.\ndescription-meta: |\n  Using the Bundesliga's financial reports to test Transfermarkt's squad values\n  as a proxy for squad costs.\ndate: 2025-05-01\nimage: ball.webp\nimage-alt: |\n  A Derbystar Bundesliga match ball sitting on the turf of a football pitch.\ncategories: [Football Analytics, Statistics, Machine Learning, R]\nbibliography: references.bib\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Setup Code (Click to Expand)\"}\n# import packages\nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(gt)\n  library(ggplot2)\n  library(tidymodels)\n})\n\n# setup fonts\nsysfonts::font_add_google(\"Poppins\")\nsysfonts::font_add_google(\"Lora\")\nshowtext::showtext_auto()\n\n# set plot theme\n# inspired by https://github.com/z3tt/TidyTuesday/blob/main/R/2020_31_PalmerPenguins.Rmd\ntheme_set(theme_minimal(base_size = 20, base_family = \"Poppins\")) +\n  theme_update(\n    panel.grid.major = element_line(color = \"grey90\", linewidth = .4),\n    panel.grid.minor = element_blank(),\n    panel.spacing.x = unit(.65, units = \"cm\"),\n    panel.spacing.y = unit(.3, units = \"cm\"),\n    axis.title.x = element_text(\n      color = \"grey30\",\n      margin = margin(t = 5),\n      size = rel(1.05)\n    ),\n    axis.title.y = element_text(\n      color = \"grey30\",\n      margin = margin(r = 5),\n      size = rel(1.05)\n    ),\n    axis.text = element_text(color = \"grey50\", size = rel(1)),\n    axis.text.x = element_text(angle = 30, vjust = 1, hjust = .75),\n    axis.ticks = element_line(color = \"grey90\", linewidth = .4),\n    axis.ticks.length = unit(.2, \"lines\"),\n    legend.position = \"top\",\n    legend.title = element_blank(),\n    legend.text = element_text(size = rel(.9)),\n    legend.box.margin = margin(0, 0, -10, 0),\n    legend.key.width = unit(1, units = \"cm\"),\n    plot.title = element_text(\n      hjust = 0,\n      color = \"black\",\n      family = \"Lora\",\n      size = rel(1.5),\n      margin = margin(t = 5, b = 5)\n    ),\n    plot.subtitle = element_text(\n      hjust = 0,\n      color = \"grey30\",\n      family = \"Lora\",\n      lineheight = 0.5,\n      size = rel(1.1),\n      margin = margin(5, 0, 5, 0)\n    ),\n    plot.title.position = \"plot\",\n    plot.caption = element_text(\n      color = \"grey50\",\n      size = rel(0.8),\n      hjust = 1,\n      margin = margin(10, 0, 0, 0)\n    ),\n    plot.caption.position = \"plot\",\n    plot.margin = margin(rep(10, 4)),\n    strip.text = element_text(size = rel(1), margin = margin(0, 0, 5, 0)),\n    strip.clip = \"off\"\n  )\n\n# set table theme\ntbl_theme <-\n  function(data, width = 100, alignment = \"center\") {\n    data |>\n      tab_source_note(\n        source_note = \"Source: DFL & Transfermarkt Via {worldfootballR}\"\n      ) |>\n      tab_options(\n        footnotes.marks = \"standard\",\n        footnotes.spec_ref = \"^xb\",\n        footnotes.spec_ftr = \"(x)\",\n        table.width = pct(width),\n        table.align = alignment,\n        table.font.names = \"Poppins\"\n      ) |>\n      tab_style(\n        style = cell_text(align = \"left\"),\n        locations = list(cells_source_notes(), cells_footnotes())\n      )\n  }\n\n# load data\nbuli_resources <-\n  readr::read_rds(\n    here::here(\n      \"blog\",\n      \"2025-05-01-staff-costs-vs-squad-values\",\n      \"data\",\n      \"buli_resources.rds\"\n    )\n  )\n```\n:::\n\n\n\n\nLast year, I wrote a [blog post](https://paulrjohnson.net/blog/analysing-money-in-football/) that modeled the effect that money has on outcomes in the Europe's five biggest football leagues. The key explanatory variable in my model was Transfermarkt's squad values, serving as a proxy for a club's financial clout. While research has shown that Transfermarkt's player market values have strong associations with transfer fees [@herm2014; @muller2017; @coates2022], the existing literature regarding player salaries is promising but the volume is much more limited [@prockl2018]. Further, research has also identified that player values vary in predictive value by league [@muller2017; @coates2022]. All this considered, I concluded that Transfermarkt's squad market values were an effective proxy for squad spending[^Spending]. But what if I was wrong?\n\nI used a proxy for the same reason everyone uses a proxy — because I didn't have data for the variables I would have otherwise used. Unlike many other cases, I think my own laziness is the missing data culprit. I think the best way to capture financial clout is using squad costs. This could either be **just** a club's wage spending, or it could be all spending on the squad (wages + transfer fees). While this data isn't exactly readily available, I'm pretty sure I could track down the wage spending from annual financial reports. So I took the easy way out.\n\nA few weeks ago, [Ansgar Wolsing](https://bsky.app/profile/ansgarw.bsky.social) made me aware of the Deutsche Fussball Liga (DFL)'s [published reports](https://www.dfl.de/de/hintergrund/lizenzierungsverfahren/finanzkennzahlen-der-proficlubs/) detailing the annual financial accounts for every club in the Bundesliga (and 2. Bundesliga). Those accounts include each club's spending on \"staff costs\", which is all staff, including the playing squad.\n\nNever one to miss an opportunity to make _content_, I went right to work and grabbed six seasons of data, from 2017/18 to 2022/23. Now, we can find out whether or not Transfermarkt's squad values are a reasonable proxy for the data I was too lazy to go looking for (until someone basically dropped it in my lap). Lesbeavenue!\n\n[^Spending]:\n\nWhich is itself effectively a proxy for a club's financial resources, since the assumption is that clubs will spend close to the maximum they can on their squad.\n\n## Exploring the Data\n\nWhile the majority of clubs report their staff costs on a season-basis, there are some that report staff costs for the financial year. In those cases, the costs don't perfectly align to a single season, but I don't think the change in costs from season-to-season is large enough to be a huge concern.\n\nHowever, I did have to drop Frankfurt's 2022/23 season from the data. This was because Frankfurt were one of the teams that have been reporting their costs for the financial year, but in 2023 they made the switch to reporting costs over a season. In order to line their reports up, this meant the 2023 report is just the costs for the first six months of 2023 (so that the following season is on the correct schedule). I did think about doubling the Frankfurt figures, and I'm sure this would be approximately right in reality, but it feels a little too icky so I just dropped them.\n\nAnother discrepancy in the data occurs in the 2021/22 season. The figures published in 2024 refer to the 2022/23 season, but the reports are organised by division, with all teams in the Bundesliga in the 2024/25 season in one report, and the same for the 2. Bundesliga. I have absolutely no idea why the figures are organised like this, but I'm sure there's some logic that I'm just too stupid to see. For the most part it was just an inconvenience, creating a lot more work for me to pull the costs together for the right teams in the right season. In 2022/23, however, Paderborn were relegated from the Bundesliga, followed by another relegation down to the 3. Liga in 2023/24. The trouble is, while the top two tiers in Germany are governed by the DFL, the third tier is governed by the DFB. Paderborn's consecutive relegations mean that they aren't included in these reports. It's despicable. The real victim here is me. No one has been hurt more by Paderborn plummeting down the German football pyramid.\n\n### Variance\n\nTo start with, it's probably worth comparing the squad values and staff costs directly, to get some sense of what we are working with. I will start by capturing the difference between the two and exploring how this figure varies across the dataset.\n\nIf we take the difference between squad values and staff costs, plotted below, we see that the gap between the two is pretty large, with squad values usually the larger of the two (though occasionally the difference is negative because a team's staff costs are higher than their squad values).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  mutate(diff = squad_value - staff_cost) |>\n  ggplot(aes(diff)) +\n  geom_histogram() +\n  scale_x_continuous(\n    labels = scales::label_number(\n      scale_cut = scales::cut_short_scale(),\n      prefix = \"€\"\n    )\n  ) +\n  labs(\n    title = \"Difference Between Squad Values & Staff Costs in the Bundesliga\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"The distribution of differences between Bundesliga clubs' squad values \",\n        \"and staff costs per season from 2017/18 to 2022/23.\"\n      ),\n      width = 93\n    ),\n    x = \"Difference\",\n    y = NULL,\n    caption = \"Visualisation: Paul Johnson | Data: DFL & Transfermarkt Via {worldfootballR}\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/difference-distribution-1.png){width=672}\n:::\n:::\n\n\n\n\nThe fact there is a big difference between the two values is not a problem. Of course they are different. They are not claiming to be the same thing. This doesn't render squad values useless as a proxy, as long as squad values is directionally approximate with staff cost.\n\nThe question is whether there is any bias between the two across the Bundesliga. One way of looking at this is taking the average difference in squad values and staff costs by team, below, to see how the differences tend to differ by club. When calculating the average differences I've used the median since it is very skewed.\n\n\n\n\n::: {#tbl-team-difference .cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Table Code (Click to Expand)\"}\nbuli_resources |>\n  mutate(diff = squad_value - staff_cost) |>\n  add_count(team) |>\n  filter(n >= 3) |>\n  summarise(club_diff = median(diff), .by = team) |>\n  arrange(desc(club_diff)) |>\n  gt(rowname_col = \"team\") |>\n  cols_label(\n    club_diff = \"Average Difference\"\n  ) |>\n  fmt_currency(columns = club_diff, currency = \"euro\", suffixing = TRUE) |>\n  cols_align(align = \"center\", columns = club_diff) |>\n  tbl_theme()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"rzjsdzocaw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#rzjsdzocaw table {\n  font-family: Poppins;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#rzjsdzocaw thead, #rzjsdzocaw tbody, #rzjsdzocaw tfoot, #rzjsdzocaw tr, #rzjsdzocaw td, #rzjsdzocaw th {\n  border-style: none;\n}\n\n#rzjsdzocaw p {\n  margin: 0;\n  padding: 0;\n}\n\n#rzjsdzocaw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#rzjsdzocaw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#rzjsdzocaw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#rzjsdzocaw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#rzjsdzocaw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#rzjsdzocaw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#rzjsdzocaw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#rzjsdzocaw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#rzjsdzocaw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#rzjsdzocaw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#rzjsdzocaw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#rzjsdzocaw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#rzjsdzocaw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#rzjsdzocaw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#rzjsdzocaw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rzjsdzocaw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#rzjsdzocaw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#rzjsdzocaw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#rzjsdzocaw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rzjsdzocaw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#rzjsdzocaw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rzjsdzocaw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#rzjsdzocaw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rzjsdzocaw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rzjsdzocaw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rzjsdzocaw .gt_left {\n  text-align: left;\n}\n\n#rzjsdzocaw .gt_center {\n  text-align: center;\n}\n\n#rzjsdzocaw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#rzjsdzocaw .gt_font_normal {\n  font-weight: normal;\n}\n\n#rzjsdzocaw .gt_font_bold {\n  font-weight: bold;\n}\n\n#rzjsdzocaw .gt_font_italic {\n  font-style: italic;\n}\n\n#rzjsdzocaw .gt_super {\n  font-size: 65%;\n}\n\n#rzjsdzocaw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#rzjsdzocaw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#rzjsdzocaw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#rzjsdzocaw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#rzjsdzocaw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#rzjsdzocaw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#rzjsdzocaw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#rzjsdzocaw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#rzjsdzocaw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"a::stub\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"club_diff\">Average Difference</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Bayern Munich</th>\n<td headers=\"stub_1_1 club_diff\" class=\"gt_row gt_center\">&#128;463.30M</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Borussia Dortmund</th>\n<td headers=\"stub_1_2 club_diff\" class=\"gt_row gt_center\">&#128;400.12M</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_left gt_stub\">RB Leipzig</th>\n<td headers=\"stub_1_3 club_diff\" class=\"gt_row gt_center\">&#128;344.10M</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Bayer Leverkusen</th>\n<td headers=\"stub_1_4 club_diff\" class=\"gt_row gt_center\">&#128;276.01M</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Borussia Mönchengladbach</th>\n<td headers=\"stub_1_5 club_diff\" class=\"gt_row gt_center\">&#128;145.05M</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Hoffenheim</th>\n<td headers=\"stub_1_6 club_diff\" class=\"gt_row gt_center\">&#128;139.11M</td></tr>\n    <tr><th id=\"stub_1_7\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Frankfurt</th>\n<td headers=\"stub_1_7 club_diff\" class=\"gt_row gt_center\">&#128;124.99M</td></tr>\n    <tr><th id=\"stub_1_8\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Wolfsburg</th>\n<td headers=\"stub_1_8 club_diff\" class=\"gt_row gt_center\">&#128;111.45M</td></tr>\n    <tr><th id=\"stub_1_9\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Hertha BSC</th>\n<td headers=\"stub_1_9 club_diff\" class=\"gt_row gt_center\">&#128;103.21M</td></tr>\n    <tr><th id=\"stub_1_10\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Schalke</th>\n<td headers=\"stub_1_10 club_diff\" class=\"gt_row gt_center\">&#128;97.50M</td></tr>\n    <tr><th id=\"stub_1_11\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Freiburg</th>\n<td headers=\"stub_1_11 club_diff\" class=\"gt_row gt_center\">&#128;81.22M</td></tr>\n    <tr><th id=\"stub_1_12\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Mainz</th>\n<td headers=\"stub_1_12 club_diff\" class=\"gt_row gt_center\">&#128;77.15M</td></tr>\n    <tr><th id=\"stub_1_13\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Stuttgart</th>\n<td headers=\"stub_1_13 club_diff\" class=\"gt_row gt_center\">&#128;67.91M</td></tr>\n    <tr><th id=\"stub_1_14\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Augsburg</th>\n<td headers=\"stub_1_14 club_diff\" class=\"gt_row gt_center\">&#128;66.73M</td></tr>\n    <tr><th id=\"stub_1_15\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Union Berlin</th>\n<td headers=\"stub_1_15 club_diff\" class=\"gt_row gt_center\">&#128;51.91M</td></tr>\n    <tr><th id=\"stub_1_16\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Werder Bremen</th>\n<td headers=\"stub_1_16 club_diff\" class=\"gt_row gt_center\">&#128;48.80M</td></tr>\n    <tr><th id=\"stub_1_17\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Köln</th>\n<td headers=\"stub_1_17 club_diff\" class=\"gt_row gt_center\">&#128;28.34M</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" style=\"text-align: left;\" colspan=\"2\">Source: DFL &amp; Transfermarkt Via {worldfootballR}</td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\nI've filtered for teams that appear in three or more seasons in the data. I've mostly done this to reduce the list down a bit, but it also takes out the noisiest observations (though all are obviously pretty small sample, since the max is just six).\n\nWhen you compare the average difference between market value and squad costs between clubs, it is pretty obvious that the differences are a function of the quality of the team, or perhaps of the resources available to teams. I suspect this is probably picking up an issue with the squad values data. Squad values are updated regularly and will be responsive to player (and team) performances. Good teams play better and this leads to better teams seeing their values increase.\n\nAnother explanation could be that this is just a product of scales. The squad values are generally larger than the staff costs, but perhaps they are a certain percentage higher, on average, and for teams with larger staff costs that's inherently going to mean a bigger difference.\n\nI also considered the possibility that this might be driven by underlying temporal differences, plotted below.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  mutate(diff = squad_value - staff_cost) |>\n  summarise(season_diff = median(diff), .by = season) |>\n  ggplot(aes(forcats::as_factor(season), season_diff)) +\n  geom_col(position = \"dodge\", colour = \"#343a40\") +\n  geom_hline(yintercept = 0, colour = \"#343a40\") +\n  scale_y_continuous(\n    labels = scales::label_number(\n      scale_cut = scales::cut_short_scale(),\n      prefix = \"€\"\n    )\n  ) +\n  labs(\n    title = \"Average Difference Between Bundesliga Clubs' Squad Values & Staff Costs\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"Median average difference between Transfermarkt squad market values and \",\n        \"squad staff costs per season in the Bundesliga from 2017/18 - 2022/23.\"\n      ),\n      width = 93\n    ),\n    x = NULL,\n    y = \"Difference\\n(Value - Cost)\",\n    caption = \"Visualisation: Paul Johnson | Data: DFL & Transfermarkt Via {worldfootballR}\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/season-difference-1.png){width=672}\n:::\n:::\n\n\n\n\nThe difference doesn't appear to change all that much from season-to-season, with perhaps the exception being 2017/18. I think it's reasonable to assume there is not a significant temporal component going on here.\n\n### Correlations\n\nInitial exploration suggests that squad values are an effective proxy for staff costs (which are themselves a proxy for squad spending). The correlation between the two variables paints an even clearer picture. There is a **0.94** correlation between squad values and staff costs, which is pretty remarkable.\n\nWhen we visualise the association between the two, below, this further illustrates how closely tied together they are.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  ggplot(aes(x = staff_cost, y = squad_value)) +\n  geom_point(alpha = .4, size = 1, colour = \"#343a40\") +\n  geom_smooth(\n    method = lm,\n    colour = \"#026E99\",\n    linewidth = 1.2\n  ) +\n  scale_x_continuous(\n    labels = scales::label_number(\n      scale_cut = scales::cut_short_scale(),\n      prefix = \"€\"\n    )\n  ) +\n  scale_y_continuous(\n    labels = scales::label_number(\n      scale_cut = scales::cut_short_scale(),\n      prefix = \"€\"\n    )\n  ) +\n  labs(\n    title = \"Association Between Staff Costs & Squad Values in the Bundesliga\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"Comparing the association between staff costs and squad values in the \",\n        \"Bundesliga from 2017/18 - 2022/23.\"\n      ),\n      width = 93\n    ),\n    x = \"Staff Cost\",\n    y = \"Squad Value\",\n    caption = \"Visualisation: Paul Johnson | Data: FBref & Transfermarkt Via {worldfootballR}\"\n  ) +\n  theme(axis.text.x = element_text(angle = 30, vjust = 1, hjust = .75))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/costs-by-value-1.png){width=672}\n:::\n:::\n\n\n\n\nThe relationship between staff costs and squad values is incredibly clean. It is clearly linear, and any variance is only minimal.\n\nThere doesn't appear to be anything particularly systematic about the variance. At the lower end of staff costs it looks like squad values are a little undervalued, but the reverse is true as it increases. At the top end of staff costs, the squad values are all slightly undervalued. I think the top end of the staff costs will all be Bayern Munich (I'm not sure how much this matters).\n\nAll this paints a pretty clear picture. Squad values seem to be a very good approximation of staff costs.\n\n## Predictive Performance\n\nThe final test of squad values as an appropriate proxy for staff costs is to compare their predictive performance.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  tidyr::pivot_longer(\n    cols = c(pts, xgd, gd),\n    names_to = \"outcome\",\n    values_to = \"outcome_value\"\n  ) |>\n  tidyr::pivot_longer(\n    cols = c(squad_value, staff_cost),\n    names_to = \"metric\",\n    values_to = \"metric_value\"\n  ) |>\n  mutate(\n    outcome = case_when(\n      outcome == \"pts\" ~ \"Points\",\n      outcome == \"gd\" ~ \"Goal Difference\",\n      outcome == \"xgd\" ~ \"xG Difference\",\n      .default = outcome\n    ),\n    metric = case_when(\n      metric == \"squad_value\" ~ \"Squad Value\",\n      metric == \"staff_cost\" ~ \"Staff Cost\",\n    )\n  ) |>\n  ggplot(aes(x = metric_value, y = outcome_value)) +\n  geom_point(alpha = .4, size = 1) +\n  geom_smooth(\n    method = lm,\n    formula = y ~ log(x),\n    colour = \"#343a40\",\n    se = FALSE,\n    linewidth = 1,\n    alpha = .6\n  ) +\n  facet_grid(rows = vars(outcome), cols = vars(metric), scales = \"free\") +\n  scale_x_continuous(\n    labels = scales::label_number(\n      scale_cut = scales::cut_short_scale(),\n      prefix = \"€\"\n    )\n  ) +\n  # scale_y_continuous(\n  #   labels = scales::label_number(\n  #     scale_cut = scales::cut_short_scale(),\n  #     prefix = \"€\"\n  #   )\n  # ) +\n  labs(\n    # title = \"League Outcomes by Squad Value in the Big Five Leagues\",\n    # subtitle = stringr::str_wrap(\n    #   glue::glue(\n    #     \"Comparing the association between squad values and league outcomes - \",\n    #     \"points, goal difference, and xG difference - in the Big Five leagues \",\n    #     \"in Europe across the 2012/13 - 2023/24 seasons.\"\n    #   ),\n    #   width = 93\n    # ),\n    x = NULL,\n    y = NULL,\n    caption = \"Visualisation: Paul Johnson | Data: FBref & Transfermarkt Via {worldfootballR}\"\n  ) +\n  theme(\n    panel.spacing.x = unit(.3, units = \"cm\"),\n    axis.text.x = element_text(angle = 30, vjust = 1, hjust = .75)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/outcome-diffs-1.png){width=672}\n:::\n:::\n\n\n\n\n\n### Fit XGBoost Models\n\n<!-- * Next step is combining all the code below into helper functions, and then running them together for each of the outcomes. -->\n<!-- * Also need to check the code and see how it can be made more efficient/updated to recent tidymodels conventions. -->\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\nset.seed(42)\nsplits <- initial_split(buli_resources, prop = 0.8)\n\ntrain <- training(splits)\ntest <- testing(splits)\n\nset.seed(42)\nfolds <- vfold_cv(train, v = 10, repeats = 5)\n\npreprocess_data <- function(rec) {\n  rec |>\n    step_log(\n      case_when(\n        rec$var_info$variable[[1]] == \"squad_value\" ~ \"squad_value\",\n        rec$var_info$variable[[1]] == \"staff_cost\" ~ \"staff_cost\"\n      )\n    ) |>\n    step_novel(team) |>\n    step_dummy(all_factor_predictors()) |>\n    step_zv()\n}\n\nrec_value_pts <-\n  recipe(pts ~ squad_value + season + team, data = train) |>\n  preprocess_data()\n\nrec_cost_pts <-\n  recipe(pts ~ staff_cost + season + team, data = train) |>\n  preprocess_data()\n\nrec_value_gd <-\n  recipe(gd ~ squad_value + season + team, data = train) |>\n  preprocess_data()\n\nrec_cost_gd <-\n  recipe(gd ~ staff_cost + season + team, data = train) |>\n  preprocess_data()\n\nrec_value_xgd <-\n  recipe(xgd ~ squad_value + season + team, data = train) |>\n  preprocess_data()\n\nrec_cost_xgd <-\n  recipe(xgd ~ staff_cost + season + team, data = train) |>\n  preprocess_data()\n\nTREES <- 1200\nLEARN_RATE <- 0.005\n\nspec <- boost_tree(\n  trees = !!TREES,\n  learn_rate = !!LEARN_RATE,\n  # min_n = tune(),\n  tree_depth = tune(),\n  loss_reduction = tune(),\n  sample_size = tune(),\n  # mtry = tune(),\n  stop_iter = tune()\n) |>\n  set_engine(\"xgboost\") |>\n  set_mode(\"regression\")\n\nwf_sets <- workflow_set(\n  preproc = list(\n    value_pts = rec_value_pts,\n    cost_pts = rec_cost_pts,\n    value_gd = rec_value_gd,\n    cost_gd = rec_cost_gd,\n    value_xgd = rec_value_xgd,\n    cost_xgd = rec_cost_xgd\n  ),\n  models = list(model = spec),\n  cross = TRUE\n)\n\ncontrol <-\n  finetune::control_sim_anneal(\n    save_pred = TRUE,\n    parallel_over = \"everything\",\n    save_workflow = TRUE,\n    verbose = TRUE\n  )\n\ntuned_results <- workflow_map(\n  wf_sets,\n  fn = \"tune_sim_anneal\",\n  control = control,\n  metrics = metric_set(rmse, rsq),\n  resamples = folds,\n  seed = 42\n)\n\nMODELS <- c(\n  \"value_pts_model\" = \"Squad Value (Points)\",\n  \"cost_pts_model\" = \"Staff Cost (Points)\",\n  \"value_gd_model\" = \"Squad Value (Goal Diff)\",\n  \"cost_gd_model\" = \"Staff Cost (Goal Diff)\",\n  \"value_xgd_model\" = \"Squad Value (xG Diff)\",\n  \"cost_xgd_model\" = \"Staff Cost (xG Diff)\"\n)\n\nselect_best_model <- function(tuned_results, mod) {\n  tuned_results |>\n    extract_workflow_set_result(mod) |>\n    select_best(metric = \"rmse\") |>\n    transmute(\n      model_type = MODELS[mod],\n      # mtry,\n      tree_depth,\n      loss_reduction,\n      sample_size,\n      stop_iter\n    )\n}\n\n# best_value_pts <- select_best_model(tuned_results, \"value_pts_model\")\n# best_cost_pts <- select_best_model(tuned_results, \"cost_pts_model\")\n# best_value_gd <- select_best_model(tuned_results, \"value_gd_model\")\n# best_cost_gd <- select_best_model(tuned_results, \"cost_gd_model\")\n# best_value_xgd <- select_best_model(tuned_results, \"value_xgd_model\")\n# best_cost_xgd <- select_best_model(tuned_results, \"cost_xgd_model\")\n\n# bind_rows(\n#   best_value_pts,\n#   best_cost_pts,\n#   best_value_gd,\n#   best_cost_gd,\n#   best_value_xgd,\n#   best_cost_xgd\n# ) |>\n#   transmute(\n#     model_type,\n#     # mtry,\n#     tree_depth,\n#     loss_reduction,\n#     sample_size,\n#     stop_iter\n#   )\n\nfinalize_model <- function(tuned_results, model_type) {\n  best_set <- select_best_model(tuned_results, model_type)\n  tuned_results |>\n    extract_workflow(model_type) |>\n    finalize_workflow(best_set) |>\n    last_fit(\n      splits,\n      metrics = metric_set(rmse, rsq)\n    )\n}\n\nvalue_pts_final <- finalize_model(tuned_results, \"value_pts_model\")\ncost_pts_final <- finalize_model(tuned_results, \"cost_pts_model\")\nvalue_gd_final <- finalize_model(tuned_results, \"value_xgd_model\")\ncost_gd_final <- finalize_model(tuned_results, \"cost_xgd_model\")\nvalue_xgd_final <- finalize_model(tuned_results, \"value_xgd_model\")\ncost_xgd_final <- finalize_model(tuned_results, \"cost_xgd_model\")\n```\n:::\n\n\n\n\nI won't bother to walk through the code to fit the models since that isn't the focus of the post here, but I've fit and tuned XGBoost models for each of the three outcomes that I used in my original model — points, goal difference, xG difference — with season and team included as features, as well as squad values or staff costs. In total, this results in six different models.\n\nThe goal isn't to go to great lengths to fit perfect models. I've done a little tuning just for the hell of it, but the focus is really on just comparing the performance of the squad values and staff costs models.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\nvalue_pts_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard       7.10  Preprocessor1_Model1\n2 rsq     standard       0.828 Preprocessor1_Model1\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\ncost_pts_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard       9.78  Preprocessor1_Model1\n2 rsq     standard       0.572 Preprocessor1_Model1\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\nvalue_gd_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard       8.69  Preprocessor1_Model1\n2 rsq     standard       0.715 Preprocessor1_Model1\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\ncost_gd_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard      11.1   Preprocessor1_Model1\n2 rsq     standard       0.541 Preprocessor1_Model1\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\nvalue_xgd_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard       8.71  Preprocessor1_Model1\n2 rsq     standard       0.710 Preprocessor1_Model1\n```\n\n\n:::\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\ncost_xgd_final |> collect_metrics()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 4\n  .metric .estimator .estimate .config             \n  <chr>   <chr>          <dbl> <chr>               \n1 rmse    standard      11.1   Preprocessor1_Model1\n2 rsq     standard       0.548 Preprocessor1_Model1\n```\n\n\n:::\n:::\n\n\n\n\nThe results only serve to further confirm how well-aligned these two variables are. The squad values outperform the staff costs, but what is more important is that the performance is generally only a little better. It is consistently better, and I think the only reasonable conclusion is that this is because some performance bias is getting baked in, but the fact the performance is only slightly improved is a good sign.\n\n## Wrapping Up\n\nThere is very little difference between the two, and while it does seem like squad values are a little biased by performance, I don't think it is making such a difference that it's a big problem. It's just something to be aware of if using them as a proxy for something like squad costs.\n\n## Acknowledgments {.appendix}\n\nPreview image by [Tobias Rehbein](https://unsplash.com/@tobiasrehbein) on [Unsplash](https://unsplash.com/photos/a-soccer-ball-sitting-on-top-of-a-lush-green-field-CZ_HwDtvEus).\n\n## Support {.appendix}\n\nIf you enjoyed this blog post and would like to support my work, you can [buy me a coffee or a beer or give me a tip](https://www.buymeacoffee.com/paulj1989) as a thank you.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}