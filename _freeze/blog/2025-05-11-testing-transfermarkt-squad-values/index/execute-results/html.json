{
  "hash": "22acc7c4a23a9aa7e1a0d4e5d748499a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Testing Transfermarkt's Squad Market Values\nsubtitle: |\n  Get in losers, we're going validating.\ndescription-meta: |\n  Using data from the DFL's financial reports for all Bundesliga clubs to evaluate\n  whether Transfermarkt's squad market values are an adequate proxy for squad costs.\ndate: 2025-05-11\nimage: ball.webp\nimage-alt: |\n  A Derbystar Bundesliga match ball sitting on the turf of a football pitch.\ncategories: [Football Analytics, Statistics, Machine Learning, R]\nbibliography: references.bib\n---\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Setup Code (Click to Expand)\"}\n# import packages\nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(gt)\n  library(ggplot2)\n  library(tidymodels)\n})\n\n# setup fonts\nsysfonts::font_add_google(\"Poppins\")\nsysfonts::font_add_google(\"Lora\")\nshowtext::showtext_auto()\n\n# set plot theme\n# inspired by https://github.com/z3tt/TidyTuesday/blob/main/R/2020_31_PalmerPenguins.Rmd\ntheme_set(theme_minimal(base_size = 20, base_family = \"Poppins\")) +\n  theme_update(\n    panel.grid.major = element_line(color = \"grey90\", linewidth = .4),\n    panel.grid.minor = element_blank(),\n    panel.spacing.x = unit(.65, units = \"cm\"),\n    panel.spacing.y = unit(.3, units = \"cm\"),\n    axis.title.x = element_text(\n      color = \"grey30\",\n      margin = margin(t = 5),\n      size = rel(1.05),\n      lineheight = 0.55\n    ),\n    axis.title.y = element_text(\n      color = \"grey30\",\n      margin = margin(r = 5),\n      size = rel(1.05),\n      lineheight = 0.55\n    ),\n    axis.text = element_text(color = \"grey50\", size = rel(1)),\n    axis.ticks = element_line(color = \"grey90\", linewidth = .4),\n    axis.ticks.length = unit(.2, \"lines\"),\n    legend.position = \"top\",\n    legend.title = element_blank(),\n    legend.text = element_text(size = rel(.9)),\n    legend.box.margin = margin(0, 0, -10, 0),\n    legend.key.width = unit(1, units = \"cm\"),\n    plot.title = element_text(\n      hjust = 0,\n      color = \"black\",\n      family = \"Lora\",\n      size = rel(1.5),\n      margin = margin(t = 5, b = 5)\n    ),\n    plot.subtitle = element_text(\n      hjust = 0,\n      color = \"grey30\",\n      family = \"Lora\",\n      lineheight = 0.55,\n      size = rel(1.1),\n      margin = margin(5, 0, 15, 0)\n    ),\n    plot.title.position = \"plot\",\n    plot.caption = element_text(\n      color = \"grey50\",\n      size = rel(0.8),\n      hjust = 1,\n      margin = margin(10, 0, 0, 0)\n    ),\n    plot.caption.position = \"plot\",\n    plot.margin = margin(rep(10, 4)),\n    strip.text = element_text(size = rel(1), margin = margin(0, 0, 5, 0)),\n    strip.clip = \"off\"\n  )\n\n# set table theme\ntbl_theme <-\n  function(data, width = 100, alignment = \"center\") {\n    data |>\n      tab_source_note(\n        source_note = \"Source: DFL & Transfermarkt\"\n      ) |>\n      tab_options(\n        footnotes.marks = \"standard\",\n        footnotes.spec_ref = \"^i\",\n        footnotes.spec_ftr = \"()\",\n        table.width = pct(width),\n        table.align = alignment,\n        table.font.names = \"Poppins\"\n      ) |>\n      tab_style(\n        style = cell_text(align = \"left\"),\n        locations = list(cells_source_notes(), cells_footnotes())\n      )\n  }\n\n# load data\nbuli_resources <-\n  readr::read_rds(\n    here::here(\n      \"blog\",\n      \"2025-05-11-testing-transfermarkt-squad-values\",\n      \"data\",\n      \"buli_resources.rds\"\n    )\n  )\n```\n:::\n\n\nLast year, I wrote a [blog post](https://paulrjohnson.net/blog/analysing-money-in-football/) that modelled the effect that money has on outcomes in Europe's five biggest football leagues. The key explanatory variable in my model was Transfermarkt's squad market values. Squad value served as a proxy for a club's financial clout. The assumption was that clubs generally invest as much money in the team as possible, but data capturing the full extent of squad spending is challenging to source. Research shows Transfermarkt's player market values are strongly associated with transfer fees [@herm2014; @muller2017; @coates2022] and player salaries [@prockl2018], so I figured squad values would be an adequate proxy for squad spending. But what if I was wrong?\n\nA little over a month ago, I was [made aware](https://bsky.app/profile/ansgarw.bsky.social/post/3lm2hgpgxfc2j) of the DFL's (Deutsche Fussball Liga) [financial reports](https://www.dfl.de/de/hintergrund/lizenzierungsverfahren/finanzkennzahlen-der-proficlubs/) detailing the annual accounts for every club in the Bundesliga (and 2. Bundesliga). The accounts include each club's \"staff costs\", which is the amount each club spends on wages for all employees (including but not limited to playing staff). I think this will should be a close approximation of squad wage spending[^Costs]. Never one to miss an opportunity to make _content_, I went to work and grabbed six seasons of data from 2017/18 to 2022/23. Now, we can determine whether Transfermarkt's squad values are a reasonable proxy for the data I was too lazy to go and find myself. And more importantly, we can find out if I was wrong[^Wrong].\n\n[^Costs]:\n\nPlayers and playing staff will make up the majority of staff costs for all clubs, and I think it is reasonable to assume that non-playing staff costs will be directly related to playing staff costs (bigger teams like Bayern Munich will have more non-playing employees).\n\n[^Wrong]:\n\nIt is actually illegal to tell me I'm wrong.\n\n## Exploring the Data\n\nThe data is pretty solid, but it comes with some caveats. While most clubs report their staff costs on a seasonal basis, some report staff costs for the financial year. In those cases, the costs don't perfectly align with a single season, but I don't think the change in costs from season to season is significant enough to be a huge concern. I also had to drop Frankfurt's 2022/23 season[^Frankfurt] and Paderborn's 2021/22 season[^Paderborn] from the data.\n\nI'm not too worried that these caveats will cause any significant problems. Although the sample size is relatively small, the data seem sufficient for the question I'm trying to answer here.\n\n[^Frankfurt]:\n\nFrankfurt were one of the teams reporting their costs for the financial year, but in 2023, they switched to reporting costs over a season. To line their reports up, this meant the 2023 report is just the costs for the first six months of 2023 (so that the following season is on the correct schedule).\n\n[^Paderborn]:\n\nThe figures published in 2024 refer to the 2022/23 season, but the reports are organised by division, with all teams in the Bundesliga in the 2024/25 season in one report and the same for the 2. Bundesliga. For the most part, this was just an inconvenience. In 2022/23, however, Paderborn were relegated from the Bundesliga, followed by another relegation down to the 3. Liga in 2023/24. The trouble is, while the top two tiers in Germany are governed by the DFL, the third tier is governed by the DFB. Paderborn's consecutive relegations mean that they aren't included in these reports. It's despicable. The real victim here is me.\n\n### The Value-Cost Gap (Difference)\n\nFirst, it's probably worth comparing the squad values and staff costs directly to understand what we are working with. I will start by capturing the difference between the two and exploring how this figure varies across the dataset.\n\nPlotting the difference between squad value and staff costs below, we see that the gap between the two is sizeable, with squad value usually (but not always) larger.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Helper Function Code (Click to Expand)\"}\nscale_euros <- function(axes = c(\"both\", \"x\", \"y\"), expand = c(0.01, 0)) {\n  # euro label with short scale\n  label_euro <- scales::label_number(\n    scale_cut = scales::cut_short_scale(),\n    prefix = \"€\"\n  )\n\n  # return ggplot scales based on axis selection\n  switch(\n    axes[1],\n    x = list(scale_x_continuous(labels = label_euro, expand = expand)),\n    y = list(scale_y_continuous(labels = label_euro, expand = expand)),\n    both = list(\n      scale_x_continuous(labels = label_euro, expand = expand),\n      scale_y_continuous(labels = label_euro, expand = expand)\n    )\n  )\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  mutate(diff = squad_value - staff_cost) |>\n  ggplot(aes(x = diff)) +\n  geom_histogram(color = \"#343a40\", bins = 25) +\n  geom_hline(yintercept = 0, colour = \"#343a40\") +\n  scale_euros(axes = \"x\") +\n  labs(\n    title = \"Differences Between Squad Value & Staff Costs in the Bundesliga\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"The distribution of club value differences (squad value minus staff \",\n        \"costs) per season in the Bundesliga from 2017/18 to 2022/23.\"\n      ),\n      width = 95\n    ),\n    x = \"Value Difference\\n(Squad Value - Staff Costs)\",\n    y = NULL,\n    caption = \"Visualisation: Paul Johnson | Data: DFL & Transfermarkt\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/difference-distribution-1.png){fig-alt='A histogram visualising the distribution of club value differences (squad\nmarket value minus staff costs) per season from 2017/18 to 2022/23. The\ndistribution is right-skewed, peaking at around €50m with a long tail\nreaching over €500m.\n' width=672}\n:::\n:::\n\n\nThe difference between the two isn't an issue. Squad value and staff costs are different things. If they generally vary together, that will suffice.\n\nIt's also worth considering the team-level variance[^Time]. @tbl-team-difference shows the median difference between squad value and staff costs per season for clubs that have played three or more seasons in the data[^Filter].\n\n\n::: {#tbl-team-difference .cell tbl-cap='Median Value Differences in the Bundesliga from 2017/18 to 2022/23'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Table Code (Click to Expand)\"}\nbuli_resources |>\n  mutate(diff = squad_value - staff_cost) |>\n  add_count(team) |>\n  filter(n >= 3) |>\n  summarise(club_diff = median(diff), .by = team) |>\n  arrange(desc(club_diff)) |>\n  gt(rowname_col = \"team\") |>\n  cols_label(\n    club_diff = md(\"Value Difference<br>(Squad Value - Staff Costs)\")\n  ) |>\n  fmt_currency(\n    columns = club_diff,\n    currency = \"EUR\",\n    suffixing = TRUE,\n    decimals = 1\n  ) |>\n  cols_align(align = \"center\", columns = club_diff) |>\n  tab_style(\n    style = list(cell_fill(color = \"#f8f9fa\")),\n    locations = cells_body(rows = everything())\n  ) |>\n  tbl_theme()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"njzhxdfovj\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#njzhxdfovj table {\n  font-family: Poppins;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#njzhxdfovj thead, #njzhxdfovj tbody, #njzhxdfovj tfoot, #njzhxdfovj tr, #njzhxdfovj td, #njzhxdfovj th {\n  border-style: none;\n}\n\n#njzhxdfovj p {\n  margin: 0;\n  padding: 0;\n}\n\n#njzhxdfovj .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#njzhxdfovj .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#njzhxdfovj .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#njzhxdfovj .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#njzhxdfovj .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#njzhxdfovj .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#njzhxdfovj .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#njzhxdfovj .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#njzhxdfovj .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#njzhxdfovj .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#njzhxdfovj .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#njzhxdfovj .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#njzhxdfovj .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#njzhxdfovj .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#njzhxdfovj .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#njzhxdfovj .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#njzhxdfovj .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#njzhxdfovj .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#njzhxdfovj .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#njzhxdfovj .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#njzhxdfovj .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#njzhxdfovj .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#njzhxdfovj .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#njzhxdfovj .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#njzhxdfovj .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#njzhxdfovj .gt_left {\n  text-align: left;\n}\n\n#njzhxdfovj .gt_center {\n  text-align: center;\n}\n\n#njzhxdfovj .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#njzhxdfovj .gt_font_normal {\n  font-weight: normal;\n}\n\n#njzhxdfovj .gt_font_bold {\n  font-weight: bold;\n}\n\n#njzhxdfovj .gt_font_italic {\n  font-style: italic;\n}\n\n#njzhxdfovj .gt_super {\n  font-size: 65%;\n}\n\n#njzhxdfovj .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#njzhxdfovj .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#njzhxdfovj .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#njzhxdfovj .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#njzhxdfovj .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#njzhxdfovj .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#njzhxdfovj .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#njzhxdfovj .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#njzhxdfovj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"a::stub\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"club_diff\"><span data-qmd-base64=\"VmFsdWUgRGlmZmVyZW5jZTxicj4oU3F1YWQgVmFsdWUgLSBTdGFmZiBDb3N0cyk=\"><span class='gt_from_md'>Value Difference<br>(Squad Value - Staff Costs)</span></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Bayern Munich</th>\n<td headers=\"stub_1_1 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;463.3M</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Borussia Dortmund</th>\n<td headers=\"stub_1_2 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;400.1M</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_left gt_stub\">RB Leipzig</th>\n<td headers=\"stub_1_3 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;344.1M</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Bayer Leverkusen</th>\n<td headers=\"stub_1_4 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;276.0M</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Borussia Mönchengladbach</th>\n<td headers=\"stub_1_5 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;145.0M</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Hoffenheim</th>\n<td headers=\"stub_1_6 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;139.1M</td></tr>\n    <tr><th id=\"stub_1_7\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Frankfurt</th>\n<td headers=\"stub_1_7 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;125.0M</td></tr>\n    <tr><th id=\"stub_1_8\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Wolfsburg</th>\n<td headers=\"stub_1_8 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;111.5M</td></tr>\n    <tr><th id=\"stub_1_9\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Hertha BSC</th>\n<td headers=\"stub_1_9 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;103.2M</td></tr>\n    <tr><th id=\"stub_1_10\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Schalke</th>\n<td headers=\"stub_1_10 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;97.5M</td></tr>\n    <tr><th id=\"stub_1_11\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Freiburg</th>\n<td headers=\"stub_1_11 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;81.2M</td></tr>\n    <tr><th id=\"stub_1_12\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Mainz</th>\n<td headers=\"stub_1_12 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;77.1M</td></tr>\n    <tr><th id=\"stub_1_13\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Stuttgart</th>\n<td headers=\"stub_1_13 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;67.9M</td></tr>\n    <tr><th id=\"stub_1_14\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Augsburg</th>\n<td headers=\"stub_1_14 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;66.7M</td></tr>\n    <tr><th id=\"stub_1_15\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Union Berlin</th>\n<td headers=\"stub_1_15 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;51.9M</td></tr>\n    <tr><th id=\"stub_1_16\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Werder Bremen</th>\n<td headers=\"stub_1_16 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;48.8M</td></tr>\n    <tr><th id=\"stub_1_17\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Köln</th>\n<td headers=\"stub_1_17 club_diff\" class=\"gt_row gt_center\" style=\"background-color: #F8F9FA;\">&#8364;28.3M</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" style=\"text-align: left;\" colspan=\"2\">Source: DFL &amp; Transfermarkt</td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nLooking at @tbl-team-difference, it is obvious that the differences are at least partially a function of the team's quality or the resources available to teams. This probably identifies an issue with Transfermarkt's values. Squad values are updated regularly and will be responsive to player (and team) performances. Good teams play better, leading to better teams seeing their values increase.\n\nAnother explanation could be that this is just a product of scales. The squad values are generally larger than the staff costs, but perhaps they are a certain percentage higher, on average, and for teams with higher staff costs, that's inherently going to mean a bigger difference.\n\n[^Time]:\n\nI also looked at variance over time. The difference doesn't appear to change much from season to season, with perhaps the exception being 2017/18. I think it's reasonable to assume there is not a significant temporal component going on here.\n\n[^Filter]:\n\nMy main reason for filtering the data this way was to reduce the list of clubs included and make the table a little smaller. It also removes the noisiest observations (though all are obviously small samples since the maximum seasons are just six).\n\n### When Value Meets Reality (Correlation)\n\nIf the differences between squad value and staff costs are a mixed bag, the correlation between the two paints a clearer picture. There is a 0.94 correlation between squad value and staff costs, which is pretty remarkable.\n\nWhen we visualise the association between the two below, it further illustrates how closely tied they are.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  ggplot(aes(x = staff_cost, y = squad_value)) +\n  geom_point(alpha = 0.5, size = 2, colour = \"#343a40\") +\n  geom_smooth(\n    method = lm,\n    colour = \"#026E99\",\n    linewidth = 1.2,\n    alpha = 0.15\n  ) +\n  scale_euros() +\n  labs(\n    title = \"Squad Value by Staff Costs in the Bundesliga\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"The correlation between staff costs and squad value in the Bundesliga \",\n        \"from 2017/18 to 2022/23.\"\n      ),\n      width = 95\n    ),\n    x = \"Staff Costs\",\n    y = \"Squad Value\",\n    caption = \"Visualisation: Paul Johnson | Data: DFL & Transfermarkt\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/costs-by-value-1.png){fig-alt='A regression plot visualising the association between staff costs and squad\nvalue. The plot shows a positive linear association with relatively little\nvariance.\n' width=672}\n:::\n:::\n\n\nThe relationship is incredibly clean. It is clearly linear, and any variance is minimal. Squad values are undervalued at the lower end of staff costs, but the reverse is true, as it increases. At the top end of staff costs, the squad values are all slightly undervalued. Squad value seems to be an excellent approximation of staff costs from this perspective.\n\n## Comparing Predictive Performance\n\nThe final test of squad value's validity as a proxy for staff costs is to compare how well both predict Bundesliga outcomes. To remain consistent with the original model, I will use the outcomes used in my original blog post—points, goal difference, and expected goal (xG) difference—all standardised using games played (so their value represents outcome value per game).\n\nSquad value and staff costs are strongly correlated with all three league outcomes, as shown in @tbl-correlation.\n\n\n::: {#tbl-correlation .cell tbl-cap='Correlation Between Squad Value/Staff Costs & Bundesliga Outcomes'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Table Code (Click to Expand)\"}\n# compute correlations\ncorrelation_table <- buli_resources |>\n  select(squad_value, staff_cost, pts, gd, xgd) |>\n  correlation::correlation(\n    select = c(\"squad_value\", \"staff_cost\"),\n    select2 = c(\"pts\", \"gd\", \"xgd\")\n  ) |>\n  as_tibble() |>\n  mutate(\n    feature_set = if_else(\n      stringr::str_detect(Parameter1, \"squad_\"),\n      \"Squad Value\",\n      \"Staff Costs\"\n    ),\n    outcome = recode(\n      Parameter2,\n      pts = \"Points\",\n      gd = \"Goal Difference\",\n      xgd = \"xG Difference\",\n      .default = Parameter2\n    ),\n    outcome = forcats::fct(\n      outcome,\n      levels = c(\"Points\", \"Goal Difference\", \"xG Difference\")\n    )\n  ) |>\n  select(feature_set, outcome, r)\n\n# display correlation table\ncorrelation_table |>\n  gt(rowname_col = \"outcome\", groupname_col = \"feature_set\") |>\n  cols_label(r = \"Correlation\") |>\n  fmt_number(columns = r, decimals = 2, drop_trailing_zeros = TRUE) |>\n  cols_align(align = \"left\", columns = outcome) |>\n  cols_align(align = \"center\", columns = r) |>\n  tab_style(\n    # bold column spanners\n    style = cell_text(weight = \"bold\"),\n    locations = cells_column_spanners()\n  ) |>\n  tab_style(\n    # bold group labels\n    style = cell_text(weight = \"bold\"),\n    locations = cells_row_groups()\n  ) |>\n  tbl_theme()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"iohjdztzjd\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#iohjdztzjd table {\n  font-family: Poppins;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#iohjdztzjd thead, #iohjdztzjd tbody, #iohjdztzjd tfoot, #iohjdztzjd tr, #iohjdztzjd td, #iohjdztzjd th {\n  border-style: none;\n}\n\n#iohjdztzjd p {\n  margin: 0;\n  padding: 0;\n}\n\n#iohjdztzjd .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#iohjdztzjd .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#iohjdztzjd .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#iohjdztzjd .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#iohjdztzjd .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#iohjdztzjd .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#iohjdztzjd .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#iohjdztzjd .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#iohjdztzjd .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#iohjdztzjd .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#iohjdztzjd .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#iohjdztzjd .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#iohjdztzjd .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#iohjdztzjd .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#iohjdztzjd .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#iohjdztzjd .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#iohjdztzjd .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#iohjdztzjd .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#iohjdztzjd .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#iohjdztzjd .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#iohjdztzjd .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#iohjdztzjd .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#iohjdztzjd .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#iohjdztzjd .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#iohjdztzjd .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#iohjdztzjd .gt_left {\n  text-align: left;\n}\n\n#iohjdztzjd .gt_center {\n  text-align: center;\n}\n\n#iohjdztzjd .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#iohjdztzjd .gt_font_normal {\n  font-weight: normal;\n}\n\n#iohjdztzjd .gt_font_bold {\n  font-weight: bold;\n}\n\n#iohjdztzjd .gt_font_italic {\n  font-style: italic;\n}\n\n#iohjdztzjd .gt_super {\n  font-size: 65%;\n}\n\n#iohjdztzjd .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#iohjdztzjd .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#iohjdztzjd .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#iohjdztzjd .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#iohjdztzjd .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#iohjdztzjd .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#iohjdztzjd .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#iohjdztzjd .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#iohjdztzjd div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"a::stub\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"r\">Correlation</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Squad Value\">Squad Value</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Points</th>\n<td headers=\"Squad Value stub_1_1 r\" class=\"gt_row gt_center\">0.83</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Goal Difference</th>\n<td headers=\"Squad Value stub_1_2 r\" class=\"gt_row gt_center\">0.86</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_left gt_stub\">xG Difference</th>\n<td headers=\"Squad Value stub_1_3 r\" class=\"gt_row gt_center\">0.88</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"2\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Staff Costs\">Staff Costs</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Points</th>\n<td headers=\"Staff Costs stub_1_4 r\" class=\"gt_row gt_center\">0.75</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Goal Difference</th>\n<td headers=\"Staff Costs stub_1_5 r\" class=\"gt_row gt_center\">0.79</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_left gt_stub\">xG Difference</th>\n<td headers=\"Staff Costs stub_1_6 r\" class=\"gt_row gt_center\">0.81</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" style=\"text-align: left;\" colspan=\"2\">Source: DFL &amp; Transfermarkt</td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nAll three outcomes have stronger correlations with squad value than staff costs. The differences are relatively small, but they are consistent. However, the differences are barely perceptible when we plot the relationship between our two predictors and the Bundesliga outcomes below.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nbuli_resources |>\n  # reshape data to long format for outcomes and metrics\n  pivot_longer(\n    cols = c(pts, xgd, gd),\n    names_to = \"outcome\",\n    values_to = \"outcome_value\"\n  ) |>\n  pivot_longer(\n    cols = c(squad_value, staff_cost),\n    names_to = \"metric\",\n    values_to = \"metric_value\"\n  ) |>\n  mutate(\n    outcome = recode(\n      outcome,\n      pts = \"Points\",\n      gd = \"Goal Difference\",\n      xgd = \"xG Difference\",\n      .default = outcome\n    ),\n    outcome = forcats::fct(\n      outcome,\n      levels = c(\"Points\", \"Goal Difference\", \"xG Difference\")\n    ),\n    metric = if_else(metric == \"squad_value\", \"Squad Value\", \"Staff Costs\")\n  ) |>\n  ggplot(aes(x = metric_value, y = outcome_value)) +\n  geom_point(alpha = 0.5, size = 1.2, color = \"#343a40\") +\n  geom_smooth(\n    # log-linear trend lines\n    method = lm,\n    formula = y ~ log(x),\n    colour = \"#026E99\",\n    se = TRUE,\n    linewidth = 1,\n    alpha = 0.2\n  ) +\n  facet_grid(\n    # layout by outcome and metric\n    rows = vars(outcome),\n    cols = vars(metric),\n    scales = \"free\",\n    switch = \"y\"\n  ) +\n  scale_euros(axes = \"x\") +\n  labs(\n    title = \"Bundesliga Outcomes by Squad Value & Staff Costs\",\n    subtitle = stringr::str_wrap(\n      glue::glue(\n        \"Comparing squad value and staff costs' assocation with Bundesliga \",\n        \"outcomes—points, goal difference, and xG difference—from 2017/18 to \",\n        \"2022/23. Outcomes standardised by games.\"\n      ),\n      width = 93\n    ),\n    x = NULL,\n    y = NULL,\n    caption = \"Visualisation: Paul Johnson | Data: DFL & Transfermarkt\"\n  ) +\n  theme(\n    panel.spacing = unit(1, \"lines\"),\n    strip.placement = \"outside\",\n    panel.spacing.x = unit(.3, \"cm\"),\n    axis.text.x = element_text(angle = 30, vjust = 1, hjust = 0.8)\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/outcome-diffs-1.png){fig-alt='A faceted regression plot visualising the association between the predictors\n(squad value and staff cost) and the league outcomes (points, goal difference,\nand xG difference). There are a total of six plots, each showing a positive\nassociation, with both predictors log-transformed to fit a non-linear pattern\nin the data.\n' width=672}\n:::\n:::\n\n\nThe variance appears to be a little larger in the staff costs plots, particularly at around €100m, where the bulk of the observations are. Still, the difference is not obvious. I'm not sure I would have noticed the difference if I wasn't already aware of the slightly weaker correlation between staff costs and the league outcomes. Perhaps this is a me problem. Maybe I'm confessing my lack of attention to detail.\n\n### XGBoost Models\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Helper Functions Code (Click to Expand)\"}\n# preprocessing function\npreprocess_data <- function(recipe_obj) {\n  recipe_obj |>\n    step_log(any_of(c(\"squad_value\", \"staff_cost\"))) |>\n    step_novel(all_nominal_predictors()) |>\n    step_dummy(all_nominal_predictors()) |>\n    step_zv()\n}\n\n# target/predictor combination recipes function\ncreate_recipes <- function(targets, predictors) {\n  combos <- crossing(target = targets, predictor = predictors)\n\n  # set seed\n  furrr_opts <- furrr::furrr_options(seed = 42)\n\n  # create recipe list\n  recipes <- furrr::future_pmap(\n    combos,\n    function(target, predictor) {\n      recipe(\n        formula = as.formula(glue::glue(\n          \"{target} ~ {predictor} + season + team\"\n        )),\n        data = train\n      ) |>\n        preprocess_data()\n    },\n    .options = furrr_opts\n  )\n\n  # name list elements\n  names(recipes) <-\n    furrr::future_pmap_chr(\n      combos,\n      ~ glue::glue(\"{..1}_{..2}\"),\n      .options = furrr_opts\n    )\n\n  recipes\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Model Code (Click to Expand)\"}\n# set seed for reproducibility\nset.seed(42)\n\n# set up parallel backend\nfuture::plan(future::multisession, workers = parallel::detectCores() - 1)\n\n# split train/test data and specify folds\nsplits <- initial_split(buli_resources, prop = 0.7)\ntrain <- training(splits)\ntest <- testing(splits)\nfolds <- vfold_cv(train, v = 10, repeats = 5)\n\n# generate recipes\nrecipes <- create_recipes(\n  targets = c(\"pts\", \"gd\", \"xgd\"),\n  predictors = c(\"squad_value\", \"staff_cost\")\n)\n\n# xgboost model spec (with tuning)\nxgb_spec <- boost_tree(\n  trees = 1200,\n  learn_rate = 0.005,\n  tree_depth = tune(),\n  loss_reduction = tune(),\n  sample_size = tune(),\n  stop_iter = tune()\n) |>\n  set_engine(\"xgboost\") |>\n  set_mode(\"regression\")\n\n# workflow set from recipes and model\nwf_sets <- workflow_set(\n  preproc = recipes,\n  models = list(xgb = xgb_spec)\n)\n\n# tuning control\nctrl <- finetune::control_sim_anneal(\n  save_pred = TRUE,\n  parallel_over = \"everything\",\n  save_workflow = TRUE,\n  verbose = TRUE\n)\n\n# tune all workflows\ntuned_results <- workflow_map(\n  wf_sets,\n  fn = \"tune_sim_anneal\",\n  control = ctrl,\n  metrics = metric_set(rmse, rsq),\n  resamples = folds,\n  seed = 42\n)\n\n# stop future plan\nfuture::plan(future::sequential)\n```\n:::\n\n\nThe last step in this process is to fit some models that are doing far too much, considering they are ostensibly intended to compare the predictive power of two different features. I've fit and tuned six different XGBoost models, one each for squad value and staff costs across the three outcomes. Season and team have been included as additional features, similar to the original model[^MLM].\n\nI won't bother walking through the models in detail. The goal isn't to go to great lengths to fit perfect models. I've done a little tuning just for the hell of it[^Fit], but the focus is on comparing the performance of the squad value and staff costs models.\n\nModel performance, measured using root mean square error (RMSE) and R<sup>2</sup> is shown in @tbl-model-performance.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Helper Functions Code (Click to Expand)\"}\n# select the best parameters\nselect_best_model <- function(results, model_id) {\n  results |>\n    extract_workflow_set_result(model_id) |>\n    select_best(metric = \"rmse\")\n}\n\n# finalize and refit on full training data\nfinalize_and_fit_model <- function(results, model_id, data_split) {\n  best_params <- select_best_model(results, model_id)\n\n  results |>\n    extract_workflow(model_id) |>\n    finalize_workflow(best_params) |>\n    last_fit(split = data_split, metrics = metric_set(rmse, rsq))\n}\n\n# extract test performance metrics\nget_test_metrics <- function(results, model_id, data_split) {\n  finalize_and_fit_model(results, model_id, data_split) |>\n    collect_metrics()\n}\n```\n:::\n\n\n\n\n\n::: {#tbl-model-performance .cell tbl-cap='Performance of XGBoost Models Predicting Bundesliga Outcomes'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Table Code (Click to Expand)\"}\n# get test performance for all models\nsummary_table <-\n  tuned_results |>\n  mutate(\n    test_metrics = map(wflow_id, ~ get_test_metrics(tuned_results, .x, splits)),\n    feature_set = if_else(\n      stringr::str_detect(wflow_id, \"_squad\"),\n      \"Squad Value\",\n      \"Staff Costs\"\n    ),\n    outcome = case_when(\n      stringr::str_starts(wflow_id, \"pts\") ~ \"Points\",\n      stringr::str_starts(wflow_id, \"gd\") ~ \"Goal Difference\",\n      stringr::str_starts(wflow_id, \"xgd\") ~ \"xG Difference\"\n    ),\n    outcome = forcats::fct(\n      outcome,\n      levels = c(\"Points\", \"Goal Difference\", \"xG Difference\")\n    )\n  ) |>\n  arrange(outcome) |>\n  unnest(test_metrics) |>\n  pivot_wider(names_from = .metric, values_from = .estimate) |>\n  select(feature_set, outcome, rmse, rsq)\n\n# display metrics table\nsummary_table |>\n  gt(groupname_col = \"feature_set\", rowname_col = \"outcome\") |>\n  cols_label(\n    rmse = \"RMSE\",\n    rsq = html(\"R<sup>2</sup>\")\n  ) |>\n  fmt_number(\n    columns = c(rmse, rsq),\n    decimals = 2,\n    drop_trailing_zeros = TRUE\n  ) |>\n  cols_align(align = \"left\", columns = outcome) |>\n  cols_align(align = \"center\", columns = c(rmse, rsq)) |>\n  tab_spanner(label = \"Evaluation Metrics\", columns = c(rmse, rsq)) |>\n  tab_footnote(\n    footnote = html(\n      glue::glue(\n        \"Calculated using correlation (see \",\n        \"<a href='https://yardstick.tidymodels.org/reference/rsq.html'>\",\n        \"documentation</a>)\"\n      )\n    ),\n    locations = cells_column_labels(columns = \"rsq\")\n  ) |>\n  tab_footnote(\n    footnote = \"Standardised using games played\",\n    locations = cells_stub(rows = everything())\n  ) |>\n  tab_style(\n    style = list(cell_text(weight = \"bold\")),\n    locations = cells_column_spanners()\n  ) |>\n  tab_style(\n    style = list(cell_text(weight = \"bold\")),\n    locations = cells_row_groups()\n  ) |>\n  tbl_theme()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"wcraectzbm\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#wcraectzbm table {\n  font-family: Poppins;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#wcraectzbm thead, #wcraectzbm tbody, #wcraectzbm tfoot, #wcraectzbm tr, #wcraectzbm td, #wcraectzbm th {\n  border-style: none;\n}\n\n#wcraectzbm p {\n  margin: 0;\n  padding: 0;\n}\n\n#wcraectzbm .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 100%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#wcraectzbm .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#wcraectzbm .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#wcraectzbm .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#wcraectzbm .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#wcraectzbm .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#wcraectzbm .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#wcraectzbm .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#wcraectzbm .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#wcraectzbm .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#wcraectzbm .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#wcraectzbm .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#wcraectzbm .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#wcraectzbm .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#wcraectzbm .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcraectzbm .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#wcraectzbm .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#wcraectzbm .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#wcraectzbm .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcraectzbm .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#wcraectzbm .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcraectzbm .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#wcraectzbm .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcraectzbm .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#wcraectzbm .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#wcraectzbm .gt_left {\n  text-align: left;\n}\n\n#wcraectzbm .gt_center {\n  text-align: center;\n}\n\n#wcraectzbm .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#wcraectzbm .gt_font_normal {\n  font-weight: normal;\n}\n\n#wcraectzbm .gt_font_bold {\n  font-weight: bold;\n}\n\n#wcraectzbm .gt_font_italic {\n  font-style: italic;\n}\n\n#wcraectzbm .gt_super {\n  font-size: 65%;\n}\n\n#wcraectzbm .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#wcraectzbm .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#wcraectzbm .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#wcraectzbm .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#wcraectzbm .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#wcraectzbm .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#wcraectzbm .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#wcraectzbm .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#wcraectzbm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"a::stub\"></th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Evaluation Metrics\">\n        <div class=\"gt_column_spanner\">Evaluation Metrics</div>\n      </th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rmse\">RMSE</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rsq\">R<sup>2</sup><span class=\"gt_footnote_marks gt_asterisk\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>*</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"3\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Squad Value\">Squad Value</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Points<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Squad Value stub_1_1 rmse\" class=\"gt_row gt_center\">0.24</td>\n<td headers=\"Squad Value stub_1_1 rsq\" class=\"gt_row gt_center\">0.65</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Goal Difference<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Squad Value stub_1_2 rmse\" class=\"gt_row gt_center\">0.4</td>\n<td headers=\"Squad Value stub_1_2 rsq\" class=\"gt_row gt_center\">0.65</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_left gt_stub\">xG Difference<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Squad Value stub_1_3 rmse\" class=\"gt_row gt_center\">0.31</td>\n<td headers=\"Squad Value stub_1_3 rsq\" class=\"gt_row gt_center\">0.58</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"3\" class=\"gt_group_heading\" style=\"font-weight: bold;\" scope=\"colgroup\" id=\"Staff Costs\">Staff Costs</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Points<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Staff Costs stub_1_4 rmse\" class=\"gt_row gt_center\">0.3</td>\n<td headers=\"Staff Costs stub_1_4 rsq\" class=\"gt_row gt_center\">0.47</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_left gt_stub\">Goal Difference<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Staff Costs stub_1_5 rmse\" class=\"gt_row gt_center\">0.49</td>\n<td headers=\"Staff Costs stub_1_5 rsq\" class=\"gt_row gt_center\">0.47</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_left gt_stub\">xG Difference<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>†</sup></span></th>\n<td headers=\"Staff Costs stub_1_6 rmse\" class=\"gt_row gt_center\">0.36</td>\n<td headers=\"Staff Costs stub_1_6 rsq\" class=\"gt_row gt_center\">0.44</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" style=\"text-align: left;\" colspan=\"3\">Source: DFL &amp; Transfermarkt</td>\n    </tr>\n  </tfoot>\n  <tfoot class=\"gt_footnotes\">\n    <tr>\n      <td class=\"gt_footnote\" style=\"text-align: left;\" colspan=\"3\"><span style=\"white-space:nowrap;font-style:normal;font-weight:normal;line-height:0;\">(*)</span> Calculated using correlation (see <a href='https://yardstick.tidymodels.org/reference/rsq.html'>documentation</a>)</td>\n    </tr>\n    <tr>\n      <td class=\"gt_footnote\" style=\"text-align: left;\" colspan=\"3\"><span style=\"white-space:nowrap;font-style:normal;font-weight:normal;line-height:0;\">(†)</span> Standardised using games played</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n@tbl-model-performance shows a similar pattern to the correlations in @tbl-correlation. The squad value models consistently outperform the staff costs models across both metrics, especially R<sup>2</sup>. It's worth noting that the models are tuned on RMSE, so the variance in R<sup>2</sup> across the two sets of models is possibly a function of this. However, there is a sizable increase in RMSE, too.\n\nThe consistency of this finding, plus the evidence in @tbl-team-difference that the difference between squad value and staff costs is partially a function of team quality, suggests that squad value has some performance bias baked in. I don't think this invalidates squad values as a proxy for investment in the squad, but it does demonstrate a limitation in this approach.\n\n[^MLM]:\n\nSome minor differences exist between these models and those I fit in my earlier blog post. These differences are primarily due to the flexibility of the original model's multilevel structure, which allowed me to do a little more.\n\n[^Fit]:\n\nI used this post as an excuse to play around with [**future**](https://future.futureverse.org) and [**furrr**](https://furrr.futureverse.org), so I ended up going to greater lengths to tune the models, but only as a way to make better use of parallel processing.\n\n## How Reliable are Squad Values?\n\nThere is plenty of research that demonstrates the reliability of Transfermarkt's player market values (and by extension squad values) across a variety of contexts [@herm2014; @muller2017; @prockl2018; @smith2021; @coates2022; @james2022]. They are a decent approximation of player values on an open market [@transfermarkt2021], which makes them pretty handy for several different use cases. I think the evidence shown in this blog post suggests that a proxy for investment in squads is one of those use cases, but that conclusion does come with some caveats.\n\nGiven how [Transfermarkt's values are estimated](https://www.transfermarkt.com/market-value-definition/thread/forum/357/thread_id/3433), I think there will obviously be some performance bias. Historic squad values are a snapshot from previous seasons, and they appear to be an average across the season[^Values]. As a consequence, adjustments to player values due to performance will have some impact on squad values.\n\nIt's also worth noting that I'm using a small sample of data limited only to the Bundesliga[^Limitations], which reduces how much we can infer from this. Evidence shows that player values vary in predictive value by league [@muller2017; @coates2022], so findings based on a handful of seasons in a single league should be understood within their limited scope.\n\nStill, I think the results support the idea that Transfermarkt's squad values are a reasonable proxy for squad spending. Regarding my model specifically, I think the structure of the model should help negate some of these issues, particularly the effects of partial pooling. Generally, though, squad value and staff costs are almost perfectly correlated. While the squad value models are consistently better, I don't think they are so different that it invalidates using squad value as a proxy.\n\nInstead, I think it is something to be aware of if using squad values in this context. Every approach will have limitations, but if you can identify them, discuss them in your analysis, and even point to the specific ways they impact your model, you should be in a good place. With squad values, better the devil you know.\n\n[^Values]:\n\nI'm unsure how historic squad values are derived, but they don't appear to align with values at a specific point in the season, so I assume they are average. A workaround would be to recreate preseason squad values by scraping Transfermarkt's player values over time (shout out to [John Muller](https://johnspacemuller.com) for pointing this one out to me).\n\n[^Limitations]:\n\nAnd while I am confident that staff and squad costs will be roughly equivalent, this adds another layer of potential noise.\n\n## Acknowledgments {.appendix}\n\nMany thanks to [Ansgar Wolsing](https://bsky.app/profile/ansgarw.bsky.social) for pointing me to the staff costs data I used in this blog post.\n\nPreview image by [Tobias Rehbein](https://unsplash.com/@tobiasrehbein) on [Unsplash](https://unsplash.com/photos/a-soccer-ball-sitting-on-top-of-a-lush-green-field-CZ_HwDtvEus).\n\n## Support {.appendix}\n\nIf you enjoyed this blog post and would like to support my work, you can [buy me a coffee or a beer or give me a tip](https://www.buymeacoffee.com/paulj1989) as a thank you.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}