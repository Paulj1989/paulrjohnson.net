{
  "hash": "3cb2d89c34f1b5937cccf34f3b652963",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: |\n  Missing Data Matters (Part I): Mechanisms\nsubtitle: |\n  Missing values hate him! See how this data scientist turned NAs into NOs using \n  this one simple trick!\ndescription-meta: |\n  Exploring the different types of missing data - MCAR, MAR, and MNAR - and the \n  implications for your analysis of finding these different types of missing data \n  in your dataset.\nauthor: Paul Johnson\ndate: 2024-03-14\nimage: missing_data.webp\nimage-alt: |\n  An AI generated image of a red milk carton that has a creepy, slightly distorted \n  outline of a face on the side of the carton, with text underneath the person's\n  face appearing to say Data Missing (in the typically gibberish way that generative \n  models draw text). The carton stands in front of a white-tiled wall and casts \n  an ominous shadow on a white countertop.\ncategories: [Missing Data, Statistics, R]\nbibliography: references.bib\n---\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Setup Code (Click to Expand)\"}\n# import packages\nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(ggplot2)\n})\n\n# helper function for transforming factor variables to title case\nstr_titlecase_fct <-\n  function(x, ...) {\n    levels(x) <-\n      stringr::str_to_title(stringr::str_replace(levels(x), ...))\n    x\n  }\n\n# import data\nattrition <-\n  modeldata::attrition |>\n  as_tibble() |>\n  janitor::clean_names() |>\n  mutate(\n    across(\n      where(is.factor), \n      ~ str_titlecase_fct(.x, \"_\", \" \"))\n  )\n\n# setup fonts\nsysfonts::font_add_google(\"Poppins\")\nsysfonts::font_add_google(\"Lora\")\nshowtext::showtext_auto()\n\n# set plot theme\n# inspired by https://github.com/z3tt/TidyTuesday/blob/main/R/2020_31_PalmerPenguins.Rmd\ntheme_set(theme_minimal(base_size = 20, base_family = \"Poppins\")) +\n  theme_update(\n    panel.grid.major = element_line(color = \"grey90\", linewidth = .4),\n    panel.grid.minor = element_blank(),\n    axis.title.x = element_text(\n      color = \"grey30\", margin = margin(t = 5), size = rel(1.05)\n      ),\n    axis.title.y = element_text(\n      color = \"grey30\", margin = margin(r = 5), size = rel(1.05)\n      ),\n    axis.text = element_text(color = \"grey50\", size = rel(1)),\n    axis.ticks = element_line(color = \"grey90\", linewidth = .4),\n    axis.ticks.length = unit(.2, \"lines\"),\n    legend.position = \"top\",\n    legend.title = element_blank(),\n    legend.text = element_text(size = rel(1)),\n    legend.box.margin = margin(0, 0, -15, 0),\n    plot.title = element_text(\n      hjust = 0, color = \"black\", family = \"Lora\",\n      size = rel(1.5), margin = margin(t = 5, b = 5)\n    ),\n    plot.subtitle = element_text(\n      hjust = 0, color = \"grey30\", family = \"Lora\",\n      lineheight = 0.5, size = rel(1.1), \n      margin = margin(5, 0, 5, 0)\n    ),\n    plot.title.position = \"plot\",\n    plot.caption = element_text(\n      color = \"grey50\", size = rel(0.8), hjust = 1,\n      margin = margin(10, 0, 0, 0)\n    ),\n    plot.caption.position = \"plot\",\n    plot.margin = margin(rep(10, 4)),\n    strip.text = element_text(size = rel(1), margin = margin(0, 0, 5, 0))\n  )\n```\n:::\n\n\nI recently presented a talk about missing data, discussing the different types of missing data and their appropriate solutions. As a modern man who understands that the posting never ends, I figured I could turn this talk into a series of blog posts. Resources discussing missing data often offer either brief overviews or incredible depth, but there are fewer resources out there that thread the needle between the two. My goal is to do that with this series.\n\nIt turns out that missing data is a rich field. There is far more to it than simply pretending you didn't see it, like seeing a friend's child misbehaving. It's not my problem unless I make it my problem, right? Wrong. Unlike your friend's child, there are consequences to not taking some responsibility for missing data. This series will make a case for taking missing data seriously. This first post will introduce the key concepts in this area, focusing on identifying missing data and its types. The second blog post will look at solutions to these missing data problems, illustrating the when's and why's of these solutions. Please enjoy my regurgitated data slop. \n\nThe data used as an illustration in this series is a synthetic [employee attrition](https://modeldata.tidymodels.org/reference/attrition.html) dataset taken from the [**modeldata**](https://modeldata.tidymodels.org/) package, created by the IBM Watson Analytics Lab. The dataset contains 1,470 observations and is picture-perfect, containing nothing but observations that wouldn't dream of being missing. Instead, I will invoke missingness by replacing values with NAs.\n\n## Confessing My Sins\n\nMissingness is a common problem in data, but it doesn't receive the attention it deserves, and as a result, it often goes unaddressed in analyses. I have been guilty of this plenty of times in the past. I'm sure many of us have been.\n\nIt is easy to ignore missing data if you want to. Most statistical tools and programming languages have default mechanisms for dealing with NAs when encountered in the data, which is necessary because missing data is so common. Not having a method for resolving NAs would trip these tools up constantly. However, this produces unintended consequences. It makes it far too easy for the user to pass the buck and practice abstinence when it comes to missing data.\n\nMissing data is the drawer in your fridge filled with soggy vegetables you hope someone else will deal with. Out of sight, out of mind. I'm just that insufferable productivity guy telling you that your chores won't seem like such a big deal if you do them as soon as they come up. Dealing with missing data is choosing a healthy lifestyle. It's your regular sleep schedule.\n\n## Missing Data Mechanisms {#sec-mechanisms}\n\n@rubin1976 laid a lot of the groundwork for how we think about missing data today. He argued that all observations in a dataset have some likelihood of being missing, referring to this process as the missing data mechanism. He specifies three different mechanisms that cause missing data - missing completely at random (MCAR), missing at random (MAR), and missing not at random (MNAR). I think this terminology can be a little confusing. The difference between MCAR and MAR is not clear from their names. I would define these three categories as follows:\n\n- Missing Completely at Random (MCAR) -- the probability of an observation being missing is the same for all cases, implying that the cause of missing values is unrelated to the data [@vanbuuren2018]. MCAR data is not associated with other variables in the dataset and is uniformly random within-variable. In other words, it is **completely** random^[However, as @tierney2022 noted, data missing completely at random does not mean values are missing for no reason. Something must have caused the missingness, but the missingness is uniformly distributed and unrelated to observed values.].\n\n- Missing at Random (MAR) -- the probability of an observation being missing is uniformly distributed within that variable, meaning that all potential values are equally as likely to be missing. However, missing data is associated with other variables in the data. The observed values of correlated variables could be used to predict missing values.\n\n- Missing Not at Random (MNAR) -- the probability of an observation being missing is not random, and the mechanism that underpins missing values is unknown. Missing values follow a pattern, but that pattern is a function of unobserved data, whether it be the variable's values themselves (for example, values over a certain threshold are all missing) or an unobserved variable.\n\nFor a more detailed explanation of the differences between MCAR, MAR, and MNAR data, I'd recommend the [_Concepts of MCAR, MAR and MNAR_](https://stefvanbuuren.name/fimd/sec-MCAR.html) section of @vanbuuren2018's book to help make sense of the differences^[I would also recommend the [_Concepts in Incomplete Data_](https://stefvanbuuren.name/fimd/sec-idconcepts.html) section of his book if you are looking for more precise definitions of MCAR, MAR, and MNAR data.]. \n\nThe plots below illustrate how the different missing data mechanisms might impact a variable's distribution.\n\n::: {.panel-tabset}\n\n### Original Data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nplot_satisfaction <-\n  function(data) {\n    data |>\n      ggplot(aes(\n        x = years_at_company,\n        fill = forcats::fct_rev(job_satisfaction)\n      )) +\n      geom_histogram(binwidth = 1, colour = \"grey20\") +\n      geom_hline(yintercept = 0, colour = \"grey20\", linewidth = 0.8) +\n      scale_fill_manual(\n        values = c(\"#026E99\", \"#6C9ABA\", \"#B0C8DC\", \"#F2F9FF\"),\n        labels = snakecase::to_title_case\n      ) +\n      labs(\n        x = \"Years at Company\", y = NULL,\n        caption = \"Visualisation: Paul Johnson  |  Data: IBM Watson Analytics Lab\"\n        )\n  }\n\nattrition |>\n  plot_satisfaction() +\n  labs(\n    title = \"No Missing Data\",\n    subtitle =\n      stringr::str_wrap(\n        glue::glue(\n          \"The distribution of Years at Company, conditional on Job Satisfaction, \",\n          \"with no missing data.\"\n          ),\n        width = 95\n      )\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/original-dist-1.png){fig-alt='A histogram visualising the distribution of the total years that employees\nhave worked at their company, conditional on their job satisfaction,\nwithout any missing data. The distribution is right-skewed, with the\nmajority of employees\\' tenures falling below ten years, but some employees\nworking at their company for up to 40 years.\n' width=672}\n:::\n:::\n\n\n### MCAR\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nset.seed(123)\n\nattrition |>\n  mutate(\n    years_at_company = replace(\n      years_at_company,\n      runif(n()) < 0.5, NA\n    )\n  ) |>\n  plot_satisfaction() +\n  labs(\n    title = \"Missing Completely at Random (MCAR)\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The distribution of Years at Company, conditional on Job Satisfaction, \",\n          \"when Years at Company has been transformed to NA, at random, for 50% \",\n          \"of all employees.\"\n        ),\n      width = 95\n      )\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/mcar-dist-1.png){fig-alt='A histogram visualising the distribution of the total years that employees\nhave worked at their company, conditional on their job satisfaction,\nwith MCAR data. The shape of the distribution is similar to the original\ndata distribution.\n' width=672}\n:::\n:::\n\n\n### MAR\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nset.seed(123)\n\nattrition |>\n  mutate(\n    years_at_company =\n      replace(\n        years_at_company,\n        runif(n()) < 0.8 & job_satisfaction == \"Low\", NA\n      )\n  ) |>\n  plot_satisfaction() +\n  labs(\n    title = \"Missing at Random (MAR)\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The distribution of Years at Company, grouped by Job satisfaction, \",\n          \"when employee tenure has been transformed to NA, at random, for \",\n          \"80% of all employees with low job satisfaction.\"\n          ),\n        width = 95\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/mar-dist-1.png){fig-alt='A histogram visualising the distribution of the total years that employees\nhave worked at their company, conditional on their job satisfaction,\nwith MAR data. The shape of the distribution is similar to the original\ndata distribution, but the share of employees with low job satisfaction is\nsignificantly lower across the whole distribution.\n' width=672}\n:::\n:::\n\n\n### MNAR\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nattrition |>\n  mutate(\n    years_at_company =\n      replace(\n        years_at_company,\n        !between(years_at_company, 5, 30), NA\n      )\n  ) |>\n  plot_satisfaction() +\n  labs(\n    title = \"Missing Not at Random (MNAR)\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The distribution of Years at Company, conditional on Job Satisfaction, \",\n          \"when Years at Company has been transformed to NA for all employees \",\n          \"with less than five or more than thirty years at the company.\"\n        ),\n        width = 95\n      )\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/mnar-dist-1.png){fig-alt='A histogram visualising the distribution of the total years that employees\nhave worked at their company, conditional on their job satisfaction,\nwith MNAR data. The shape of the distribution is even more right-skewed than\nthe original data distribution, with the largest bar being the furthest left\nbar. The distribution has a smaller range, with 5 being the minimum and 30\nbeing the maximum.\n' width=672}\n:::\n:::\n\n\n:::\n\nThe type of missing data you're dealing with can significantly impact a variable's distribution and bias your precious estimates. The extent of the problem depends on the missing data mechanism and the amount of missingness. Data that is MCAR provides more flexibility than data that is MAR. If you catch wind of MNAR data, you are in real trouble.\n\n## Diagnosing Mechanisms\n\nFinding missing data is the first step, but understanding why it is missing matters most. I recognise I'm arguing in favour of creating more work for yourself, but there is good news - it is also hard to identify the missing data mechanism. The mechanism will not be explicitly detailed as it has been for the plots in @sec-mechanisms. In the wild, you can't observe the missing values or the population distribution for comparison, so you won't be able to identify the source of your missing values conclusively.\n\nTo make matters worse, it is not possible to conclusively define the missing data mechanism because you cannot observe the missing values or the population distribution the observed values came from. It's not that I'm saying it is guesswork. But I'm not **not** saying that it's guesswork...^[I am, in fact, not saying that you should be guessing the missing data mechanism. Making evidence-based deductions is not guessing. It's just uncertain and noisy.] \n\n### Exploring Missing Data\n\nThere are lots of good resources for learning how to effectively diagnose the missing data mechanism, so in the interest of not turning this blog post into a tome, I won't go into incredible detail about this process. @tierney2022's [_The Missing Book_](https://tmb.njtierney.com/) is fantastic for learning about the missing data exploratory analysis workflow using the R package [**naniar**](https://naniar.njtierney.com/)^[The [_Getting Started with **naniar**_](https://naniar.njtierney.com/articles/getting-started-w-naniar.html) and [_Gallery of Missing Data Visualisations_](https://naniar.njtierney.com/articles/naniar-visualisation.html) vignettes also detail various approaches to exploring missing data.]. The [**mice**](https://amices.org/mice/) and [**ggmice**](https://amices.org/ggmice/) R packages offer additional functionality for investigating missingess^[**mice**'s [_Missingness Inspection_](https://www.gerkovink.com/miceVignettes/Missingness_inspection/Missingness_inspection.html) vignette details an example analysis of missing data.]. Instead of detailing an entire exploratory workflow, I will give a brief overview, with example plots^[Some plots didn't use the listed packages but can be easily reproduced using functions from those packages. They won't be as aesthetically pleasing, but that doesn't matter for exploratory purposes (it only matters for my silly little blog).].\nWhile not exhaustive, it will hopefully serve as inspiration to get you started.\n\nI've transformed the attrition dataset to include missing data spread across multiple variables. Most missing data is MCAR, but the years an employee has spent at the company is MAR. Missing values for employee tenure are associated with low job satisfaction and high monthly income (greater than $15k per month).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Data Code (Click to Expand)\"}\nset.seed(123)\n\nmissing_data <-\n  attrition |>\n  mutate(\n    across(starts_with(\"job\") & !job_satisfaction, \n           ~ replace(.x, runif(n()) < 0.01, NA)),\n    years_at_company =\n      replace(\n        years_at_company,\n        runif(n()) < 0.75 & \n          (job_satisfaction == \"Low\" | monthly_income > 15000), NA\n        ),\n    relationship_satisfaction = \n      replace(relationship_satisfaction, runif(n()) < 0.075, NA),\n    work_life_balance = replace(work_life_balance, runif(n()) < 0.05, NA)\n  )\n```\n:::\n\n\nThe starting point in any exploratory analysis of missing data is to get some idea of the quantity of missingness and where it is. The plot below^[Created with the help of CÃ©dric Scherer's [-@scherer2021; -@scherer2023] excellent guidance on labelling bar plots.] summarises the missingness in the attrition dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nmissing_data |> \n  summarise(across(everything(), ~ sum(is.na(.x))/n()) ) |> \n  tidyr::pivot_longer(\n    cols = everything(), names_to = \"variable\", values_to = \"value\"\n    ) |> \n  filter(value != 0) |>\n  mutate(\n    variable = \n      stringr::str_to_title(\n        stringr::str_replace_all(variable, \"_\", \" \")\n        ),\n    variable = forcats::fct_reorder(variable, -value, .desc = TRUE)\n    ) |> \n  ggplot(aes(x = variable,  y = value)) +\n  geom_col(aes(fill = as.numeric(variable) == 6), colour = \"grey20\") +\n  geom_text(\n    aes(\n      label = paste0(sprintf(\"%2.1f\", value * 100), \"%\"),\n      colour = value > .03, hjust = if_else(value > .03, 1.2, -.2)\n      ),\n    size = 8, fontface = \"bold\", family = \"Poppins\"\n  ) +\n  geom_hline(yintercept = 0, colour = \"grey20\", linewidth = 0.8) +\n  coord_flip() +\n  scale_x_discrete(\n    name = NULL, labels = scales::label_wrap(15)\n    ) +\n  scale_y_continuous(guide =\"none\", name = NULL, expand = c(1e-03, 1e-03)) +\n  scale_fill_manual(values = c(\"grey50\", \"#026E99\"), guide = \"none\") +\n  scale_colour_manual(values = c(\"grey20\", \"white\"), guide = \"none\") +\n  labs(\n    title = \"Proportion of Values Missing for All Variables\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The percentage of missing values for variables that contain \",\n          \"missingness. Relationship Satisfaction and Work Life Balance contain \",\n          \"significant missing values, but Years at Company has ~3x as many as \",\n          \"any other variable.\"\n        ),\n        width = 93\n      ),\n    caption = \n      \"Visualisation: Paul Johnson  |  Data: IBM Watson Analytics Lab\"\n  ) +\n  theme(\n    plot.subtitle = element_text(margin = margin(5, 0, 10, 0)),\n    axis.text.y = element_text(\n      colour = \"grey30\", size = rel(1.2), hjust = 0.5, \n      margin = margin(0, 0.5, 0, 0.5), lineheight = .4\n      ),\n    axis.ticks = element_blank()\n    )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/percent-missing-1.png){fig-alt='A bar chart visualising the proportion of missing values for each variable,\nexcluding any variables that do not have any missing values. There are six\nvariables with missing values - years at company (21%), relationship\nsatisfaction (7.1%), work life balance (5.2%), job role (1.1%), job level\n(0.9%), and job involvement (0.7%).\n' width=672}\n:::\n:::\n\n\nHaving already detailed what I did when adding missingness to the data, I feel a little silly not just visualising this but now describing the results. It turns out that there are a bunch of missing values spread across six variables, but the biggest culprit is an employee's tenure at the company. Astonishing. Whoever could have predicted this?\n\nA rigorous analysis would look at each variable and diagnose the mechanism driving the missingness. Given I'm the underlying cause for all missing values, we will take the shortcut and focus on employee tenure.\n\n### Assume MAR; Test MNAR/MCAR\n\nGenerally speaking, MCAR data is rare. Missing values can occur for many reasons, and the likelihood that the cause is independent of all other variables is low.\n\nIt is more plausible that the data is either MAR or MNAR [@nahhas2024]. However, dealing with MNAR data is particularly complicated^[It requires specifying a missing data model and doing difficult things like sensitivity analysis [@vanbuuren2018; @nahhas2024].]. It is reasonable to assume your data is MAR until you find enough evidence to suggest otherwise (in either direction).\n\nIn practice, identifying the type of missingness you're dealing with requires exploratory analysis, domain expertise, and good judgment. Testing the assumption that your data is not MNAR involves exploring missing values and looking for evidence that missingness may not be random. For example, observed values may be constrained at a value lower than your expertise suggests should be the maximum, indicating some censoring of the variable. Simple summary functions and plotting distributions can uncover evidence that missing values are non-random. However, concluding that data is MNAR requires domain expertise and a good understanding of your data. \n\nIt is a little easier to test the assumption data is not MCAR because any association between observed and missing values acts as evidence data is MAR.\nOne way to look for associations is to create a binary variable that represents a variable's missingness using `naniar::bind_shadow()` and plotting the distribution of other variables conditional on missingness. Spikes in the distribution of missing values, relative to the distribution of observed values, indicate a correlation between that variable and the missing values.\n\nThe plot below visualises the monthly income distribution, conditional on employee tenure's missingness. A thorough analysis would require digging to find associations, but I'm cheating and already know where to look. \n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nmissing_data |> \n  naniar::bind_shadow() |> \n  ggplot(aes(x = monthly_income, fill = forcats::fct_rev(years_at_company_NA))) + \n  geom_histogram(position = \"dodge\", colour = \"grey20\") +\n  geom_hline(yintercept = 0, colour = \"grey20\", linewidth = 0.8) +\n  scale_fill_manual(\n    labels = c(\"Missing\", \"Not Missing\"), \n    values = c(\"#D93649\", \"#026E99\")\n    ) +\n  scale_x_continuous(labels = scales::label_currency()) +\n  labs(\n    title = \"Years at Company Missingness Distribution\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The distribution of Monthly Income conditional on the missingness of \",\n          \"Years at Company. While the distribution of not missing values has a \",\n          \"is much larger scale across the majority of the income range, \",\n          \"there are more missing values from $15-20k.\"\n        ),\n        width = 95\n      ),\n    x = \"Monthly Income\", y = NULL,\n    caption = \n      \"Visualisation: Paul Johnson  |  Data: IBM Watson Analytics Lab\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/missingness-distribution-1.png){fig-alt='A histogram visualising the distribution of employee monthly income,\nconditional on whether years at company is missing or not. The histogram\nshows a distribution in blue, representing the values that are not missing,\nwhich is much larger than the red distribution, representing the missing\nvalues. While the scale of the distributions differ, the shapes are similar.\nHowever, at the highest values of monthly income, over $15,000, there are\nmore missing values than not missing values.\n' width=672}\n:::\n:::\n\n\nWe expect the missing data distribution to follow a similar pattern to the observed values if it is MCAR. That is more or less the case for the monthly income distribution, but there is a spike at the higher end from around $15-20k. That suggests we might be dealing with MAR data.\n\nWe can also use `naniar::geom_miss_point()` to plot the association between employee tenure and income, and we can facet the data into separate plots for each level of job satisfaction (since we already know that job satisfaction is associated with tenure missingness).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot Code (Click to Expand)\"}\nmissing_data |>  \n  ggplot(aes(x = years_at_company, y = monthly_income)) +\n  naniar::geom_miss_point(size = 1, alpha = 0.8) + \n  facet_wrap(vars(job_satisfaction)) +\n  scale_colour_manual(values = c(\"#D93649\", \"#026E99\")) +\n  scale_y_continuous(labels = scales::label_currency()) +\n  guides(colour = guide_legend(override.aes = list(size = 3))) +\n  labs(\n    title = \"Years at Company Missingness Associations\",\n    subtitle = \n      stringr::str_wrap(\n        glue::glue(\n          \"The association between Years at Company and Monthly Income, \",\n          \"conditional on Years at Company's missingness and split by Job \",\n          \"Satisfaction. For low satisfaction, missing values are distributed \",\n          \"across all values of monthly income. For all other levels of \",\n          \"satisfaction, missing values are clustered between $15k and $20k.\",\n        ),\n        width = 92\n      ),\n    x = \"Years at Company\", y = \"Monthly Income\",\n    caption = \n      \"Visualisation: Paul Johnson  |  Data: IBM Watson Analytics Lab\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/missingness-associations-1.png){fig-alt='A grid of four scatter plots showing the association between years at\ncompany and monthly income, conditional on whether years at company is\nmissing or not and split by job satisfaction. The four plots show a noisy\nbut positive relationship between years at copany and monthly income, and\nfor medium, high, and very high job satisfaction there is a cluster of\nmissing values between $15000 and $20000. For low job satisfaction, there\nare much more missing values, making up the majority of the observations\nin this scatter plot, and they cover the full range of monthly incomes,\nfrom below $5000 to $20000.\n' width=672}\n:::\n:::\n\n\nWhile the income distribution indicated that employee tenure might contain missing values that are not MCAR, the above scatter plots provide strong evidence we're dealing with MCAR data. The scatter plots show that missing values are limited to the $15-20k monthly income range, except when job satisfaction is low, where missingness exists across all incomes. If we observed something like this in the wild, we would confidently conclude that tenure missingness is strongly associated with monthly income and job satisfaction and is, therefore, **not** MCAR.\n\nIt is also possible to compute statistical tests of the association between missing values and the observed values in the data. One option is to model missing values using logistic regression, treating missingness as the binary outcome (using `naniar::shadow_bind()` as before) and the rest of the dataset as explanatory variables. Another option is to use **naniar**'s `mcar_test()` to calculate @little1988's test statistic for MCAR data^[@little1988's MCAR test tests for mean differences on all variables in the dataset, split by subgroups that share the same missing data pattern. Subgroup observed means are compared against expected means, calculated using the expectation-maximisation algorithm, and this difference forms the basis of the test. The null hypothesis is that the data is MCAR, and the computed test statistic is a chi-squared value.]. @tbl-mcar-test shows the results of running Little's MCAR test on our dataset.\n\n\n::: {.cell}\n<style type=\"text/css\">\n.rm-striping .gt_table tr.odd {\n  --bs-table-striped-bg: transparent;\n}\n</style>\n:::\n\n::: {#tbl-mcar-test .cell .rm-striping tbl-cap='Little\\'s Little MCAR Test\n'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Table Code (Click to Expand)\"}\nmissing_data |>  \n  naniar::mcar_test() |> \n  mutate(across(everything(), ~ round(.x))) |> \n  rename(\n    \"Test Statistic\" = statistic,\n    \"Degrees of Freedom\" = df,\n    \"P-Value\" = p.value,\n    \"Missing Patterns\" = missing.patterns\n  ) |> \n  gt::gt() |> \n  gt::tab_source_note(source_note = \"Source: IBM Watson Analytics Lab\") |>\n  gt::cols_align(align = \"center\", columns = 1:4) |>\n  gt::tab_options(table.width = gt::pct(80))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"rkpfyapnbr\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#rkpfyapnbr table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#rkpfyapnbr thead, #rkpfyapnbr tbody, #rkpfyapnbr tfoot, #rkpfyapnbr tr, #rkpfyapnbr td, #rkpfyapnbr th {\n  border-style: none;\n}\n\n#rkpfyapnbr p {\n  margin: 0;\n  padding: 0;\n}\n\n#rkpfyapnbr .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: 80%;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#rkpfyapnbr .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#rkpfyapnbr .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#rkpfyapnbr .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#rkpfyapnbr .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#rkpfyapnbr .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#rkpfyapnbr .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#rkpfyapnbr .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#rkpfyapnbr .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#rkpfyapnbr .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#rkpfyapnbr .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#rkpfyapnbr .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#rkpfyapnbr .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#rkpfyapnbr .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#rkpfyapnbr .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rkpfyapnbr .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#rkpfyapnbr .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#rkpfyapnbr .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#rkpfyapnbr .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rkpfyapnbr .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#rkpfyapnbr .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rkpfyapnbr .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#rkpfyapnbr .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rkpfyapnbr .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#rkpfyapnbr .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#rkpfyapnbr .gt_left {\n  text-align: left;\n}\n\n#rkpfyapnbr .gt_center {\n  text-align: center;\n}\n\n#rkpfyapnbr .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#rkpfyapnbr .gt_font_normal {\n  font-weight: normal;\n}\n\n#rkpfyapnbr .gt_font_bold {\n  font-weight: bold;\n}\n\n#rkpfyapnbr .gt_font_italic {\n  font-style: italic;\n}\n\n#rkpfyapnbr .gt_super {\n  font-size: 65%;\n}\n\n#rkpfyapnbr .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#rkpfyapnbr .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#rkpfyapnbr .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#rkpfyapnbr .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#rkpfyapnbr .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#rkpfyapnbr .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#rkpfyapnbr .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Test Statistic\">Test Statistic</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Degrees of Freedom\">Degrees of Freedom</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"P-Value\">P-Value</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Missing Patterns\">Missing Patterns</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Test Statistic\" class=\"gt_row gt_center\">1052</td>\n<td headers=\"Degrees of Freedom\" class=\"gt_row gt_center\">468</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0</td>\n<td headers=\"Missing Patterns\" class=\"gt_row gt_center\">17</td></tr>\n  </tbody>\n  <tfoot class=\"gt_sourcenotes\">\n    <tr>\n      <td class=\"gt_sourcenote\" colspan=\"4\">Source: IBM Watson Analytics Lab</td>\n    </tr>\n  </tfoot>\n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nA high test statistic value and a p-value of zero means we reject the null hypothesis. If the data is MCAR, the probability of observing mean differences as or more extreme than this is very low, suggesting the missing data is either MNAR or MAR. Taken together with our exploratory analysis, we can conclude that the data is MAR.\n\nHowever, there are some limitations with Little's MCAR test. It relies on a slightly backwards approach to hypothesis testing. The null hypothesis is that the data is MCAR. Failing to reject the null is not the same as being able to conclude that the null is true, so it isn't really a test for MCAR data as much as it is a test to reject MCAR data. \n\nI think this is fine because the starting assumption is that data is MAR. Little's MCAR data provides a broad summary of the data. A high p-value suggests further investigation is needed because data might not be MAR, and a low p-value is evidence to support the assumption that the data is MAR. Another alternative to Little's MCAR test, which makes fewer assumptions of the data, is calculating the mean difference of variables conditional on the missingness of the variable in question. However, there are no shortcuts in this process. A detailed exploratory analysis combined with domain expertise is the only way to understand how the data may have come to be missing.\n\n## Well, What Now?\n\nThere you have it. You now know everything you need to know about missing values. That's a lie. You know nothing. It's a vast, overwhelming field full of anguish. All I've done is expose you to its existence. Now you will never escape the shame of being flippant about missing data. You're welcome.\n\nMissing data can have multiple causes, and the mechanism driving missingness can have distinct impacts on data distributions. MNAR and MAR data can seriously bias estimates, while MCAR data is less concerning. For this reason, it is important to understand what is causing missing data. Having (hopefully) convinced you to care about missing data and given you some of the tools needed for identifying its mechanism, the next step is figuring out what to do with it. In the next post in this series, I will discuss solutions to the mess you've ~~made~~ found.\n\n## Acknowledegments {.appendix}\n\nPreview image generated using StabilityAI's [DreamStudio](https://beta.dreamstudio.ai/), using the prompt \"A red milk carton with a missing persons advert on the side of the carton, but instead of a person it is data that is missing\".\n\n## Support {.appendix}\n\nIf you've enjoyed this blog post and would like to support my work, you can [buy me a coffee or a beer or give me a tip](https://www.buymeacoffee.com/paulj1989) as a thank you. \n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}